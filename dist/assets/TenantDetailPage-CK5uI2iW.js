import{r as e,c as t,w as a,b as l,e as s,f as i,g as n,h as r,t as d,j as o,q as u,E as c,F as m,i as b,p as v,n as g,k as p,l as y,m as x,u as f}from"./vue-vendor-CVTqRqMI.js";import{_ as h}from"./AdvanceAccountManager-CmCLB87k.js";import{t as k}from"./tenantsService-D36krPUn.js";import{p as w}from"./paymentsService-CP8J_m2z.js";import{u as A}from"./utilityDebtsService-Cmr5Tqws.js";import{u as D}from"./index-ChpY04z8.js";import{u as P}from"./useErrorHandler-Cmflx4-E.js";import"./tenantsService-C1bOp5xB.js";import"./enums-CeMB0k1K.js";import"./utils-vendor-Cy2sLATb.js";const T={key:0,class:"flex justify-center items-center h-96"},E={key:1,class:"text-center p-12"},j={key:2,class:"p-4 sm:p-6 space-y-6"},N={class:"card bg-base-100 shadow-xl"},B={class:"card-body"},K={class:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4"},C={class:"flex items-center gap-4"},S={class:"avatar placeholder"},I={class:"bg-primary text-primary-content rounded-full w-16"},W={class:"text-2xl"},L={class:"text-3xl font-bold"},$={class:"text-base-content/70"},G={class:"flex items-center gap-4"},_={class:"text-right"},F={key:0,class:"text-xs text-success font-semibold"},Y={class:"tabs tabs-boxed bg-base-200 p-1 mb-6"},H={class:"card bg-base-100 shadow-xl min-h-[400px]"},R={class:"card-body"},z={key:0,class:"space-y-4"},U={class:"timeline timeline-vertical timeline-compact"},V={class:"timeline-middle"},q={key:0},M={key:1},J={class:"timeline-start mb-10 md:text-end pr-4"},O={class:"font-mono italic text-sm text-gray-500"},Q={class:"text-xs uppercase text-gray-400 font-bold tracking-widest mt-1"},X={class:"timeline-end timeline-box !bg-base-100 border-gray-200 shadow-sm p-4 w-full md:w-auto min-w-[300px]"},Z={class:"flex flex-col gap-1"},ee={class:"flex justify-between items-center gap-4"},te={class:"font-bold text-gray-800 dark:text-gray-200"},ae={class:"flex justify-between items-center"},le={class:"text-xs text-gray-500"},se={key:0,class:"py-12 text-center text-gray-500 italic"},ie={key:1},ne={class:"overflow-x-auto"},re={class:"table w-full"},de={class:"text-right font-semibold text-error"},oe={class:"text-center"},ue={class:"flex justify-center gap-2"},ce=["onClick"],me=["onClick"],be={key:0},ve={key:2},ge={class:"overflow-x-auto"},pe={class:"table w-full"},ye={class:"text-right font-semibold text-success"},xe={key:0},fe={key:3},he={class:"overflow-x-auto"},ke={class:"table w-full"},we={class:"text-right font-semibold"},Ae={key:0},De={key:4,class:"space-y-4"},Pe={class:"card bg-base-200 p-4"},Te={class:"grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4"},Ee={class:"card bg-base-200 p-4"},je={class:"grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4"},Ne=["href"],Be={key:0},Ke=["href"],Ce={class:"card bg-base-200 p-4"},Se={key:0},Ie={key:0},We={key:1,class:"text-base-content/60"},Le={class:"card bg-base-200 p-4"},$e={class:"grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4"},Ge={class:"card bg-base-200 p-4"},_e={class:"grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4"},Fe={class:"modal-box max-w-2xl bg-base-100 p-0 overflow-hidden border border-base-300"},Ye={class:"p-6 border-b border-base-200 flex justify-between items-center bg-base-200/50"},He={class:"p-6 max-h-[70vh] overflow-y-auto"},Re={class:"p-4 border-t border-base-200 flex justify-end"},ze={__name:"TenantDetailPage",setup(ze){const Ue=p(),Ve=y(),qe=D(),{handleNetworkError:Me}=P(),Je=e(null),Oe=e(null),Qe=e([]),Xe=e([]),Ze=e([]),et=e(!0),tt=e("timeline"),at=e(0),lt=e(!1),st=()=>{lt.value=!1,mt()},it=t(()=>{const e=[];return Ze.value.forEach(t=>{e.push({date:t.date,description:t.description,amount:t.amount,isPayment:!1,isPaid:t.isPaid,typeLabel:"Water"===t.type?"Su":"Electricity"===t.type?"Elektrik":"Aidat"})}),Xe.value.forEach(t=>{e.push({date:t.paymentDate,description:t.description||"Tahsilat",amount:t.amount,isPayment:!0,typeLabel:"Ã–deme"})}),e.sort((e,t)=>new Date(t.date)-new Date(e.date))}),nt=e=>Number(e??0).toLocaleString("tr-TR",{style:"currency",currency:"TRY"}),rt=e=>{if(!e)return null;const t=(null==e?void 0:e.toDate)?e.toDate():new Date(e);return isNaN(t.getTime())?null:t},dt=e=>{const t=rt(e);return t?t.toLocaleDateString("tr-TR",{year:"numeric",month:"long",day:"numeric"}):"-"},ot=(e,t)=>{if(!("Electricity"!==e.type&&"Water"!==e.type||!0!==e.isPaid&&"Electricity"!==e.type&&"Water"!==e.type))return{status:"paid",badge:"badge-success",label:"Ã–dendi"};if(e.type&&t&&t.length>0){if(t.filter(t=>"Electricity"===e.type&&1===t.type||("Water"===e.type&&2===t.type||"Aidat"===e.type&&0===t.type)).reduce((e,t)=>e+(t.amount||0),0)>=(e.amount||e.toplamTutar||0))return{status:"paid",badge:"badge-success",label:"Ã–dendi"}}return e.dueDate&&new Date(e.dueDate)<new Date?{status:"overdue",badge:"badge-error",label:"Vadesi GeÃ§miÅŸ"}:{status:"unpaid",badge:"badge-warning",label:"Ã–denmemiÅŸ"}},ut=e=>ot(e,Xe.value).badge,ct=e=>ot(e,Xe.value).label,mt=async()=>{var e;if(Je.value){et.value=!0;try{const t=await k.getTenantById(Je.value);if(Oe.value=t||null,!Oe.value)return void(et.value=!1);null==(e=Oe.value.flats)||e.map(e=>e.id);const[a,l]=await Promise.all([w.getPayments({tenantId:Je.value}),A.getUtilityDebts({tenantId:Je.value})]),s=[];(l||[]).forEach(e=>{s.push({...e,type:e.type,date:e.date??e.createdAt??e.dueDate??null,description:`${"Electricity"===e.type?"Elektrik":"Water"===e.type?"Su":"Aidat"} (${e.period||(e.dueDate?dt(e.dueDate):"DÃ¶nem BelirtilmemiÅŸ")})`,amount:Number(e.amount??0),toplamTutar:Number(e.amount??0),remainingAmount:Number(e.remainingAmount??e.amount??0),isPaid:"Paid"===e.status})}),Ze.value=s.sort((e,t)=>{var a,l;return((null==(a=rt(t.date))?void 0:a.getTime())??0)-((null==(l=rt(e.date))?void 0:l.getTime())??0)}),Qe.value=(l||[]).filter(e=>{if("Paid"===e.status)return!1;const t=Number(e.remainingAmount??e.amount??0);if(t<=0)return!1;const l={type:e.type,amount:t,toplamTutar:t,dueDate:e.dueDate};return"paid"!==ot(l,a).status}).map(e=>{var t;return{...e,amount:Number(e.remainingAmount??e.amount??0),typeLabel:"Electricity"===e.type?"Elektrik":"Water"===e.type?"Su":"Aidat",company:(null==(t=Oe.value)?void 0:t.companyName)||"Bilinmeyen",floor:e.unit??"-"}}).sort((e,t)=>{var a,l;return((null==(a=rt(e.dueDate))?void 0:a.getTime())??0)-((null==(l=rt(t.dueDate))?void 0:l.getTime())??0)}),Xe.value=(a||[]).sort((e,t)=>{var a,l;return((null==(a=rt(t.paymentDate))?void 0:a.getTime())??0)-((null==(l=rt(e.paymentDate))?void 0:l.getTime())??0)}),at.value=Oe.value.totalBalance}catch(t){Me(t,{component:"TenantDetailPage",action:"fetchTenantDetails"})}finally{et.value=!1}}else et.value=!1};return a(()=>[qe.user,Ue.params.id,Ue.name],([e,t,a])=>{"Profile"===a&&"tenant"===(null==e?void 0:e.role)&&e.tenantId?Je.value=e.tenantId:Je.value=t},{immediate:!0}),a(Je,(e,t)=>{e&&e!==t&&mt()},{immediate:!0}),(e,t)=>{var a;const p=r("router-link");return et.value?(x(),l("div",T,t[7]||(t[7]=[s("span",{class:"loading loading-spinner loading-lg"},null,-1)]))):Oe.value?(x(),l("div",j,[s("div",N,[s("div",B,[s("div",K,[s("div",C,[s("div",S,[s("div",I,[s("span",W,d((y=Oe.value.companyName,y?y.charAt(0).toUpperCase():"?")),1)])]),s("div",null,[s("h1",L,d(Oe.value.companyName),1),s("p",$,d(Oe.value.businessType)+" - "+d((null==(a=Oe.value.flats)?void 0:a.map(e=>e.code||e.unitNumber).join(", "))||"Ãœnite bilgisi yok"),1)])]),s("div",G,[s("div",_,[t[11]||(t[11]=s("div",{class:"text-sm text-base-content/70"},"GÃ¼ncel Bakiye",-1)),s("div",{class:u(["text-2xl font-bold",Oe.value.totalBalance>0?"text-error":"text-success"])},d(nt(Oe.value.totalBalance)),3),Oe.value.advanceBalance>0?(x(),l("div",F," (Avans: "+d(nt(Oe.value.advanceBalance))+") ",1)):o("",!0)]),s("span",{class:u(["badge badge-lg font-semibold",Oe.value.isActive?"badge-success":"badge-ghost"])},d(Oe.value.isActive?"Aktif":"Pasif"),3)])])])]),s("div",Y,[s("a",{class:u(["tab transition-all",{"tab-active !bg-primary !text-white !rounded-lg shadow-md":"timeline"===tt.value}]),onClick:t[0]||(t[0]=e=>tt.value="timeline")},"Finansal AkÄ±ÅŸ (Timeline)",2),s("a",{class:u(["tab transition-all",{"tab-active !bg-primary !text-white !rounded-lg shadow-md":"debts"===tt.value}]),onClick:t[1]||(t[1]=e=>tt.value="debts")},"Ã–denmemiÅŸ BorÃ§lar",2),s("a",{class:u(["tab transition-all",{"tab-active !bg-primary !text-white !rounded-lg shadow-md":"payments"===tt.value}]),onClick:t[2]||(t[2]=e=>tt.value="payments")},"YapÄ±lan Ã–demeler",2),s("a",{class:u(["tab transition-all",{"tab-active !bg-primary !text-white !rounded-lg shadow-md":"info"===tt.value}]),onClick:t[3]||(t[3]=e=>tt.value="info")},"Ä°ÅŸ Yeri Bilgileri",2)]),s("div",H,[s("div",R,["timeline"===tt.value?(x(),l("div",z,[t[12]||(t[12]=c('<div class="flex justify-between items-center mb-6"><h3 class="text-xl font-bold">Finansal Ä°ÅŸlem GeÃ§miÅŸi</h3><div class="p-2 bg-gray-50 dark:bg-gray-800 rounded-lg text-sm"><span class="inline-block w-3 h-3 bg-error rounded-full mr-1"></span> BorÃ§ <span class="inline-block w-3 h-3 bg-success rounded-full ml-3 mr-1"></span> Ã–deme </div></div>',1)),s("ul",U,[(x(!0),l(m,null,b(it.value,(e,t)=>(x(),l("li",{key:t},[t>0?(x(),l("hr",{key:0,class:u(e.isPayment?"bg-success/30":"bg-error/30")},null,2)):o("",!0),s("div",V,[s("div",{class:u(["w-10 h-10 rounded-full flex items-center justify-center shadow-lg text-white",e.isPayment?"bg-success":"bg-error"])},[e.isPayment?(x(),l("span",q,"ğŸ’¸")):(x(),l("span",M,"ğŸ“„"))],2)]),s("div",J,[s("time",O,d(dt(e.date)),1),s("div",Q,d(e.isPayment?"Tahsilat":"Tahakkuk"),1)]),s("div",X,[s("div",Z,[s("div",ee,[s("span",te,d(e.description),1),s("span",{class:u(["font-bold text-lg",e.isPayment?"text-success":"text-error"])},d(e.isPayment?"+":"-")+d(nt(e.amount)),3)]),s("div",ae,[s("span",le,d(e.typeLabel),1),e.isPayment?o("",!0):(x(),l("span",{key:0,class:u(["badge badge-sm",e.isPaid?"badge-success":"badge-error"])},d(e.isPaid?"Ã–dendi":"Ã–denmedi"),3))])])]),s("hr",{class:u(e.isPayment?"bg-success/30":"bg-error/30")},null,2)]))),128)),0===it.value.length?(x(),l("li",se," HenÃ¼z finansal iÅŸlem kaydÄ± bulunmuyor. ")):o("",!0)])])):o("",!0),"debts"===tt.value?(x(),l("div",ie,[t[15]||(t[15]=s("h3",{class:"text-xl font-bold mb-4"},"Ã–denmemiÅŸ Faturalar ve Aidatlar",-1)),s("div",ne,[s("table",re,[t[14]||(t[14]=s("thead",null,[s("tr",null,[s("th",null,"AÃ§Ä±klama"),s("th",null,"Son Ã–deme Tarihi"),s("th",{class:"text-right"},"Tutar"),s("th",{class:"text-center"},"Ä°ÅŸlemler")])],-1)),s("tbody",null,[(x(!0),l(m,null,b(Qe.value,e=>(x(),l("tr",{key:e.id,class:"hover group"},[s("td",null,d(e.description||`Aidat (${e.period||e.unit})`),1),s("td",null,d(dt(e.dueDate)),1),s("td",de,d(nt(e.amount??e.toplamTutar)),1),s("td",oe,[s("div",ue,[s("button",{onClick:t=>f(Ve).push(`/payments?tenantId=${Oe.value.id}&debtId=${e.id}`),class:"btn btn-xs btn-primary font-bold shadow-sm",title:"Nakit/Kart Ã–deme"},"Ã–de",8,ce),s("button",{onClick:e=>{lt.value=!0},class:"btn btn-xs btn-outline btn-info font-bold",title:"Avans Kullan"},"Avans",8,me)])])]))),128)),0===Qe.value.length?(x(),l("tr",be,t[13]||(t[13]=[s("td",{colspan:"3",class:"text-center py-8 text-base-content/60"},"Ã–denmemiÅŸ borÃ§ bulunmamaktadÄ±r.",-1)]))):o("",!0)])])])])):"payments"===tt.value?(x(),l("div",ve,[t[18]||(t[18]=s("h3",{class:"text-xl font-bold mb-4"},"Ã–deme GeÃ§miÅŸi",-1)),s("div",ge,[s("table",pe,[t[17]||(t[17]=s("thead",null,[s("tr",null,[s("th",null,"Ã–deme Tarihi"),s("th",null,"AÃ§Ä±klama"),s("th",{class:"text-right"},"Tutar")])],-1)),s("tbody",null,[(x(!0),l(m,null,b(Xe.value,e=>(x(),l("tr",{key:e.id,class:"hover"},[s("td",null,d(dt(e.paymentDate)),1),s("td",null,d(e.description),1),s("td",ye,d(nt(e.amount)),1)]))),128)),0===Xe.value.length?(x(),l("tr",xe,t[16]||(t[16]=[s("td",{colspan:"3",class:"text-center py-8 text-base-content/60"},"KayÄ±tlÄ± Ã¶deme bulunmamaktadÄ±r.",-1)]))):o("",!0)])])])])):"history"===tt.value?(x(),l("div",fe,[t[21]||(t[21]=s("h3",{class:"text-xl font-bold mb-4"},"GeÃ§miÅŸ KayÄ±tlar",-1)),s("div",he,[s("table",ke,[t[20]||(t[20]=s("thead",null,[s("tr",null,[s("th",null,"Tarih"),s("th",null,"TÃ¼r"),s("th",null,"AÃ§Ä±klama"),s("th",{class:"text-right"},"Tutar"),s("th",null,"Durum")])],-1)),s("tbody",null,[(x(!0),l(m,null,b(Ze.value,e=>(x(),l("tr",{key:e.id,class:"hover"},[s("td",null,d(dt(e.date)),1),s("td",null,[s("span",{class:u(["badge","Water"===e.type?"badge-info":"Electricity"===e.type?"badge-warning":"badge-neutral"])},d("Water"===e.type?"Su":"Electricity"===e.type?"Elektrik":"Aidat"),3)]),s("td",null,d(e.description),1),s("td",we,d(nt(e.amount)),1),s("td",null,[s("span",{class:u(["badge",ut(e)])},d(ct(e)),3)])]))),128)),0===Ze.value.length?(x(),l("tr",Ae,t[19]||(t[19]=[s("td",{colspan:"5",class:"text-center py-8 text-base-content/60"},"KayÄ±tlÄ± borÃ§ bulunmamaktadÄ±r.",-1)]))):o("",!0)])])])])):"info"===tt.value?(x(),l("div",De,[t[40]||(t[40]=s("h3",{class:"text-xl font-bold"},"DetaylÄ± Bilgiler",-1)),s("div",Pe,[t[25]||(t[25]=s("h4",{class:"text-lg font-semibold mb-4 text-gray-700 dark:text-gray-300"},"ğŸ¢ Ä°ÅŸ Yeri Bilgileri",-1)),s("div",Te,[s("div",null,[t[22]||(t[22]=s("strong",null,"Åirket AdÄ±:",-1)),v(" "+d(Oe.value.companyName),1)]),s("div",null,[t[23]||(t[23]=s("strong",null,"Ä°ÅŸ TÃ¼rÃ¼:",-1)),v(" "+d(Oe.value.businessType),1)]),s("div",null,[t[24]||(t[24]=s("strong",null,"Kimlik/Vergi No:",-1)),v(" "+d(Oe.value.identityNumber||"BelirtilmemiÅŸ"),1)])])]),s("div",Ee,[t[31]||(t[31]=s("h4",{class:"text-lg font-semibold mb-4 text-gray-700 dark:text-gray-300"},"ğŸ‘¤ Ä°letiÅŸim KiÅŸisi",-1)),s("div",je,[s("div",null,[t[26]||(t[26]=s("strong",null,"Ä°letiÅŸim KiÅŸisi:",-1)),v(" "+d(Oe.value.contactPersonName),1)]),s("div",null,[t[27]||(t[27]=s("strong",null,"Telefon:",-1)),t[28]||(t[28]=v()),s("a",{href:`tel:${Oe.value.contactPersonPhone}`,class:"link link-primary"},d(Oe.value.contactPersonPhone),9,Ne)]),Oe.value.contactPersonEmail?(x(),l("div",Be,[t[29]||(t[29]=s("strong",null,"E-posta:",-1)),t[30]||(t[30]=v()),s("a",{href:`mailto:${Oe.value.contactPersonEmail}`,class:"link link-primary"},d(Oe.value.contactPersonEmail),9,Ke)])):o("",!0)])]),s("div",Ce,[t[35]||(t[35]=s("h4",{class:"text-lg font-semibold mb-4 text-gray-700 dark:text-gray-300"},"ğŸ“ Ãœnite Bilgileri",-1)),Oe.value.flats&&Oe.value.flats.length>0?(x(),l("div",Se,[(x(!0),l(m,null,b(Oe.value.flats,e=>(x(),l("div",{key:e.id,class:"grid grid-cols-1 md:grid-cols-3 gap-x-8 gap-y-4 mb-4 p-3 bg-base-100 rounded-lg"},[s("div",null,[t[32]||(t[32]=s("strong",null,"Ãœnite:",-1)),v(" "+d(e.code||e.unitNumber),1)]),s("div",null,[t[33]||(t[33]=s("strong",null,"Kat:",-1)),v(" "+d(e.floorNumber??e.floor),1),e.floorNumber??e.floor?(x(),l("span",Ie,". Kat")):o("",!0)]),s("div",null,[t[34]||(t[34]=s("strong",null,"Alan:",-1)),v(" "+d(e.unitArea)+" mÂ²",1)])]))),128))])):(x(),l("div",We,"Ãœnite bilgisi bulunmamaktadÄ±r."))]),s("div",Le,[t[37]||(t[37]=s("h4",{class:"text-lg font-semibold mb-4 text-gray-700 dark:text-gray-300"},"ğŸ’° Aidat Bilgileri",-1)),s("div",$e,[s("div",null,[t[36]||(t[36]=s("strong",null,"AylÄ±k Aidat:",-1)),v(" "+d(nt(Oe.value.monthlyAidat)),1)])])]),s("div",Ge,[s("div",_e,[s("div",null,[t[38]||(t[38]=s("strong",null,"Durum:",-1)),t[39]||(t[39]=v()),s("span",{class:u(["badge",Oe.value.isActive?"badge-success":"badge-ghost"])},d(Oe.value.isActive?"Aktif":"Pasif"),3)])])])])):o("",!0)])]),s("div",{class:u(["modal",{"modal-open":lt.value}])},[s("div",Fe,[s("div",Ye,[t[41]||(t[41]=s("h3",{class:"font-bold text-lg"},"Avans HesabÄ± Kullan",-1)),s("button",{onClick:t[4]||(t[4]=e=>lt.value=!1),class:"btn btn-ghost btn-sm btn-circle"},"âœ•")]),s("div",He,[lt.value?(x(),g(h,{key:0,"tenant-id":Je.value,onSuccess:st},null,8,["tenant-id"])):o("",!0)]),s("div",Re,[s("button",{onClick:t[5]||(t[5]=e=>lt.value=!1),class:"btn btn-ghost"},"Kapat")])]),s("div",{class:"modal-backdrop",onClick:t[6]||(t[6]=e=>lt.value=!1)})],2)])):(x(),l("div",E,[t[9]||(t[9]=s("h2",{class:"text-2xl font-bold text-error"},"KiracÄ± BulunamadÄ±",-1)),t[10]||(t[10]=s("p",{class:"text-base-content/70 mt-2"},"Bu ID'ye sahip bir kiracÄ± bulunamadÄ± veya veritabanÄ±ndan silinmiÅŸ olabilir.",-1)),i(p,{to:"/tenants",class:"btn btn-primary mt-6"},{default:n(()=>t[8]||(t[8]=[v("KiracÄ± Listesine Geri DÃ¶n")])),_:1,__:[8]})]));var y}}};export{ze as default};
