import{r as a,c as e,o as t,b as l,e as s,t as n,s as i,G as r,H as u,I as o,F as c,i as d,j as v,m,q as b}from"./vue-vendor-Bart4FG5.js";import{o as p}from"./ownerDuesService-DhGMKQL0.js";import{t as g}from"./tenantsService-D7zXuWjI.js";import{u as h}from"./useErrorHandler-ClkkjmfK.js";import{U as y}from"./units-DJG6lNYB.js";import"./index-BbOmoSe-.js";import"./utils-vendor-Cy2sLATb.js";const f={class:"space-y-8"},w={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},k={class:"stat bg-base-200 rounded-lg"},x={class:"stat-value text-primary"},A={class:"stat bg-base-200 rounded-lg"},D={class:"stat-value text-success"},S={class:"stat bg-base-200 rounded-lg"},T={class:"stat-value text-warning"},j={class:"grid grid-cols-1 lg:grid-cols-2 gap-8"},K={class:"card bg-base-100 shadow-xl"},I={class:"card-body"},M={class:"form-control"},z={class:"form-control"},F=["value"],H={class:"form-control"},B=["value"],V={class:"form-control"},Y=["value"],E={class:"card-actions justify-end"},O=["disabled"],C={class:"card bg-base-100 shadow-xl"},L={class:"card-body"},U={class:"form-control"},N={class:"form-control"},$=["value"],_={class:"card-actions justify-end"},G=["disabled"],P={class:"card bg-base-100 shadow-xl"},R={class:"card-body"},q={class:"overflow-x-auto"},J={class:"table w-full"},Q={class:"badge badge-ghost"},W={class:"font-medium"},X={class:"font-bold text-success"},Z={class:"text-right"},aa=["onClick"],ea=["onClick"],ta={key:0,class:"text-center py-10 text-base-content/60"},la={__name:"OwnerDuesPanel",setup(la){const{handleNetworkError:sa,handleValidationError:na,showSuccess:ia}=h(),ra=a((new Date).getFullYear()),ua=a(""),oa=a(""),ca=a([]),da=a(null),va=a((new Date).getFullYear()),ma=a(""),ba=a([]),pa=a(new Set),ga=a=>!a||isNaN(a)?"₺0,00":Number(a).toLocaleString("tr-TR",{style:"currency",currency:"TRY"}),ha=()=>{const a=oa.value.replace(/\./g,"").replace(",",".");return parseFloat(a)||0},ya=e(()=>{const a=ha();return a?(1.2*a).toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2})+" ₺":"0,00 ₺"}),fa=a=>{let e=a.target.value;e=e.replace(/[^0-9,.]/g,"");const t=e.split(/[.,]/);t.length>2&&(e=t[0]+","+t.slice(1).join("")),oa.value=e},wa=a=>{let e=a.target.value;e=e.replace(/[^0-9,.]/g,"");const t=e.split(/[.,]/);t.length>2&&(e=t[0]+","+t.slice(1).join("")),ma.value=e},ka=e(()=>ra.value>=2020&&ua.value&&ha()>0),xa=e(()=>y.length),Aa=e(()=>pa.value.size),Da=e(()=>xa.value-Aa.value),Sa=e(()=>{const a=new Set(ca.value.filter(a=>a.year===ra.value&&a.id!==da.value).map(a=>a.unit));return y.filter(a=>!pa.value.has(a)||a===ua.value).filter(e=>!a.has(e))}),Ta=async()=>{try{ba.value=await g.getTenants(),pa.value.clear(),ba.value.forEach(a=>{a.isActive&&a.flats&&a.flats.forEach(a=>{const e="object"==typeof a?a.code:a;pa.value.add(e)})})}catch(a){sa(a)}},ja=async()=>{try{const a=await p.getOwnerDues();ca.value=a.sort((a,e)=>e.year-a.year||a.unit.localeCompare(e.unit))}catch(a){sa(a)}},Ka=()=>{ua.value="",oa.value="",ra.value=(new Date).getFullYear(),da.value=null},Ia=async()=>{const a=ha();if(!ka.value)return void notifyError("Lütfen tüm alanları eksiksiz doldurun.");const e=parseFloat((1.2*a).toFixed(2)),t={unit:ua.value,year:ra.value,amount:a,vatIncludedAmount:e,ownerId:"MAL_SAHIBI",isActive:!0};try{da.value?(await p.updateOwnerDue(da.value,t),ia("Aidat güncellendi.")):(await p.createOwnerDue(t),ia("Aidat kaydı eklendi.")),Ka(),await ja()}catch(l){na(l)}},Ma=async()=>{const a=(()=>{const a=ma.value.replace(/\./g,"").replace(",",".");return parseFloat(a)||0})();if(!va.value||a<=0)return void notifyError("Lütfen yıl ve tutar bilgilerini eksiksiz doldurun.");const e=new Set(ca.value.filter(a=>a.year===va.value).map(a=>a.unit)),t=y.filter(a=>!pa.value.has(a)).filter(a=>!e.has(a));if(0!==t.length){if(confirm(`${va.value} yılı için ${t.length} boş kata ${ga(a)} (KDV hariç) aidat oluşturmak istiyor musunuz?`)){const e=parseFloat((1.2*a).toFixed(2));try{for(const l of t)await p.createOwnerDue({unit:l,year:va.value,amount:a,vatIncludedAmount:e,ownerId:"MAL_SAHIBI",isActive:!0});ia(`${t.length} adet yeni boş kat aidat kaydı oluşturuldu.`),await ja(),ma.value=""}catch(l){na(l)}}}else notifyInfo("Aidat tanımlanacak uygun (boş ve bu yıl için aidatı olmayan) kat bulunmamaktadır.")};return t(async()=>{await Promise.all([Ta(),ja()])}),(a,e)=>(m(),l("div",f,[e[22]||(e[22]=s("div",{class:"text-center"},[s("h2",{class:"text-3xl font-bold text-gray-800 dark:text-gray-100"},"Mal Sahibi Aidat Yönetimi"),s("p",{class:"text-gray-500 dark:text-gray-400 mt-2"},"Boşta olan katlar için yıllık aidat tutarlarını tanımlayın ve yönetin.")],-1)),s("div",w,[s("div",k,[e[3]||(e[3]=s("div",{class:"stat-figure text-primary"},[s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",class:"inline-block w-8 h-8 stroke-current"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})])],-1)),e[4]||(e[4]=s("div",{class:"stat-title"},"Toplam Kat",-1)),s("div",x,n(xa.value),1)]),s("div",A,[e[5]||(e[5]=s("div",{class:"stat-figure text-success"},[s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",class:"inline-block w-8 h-8 stroke-current"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})])],-1)),e[6]||(e[6]=s("div",{class:"stat-title"},"Dolu Kat",-1)),s("div",D,n(Aa.value),1)]),s("div",S,[e[7]||(e[7]=s("div",{class:"stat-figure text-warning"},[s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",class:"inline-block w-8 h-8 stroke-current"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})])],-1)),e[8]||(e[8]=s("div",{class:"stat-title"},"Boş Kat",-1)),s("div",T,n(Da.value),1)])]),s("div",j,[s("div",K,[s("div",I,[e[14]||(e[14]=s("h2",{class:"card-title"},"Tekil Aidat Tanımlama",-1)),s("form",{onSubmit:i(Ia,["prevent"]),class:"space-y-4"},[s("div",M,[e[9]||(e[9]=s("label",{class:"label"},[s("span",{class:"label-text"},"Yıl")],-1)),r(s("input",{type:"number","onUpdate:modelValue":e[0]||(e[0]=a=>ra.value=a),class:"input input-bordered w-full",min:"2020"},null,512),[[u,ra.value,void 0,{number:!0}]])]),s("div",z,[e[11]||(e[11]=s("label",{class:"label"},[s("span",{class:"label-text"},"Boş Kat Seçimi")],-1)),r(s("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>ua.value=a),class:"select select-bordered w-full"},[e[10]||(e[10]=s("option",{disabled:"",value:""},"Seçiniz",-1)),(m(!0),l(c,null,d(Sa.value,a=>(m(),l("option",{key:a,value:a},n(a),9,F))),128))],512),[[o,ua.value]])]),s("div",H,[e[12]||(e[12]=s("label",{class:"label"},[s("span",{class:"label-text"},"Aidat Tutarı (KDV Hariç)")],-1)),s("input",{value:oa.value,onInput:fa,class:"input input-bordered w-full",inputmode:"numeric",placeholder:"Örn: 2500"},null,40,B)]),s("div",V,[e[13]||(e[13]=s("label",{class:"label"},[s("span",{class:"label-text"},"KDV Dahil Tutar")],-1)),s("input",{value:ya.value,class:"input input-bordered w-full bg-base-200",disabled:""},null,8,Y)]),s("div",E,[s("button",{type:"button",onClick:Ka,class:"btn btn-ghost"},"Temizle"),s("button",{type:"submit",class:"btn btn-primary",disabled:!ka.value},n(da.value?"Güncelle":"Kaydet"),9,O)])],32)])]),s("div",C,[s("div",L,[e[17]||(e[17]=s("h2",{class:"card-title"},"Toplu Aidat Oluşturma",-1)),e[18]||(e[18]=s("p",{class:"text-sm text-base-content/70 mb-4"},"Tüm boş katlar için tek seferde aidat tanımlayın.",-1)),s("form",{onSubmit:i(Ma,["prevent"]),class:"space-y-4"},[s("div",U,[e[15]||(e[15]=s("label",{class:"label"},[s("span",{class:"label-text"},"Yıl")],-1)),r(s("input",{type:"number","onUpdate:modelValue":e[2]||(e[2]=a=>va.value=a),class:"input input-bordered w-full",min:"2020"},null,512),[[u,va.value,void 0,{number:!0}]])]),s("div",N,[e[16]||(e[16]=s("label",{class:"label"},[s("span",{class:"label-text"},"Temel Aidat Tutarı (KDV Hariç)")],-1)),s("input",{value:ma.value,onInput:wa,class:"input input-bordered w-full",inputmode:"numeric",placeholder:"Örn: 2500"},null,40,$)]),s("div",_,[s("button",{type:"submit",class:"btn btn-success",disabled:!va.value||!ma.value||0===Sa.value.length}," Tüm Boş Katlara Uygula ",8,G)])],32)])])]),s("div",P,[s("div",R,[e[21]||(e[21]=s("h2",{class:"card-title mb-4"},"Kayıtlı Aidat Tanımları",-1)),s("div",q,[s("table",J,[e[19]||(e[19]=s("thead",null,[s("tr",null,[s("th",null,"Yıl"),s("th",null,"Kat"),s("th",null,"Aidat (KDV Hariç)"),s("th",null,"KDV Dahil Tutar"),s("th",null,"Durum"),s("th",{class:"text-right"},"İşlemler")])],-1)),s("tbody",null,[(m(!0),l(c,null,d(ca.value,a=>(m(),l("tr",{key:a.id,class:"hover"},[s("td",null,[s("span",Q,n(a.year),1)]),s("td",W,n(a.unit),1),s("td",null,n(ga(a.amount)),1),s("td",X,n(ga(a.vatIncludedAmount)),1),s("td",null,[s("span",{class:b(["badge",a.isActive?"badge-success":"badge-error"])},n(a.isActive?"Aktif":"Pasif"),3)]),s("td",Z,[s("button",{onClick:e=>(a=>{ua.value=a.unit,oa.value=a.amount.toString().replace(".",","),ra.value=a.year,da.value=a.id})(a),class:"btn btn-ghost btn-sm"},"Düzenle",8,aa),s("button",{onClick:e=>(async a=>{if(confirm("Bu aidat tanımını silmek istiyor musunuz? Bu işlem, gelecekte bu tanıma göre aidat oluşturulmasını engeller."))try{await p.deleteOwnerDue(a),ia("Aidat tanımı silindi."),await ja()}catch(e){na(e)}})(a.id),class:"btn btn-ghost btn-sm text-error"},"Sil",8,ea)])]))),128))])])]),0===ca.value.length?(m(),l("div",ta,e[20]||(e[20]=[s("p",null,"Henüz mal sahibi aidatı tanımlanmamış.",-1)]))):v("",!0)])])]))}};export{la as default};
