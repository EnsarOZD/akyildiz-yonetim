import{r as a,C as e,o as t,c as l,b as s,t as n,q as i,D as u,H as r,E as c,F as d,i as o,e as v,l as b,p as m}from"./vue-vendor-BE3w9SvD.js";import{a as h}from"./index-CAkTsZV-.js";import{U as p}from"./units-DJG6lNYB.js";new class{constructor(){this.backendAvailable=!1,this.checkBackendAvailability()}async checkBackendAvailability(){try{await h.get("/health"),this.backendAvailable=!0}catch(a){this.backendAvailable=!1}}async getOwnerDues(a={}){try{if(this.backendAvailable)return await h.get("/owner-dues",a)}catch(e){this.backendAvailable=!1}return[]}async getOwnerDueById(a){try{if(this.backendAvailable)return await h.get(`/owner-dues/${a}`)}catch(e){this.backendAvailable=!1}return null}async createOwnerDue(a){try{if(this.backendAvailable)return await h.post("/owner-dues",a)}catch(e){this.backendAvailable=!1}return{success:!0,message:"Owner due oluşturuldu (backend mevcut değil)"}}async updateOwnerDue(a,e){try{if(this.backendAvailable)return await h.put(`/owner-dues/${a}`,e)}catch(t){this.backendAvailable=!1}return{success:!0,message:"Owner due güncellendi (backend mevcut değil)"}}async deleteOwnerDue(a){try{if(this.backendAvailable)return await h.delete(`/owner-dues/${a}`)}catch(e){this.backendAvailable=!1}return{success:!0,message:"Owner due silindi (backend mevcut değil)"}}};const g={class:"space-y-8"},w={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},y={class:"stat bg-base-200 rounded-lg"},k={class:"stat-value text-primary"},f={class:"stat bg-base-200 rounded-lg"},A={class:"stat-value text-success"},x={class:"stat bg-base-200 rounded-lg"},D={class:"stat-value text-warning"},T={class:"grid grid-cols-1 lg:grid-cols-2 gap-8"},B={class:"card bg-base-100 shadow-xl"},I={class:"card-body"},K={class:"form-control"},S={class:"form-control"},M=["value"],z={class:"form-control"},F=["value"],H={class:"form-control"},j=["value"],O={class:"card-actions justify-end"},V=["disabled"],Y={class:"card bg-base-100 shadow-xl"},C={class:"card-body"},$={class:"form-control"},L={class:"form-control"},U=["value"],E={class:"card-actions justify-end"},_=["disabled"],N={class:"card bg-base-100 shadow-xl"},P={class:"card-body"},R={class:"overflow-x-auto"},q={class:"table w-full"},G={class:"badge badge-ghost"},J={class:"font-medium"},Q={class:"font-bold text-success"},W={class:"text-right"},X=["onClick"],Z=["onClick"],aa={key:0,class:"text-center py-10 text-base-content/60"},ea={__name:"OwnerDuesPanel",setup(h){const ea=a((new Date).getFullYear()),ta=a(""),la=a(""),sa=a([]),na=a(null),ia=a((new Date).getFullYear()),ua=a(""),ra=a([]),ca=a(new Set),da=a=>!a||isNaN(a)?"₺0.00":Number(a).toLocaleString("tr-TR",{style:"currency",currency:"TRY"}),oa=()=>{const a=la.value.replace(/\./g,"").replace(",",".");return parseFloat(a)||0},va=e(()=>{const a=oa();return a?(1.2*a).toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2})+" ₺":"0.00 ₺"}),ba=a=>{let e=a.target.value;e=e.replace(/[^0-9,.]/g,"");const t=e.split(/[.,]/);t.length>2&&(e=t[0]+","+t.slice(1).join("")),la.value=e},ma=a=>{let e=a.target.value;e=e.replace(/[^0-9,.]/g,"");const t=e.split(/[.,]/);t.length>2&&(e=t[0]+","+t.slice(1).join("")),ua.value=e},ha=e(()=>ea.value>=2020&&ta.value&&oa()>0),pa=e(()=>p.length),ga=e(()=>ca.value.size),wa=e(()=>pa.value-ga.value),ya=e(()=>{const a=new Set(sa.value.filter(a=>a.year===ea.value&&a.id!==na.value).map(a=>a.unit));return p.filter(a=>!ca.value.has(a)||a===ta.value).filter(e=>!a.has(e))}),ka=async()=>{const a=await getDocs(collection(db,"tenants"));ra.value=a.docs.map(a=>({id:a.id,...a.data()})),ca.value.clear(),ra.value.forEach(a=>{a.isActive&&a.units&&a.units.forEach(a=>{ca.value.add(a)})})},fa=async()=>{sa.value=[];const a=await getDocs(collection(db,"ownerDues")),e=[];a.forEach(a=>{const t=a.data();e.push({id:a.id,year:t.year,amount:t.amount,vatIncludedAmount:t.vatIncludedAmount,unit:t.unit,isActive:!1!==t.isActive,createdAt:t.createdAt})}),sa.value=e.sort((a,e)=>e.year-a.year||a.unit.localeCompare(e.unit))},Aa=()=>{ta.value="",la.value="",ea.value=(new Date).getFullYear(),na.value=null},xa=async()=>{const a=oa();if(!ha.value)return void alert("Lütfen tüm alanları eksiksiz doldurun.");const e=parseFloat((1.2*a).toFixed(2)),t={unit:ta.value,year:ea.value,amount:a,vatIncludedAmount:e,ownerId:"MAL_SAHIBI",isActive:!0};try{if(na.value){const a=doc(db,"ownerDues",na.value);await setDoc(a,{...t,updatedAt:new Date},{merge:!0}),alert("Aidat güncellendi.")}else await addDoc(collection(db,"ownerDues"),{...t,createdAt:new Date}),alert("Aidat kaydı eklendi.")}catch(l){alert("Bir hata oluştu.")}Aa(),await fa()},Da=async()=>{const a=(()=>{const a=ua.value.replace(/\./g,"").replace(",",".");return parseFloat(a)||0})();if(!ia.value||a<=0)return void alert("Lütfen yıl ve tutar bilgilerini eksiksiz doldurun.");const e=new Set(sa.value.filter(a=>a.year===ia.value).map(a=>a.unit)),t=p.filter(a=>!ca.value.has(a)).filter(a=>!e.has(a));if(0!==t.length){if(confirm(`${ia.value} yılı için ${t.length} boş kata ${da(a)} (KDV hariç) aidat oluşturmak istiyor musunuz?`)){const e=parseFloat((1.2*a).toFixed(2)),s=writeBatch(db);for(const l of t){const t=doc(collection(db,"ownerDues"));s.set(t,{unit:l,year:ia.value,amount:a,vatIncludedAmount:e,ownerId:"MAL_SAHIBI",isActive:!0,createdAt:new Date})}try{await s.commit(),alert(`${t.length} adet yeni boş kat aidat kaydı oluşturuldu.`),await fa(),ua.value=""}catch(l){alert("Toplu aidat oluşturulurken bir hata oluştu.")}}}else alert("Aidat tanımlanacak uygun (boş ve bu yıl için aidatı olmayan) kat bulunmamaktadır.")};return t(async()=>{await Promise.all([ka(),fa()])}),(a,e)=>(b(),l("div",g,[e[22]||(e[22]=s("div",{class:"text-center"},[s("h2",{class:"text-3xl font-bold text-gray-800 dark:text-gray-100"},"Mal Sahibi Aidat Yönetimi"),s("p",{class:"text-gray-500 dark:text-gray-400 mt-2"},"Boşta olan katlar için yıllık aidat tutarlarını tanımlayın ve yönetin.")],-1)),s("div",w,[s("div",y,[e[3]||(e[3]=s("div",{class:"stat-figure text-primary"},[s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",class:"inline-block w-8 h-8 stroke-current"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})])],-1)),e[4]||(e[4]=s("div",{class:"stat-title"},"Toplam Kat",-1)),s("div",k,n(pa.value),1)]),s("div",f,[e[5]||(e[5]=s("div",{class:"stat-figure text-success"},[s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",class:"inline-block w-8 h-8 stroke-current"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})])],-1)),e[6]||(e[6]=s("div",{class:"stat-title"},"Dolu Kat",-1)),s("div",A,n(ga.value),1)]),s("div",x,[e[7]||(e[7]=s("div",{class:"stat-figure text-warning"},[s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",class:"inline-block w-8 h-8 stroke-current"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})])],-1)),e[8]||(e[8]=s("div",{class:"stat-title"},"Boş Kat",-1)),s("div",D,n(wa.value),1)])]),s("div",T,[s("div",B,[s("div",I,[e[14]||(e[14]=s("h2",{class:"card-title"},"Tekil Aidat Tanımlama",-1)),s("form",{onSubmit:i(xa,["prevent"]),class:"space-y-4"},[s("div",K,[e[9]||(e[9]=s("label",{class:"label"},[s("span",{class:"label-text"},"Yıl")],-1)),u(s("input",{type:"number","onUpdate:modelValue":e[0]||(e[0]=a=>ea.value=a),class:"input input-bordered w-full",min:"2020"},null,512),[[r,ea.value,void 0,{number:!0}]])]),s("div",S,[e[11]||(e[11]=s("label",{class:"label"},[s("span",{class:"label-text"},"Boş Kat Seçimi")],-1)),u(s("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>ta.value=a),class:"select select-bordered w-full"},[e[10]||(e[10]=s("option",{disabled:"",value:""},"Seçiniz",-1)),(b(!0),l(d,null,o(ya.value,a=>(b(),l("option",{key:a,value:a},n(a),9,M))),128))],512),[[c,ta.value]])]),s("div",z,[e[12]||(e[12]=s("label",{class:"label"},[s("span",{class:"label-text"},"Aidat Tutarı (KDV Hariç)")],-1)),s("input",{value:la.value,onInput:ba,class:"input input-bordered w-full",inputmode:"numeric",placeholder:"Örn: 2500"},null,40,F)]),s("div",H,[e[13]||(e[13]=s("label",{class:"label"},[s("span",{class:"label-text"},"KDV Dahil Tutar")],-1)),s("input",{value:va.value,class:"input input-bordered w-full bg-base-200",disabled:""},null,8,j)]),s("div",O,[s("button",{type:"button",onClick:Aa,class:"btn btn-ghost"},"Temizle"),s("button",{type:"submit",class:"btn btn-primary",disabled:!ha.value},n(na.value?"Güncelle":"Kaydet"),9,V)])],32)])]),s("div",Y,[s("div",C,[e[17]||(e[17]=s("h2",{class:"card-title"},"Toplu Aidat Oluşturma",-1)),e[18]||(e[18]=s("p",{class:"text-sm text-base-content/70 mb-4"},"Tüm boş katlar için tek seferde aidat tanımlayın.",-1)),s("form",{onSubmit:i(Da,["prevent"]),class:"space-y-4"},[s("div",$,[e[15]||(e[15]=s("label",{class:"label"},[s("span",{class:"label-text"},"Yıl")],-1)),u(s("input",{type:"number","onUpdate:modelValue":e[2]||(e[2]=a=>ia.value=a),class:"input input-bordered w-full",min:"2020"},null,512),[[r,ia.value,void 0,{number:!0}]])]),s("div",L,[e[16]||(e[16]=s("label",{class:"label"},[s("span",{class:"label-text"},"Temel Aidat Tutarı (KDV Hariç)")],-1)),s("input",{value:ua.value,onInput:ma,class:"input input-bordered w-full",inputmode:"numeric",placeholder:"Örn: 2500"},null,40,U)]),s("div",E,[s("button",{type:"submit",class:"btn btn-success",disabled:!ia.value||!ua.value||0===ya.value.length}," Tüm Boş Katlara Uygula ",8,_)])],32)])])]),s("div",N,[s("div",P,[e[21]||(e[21]=s("h2",{class:"card-title mb-4"},"Kayıtlı Aidat Tanımları",-1)),s("div",R,[s("table",q,[e[19]||(e[19]=s("thead",null,[s("tr",null,[s("th",null,"Yıl"),s("th",null,"Kat"),s("th",null,"Aidat (KDV Hariç)"),s("th",null,"KDV Dahil Tutar"),s("th",null,"Durum"),s("th",{class:"text-right"},"İşlemler")])],-1)),s("tbody",null,[(b(!0),l(d,null,o(sa.value,a=>(b(),l("tr",{key:a.id,class:"hover"},[s("td",null,[s("span",G,n(a.year),1)]),s("td",J,n(a.unit),1),s("td",null,n(da(a.amount)),1),s("td",Q,n(da(a.vatIncludedAmount)),1),s("td",null,[s("span",{class:m(["badge",a.isActive?"badge-success":"badge-error"])},n(a.isActive?"Aktif":"Pasif"),3)]),s("td",W,[s("button",{onClick:e=>(a=>{ta.value=a.unit,la.value=a.amount.toString().replace(".",","),ea.value=a.year,na.value=a.id})(a),class:"btn btn-ghost btn-sm"},"Düzenle",8,X),s("button",{onClick:e=>(async a=>{confirm("Bu aidat tanımını silmek istiyor musunuz? Bu işlem, gelecekte bu tanıma göre aidat oluşturulmasını engeller.")&&(await deleteDoc(doc(db,"ownerDues",a)),await fa())})(a.id),class:"btn btn-ghost btn-sm text-error"},"Sil",8,Z)])]))),128))])])]),0===sa.value.length?(b(),l("div",aa,e[20]||(e[20]=[s("p",null,"Henüz mal sahibi aidatı tanımlanmamış.",-1)]))):v("",!0)])])]))}};export{ea as default};
