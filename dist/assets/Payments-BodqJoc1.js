import{r as e,C as t,w as a,o as r,c as l,l as n,b as s,n as o,e as d,D as u,H as i,E as c,F as b,i as m,t as g,I as p,p as y,f as v}from"./vue-vendor-BE3w9SvD.js";import{p as k}from"./paymentsService-sfLQHDz3.js";import{u as x}from"./useErrorHandler-CQcR_3b6.js";import{u as h}from"./useNotification-Dv4wKXE4.js";import{u as f}from"./useEventBus-CFAD6Pmz.js";import{_ as w}from"./FilterBar-wXoQM61V.js";import{t as j}from"./tenantsService-DcFCN9jj.js";import"./index-CAkTsZV-.js";const N=["open"],C={class:"modal-box max-w-4xl bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-900 border border-gray-200 dark:border-gray-700 shadow-2xl"},M={class:"flex items-center justify-between pb-4 border-b border-gray-200 dark:border-gray-700 mb-6"},B={class:"space-y-6"},I={class:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 border border-blue-200 dark:border-blue-800"},S={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},A={class:"form-control"},T={class:"form-control"},D={class:"form-control"},P=["value"],L={class:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4 border border-green-200 dark:border-green-800"},z={class:"form-control"},E=["value"],U={key:0,class:"bg-amber-50 dark:bg-amber-900/20 rounded-lg p-4 border border-amber-200 dark:border-amber-800"},H={class:"space-y-3 max-h-64 overflow-y-auto"},O=["value"],V={class:"flex-1"},K={class:"flex items-center justify-between"},F={class:"font-semibold text-gray-800 dark:text-gray-100"},$={class:"text-sm text-gray-600 dark:text-gray-400"},G={key:0,class:"ml-2 text-blue-600 dark:text-blue-400"},Y={class:"text-right"},q={class:"font-bold text-red-600 dark:text-red-400"},_={class:"text-xs text-gray-500 dark:text-gray-400"},R={key:0,class:"text-xs text-yellow-600 dark:text-yellow-400"},W={key:0,class:"mt-4 p-3 bg-white dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600"},Z={key:0,class:"mb-3 p-2 bg-blue-50 dark:bg-blue-900/20 rounded border border-blue-200 dark:border-blue-800"},J={class:"flex items-center gap-2"},Q={class:"text-sm text-blue-700 dark:text-blue-300"},X={class:"space-y-2"},ee={class:"text-sm text-gray-600 dark:text-gray-400"},te={key:0,class:"text-blue-600 dark:text-blue-400"},ae=["onUpdate:modelValue","max","onInput"],re={class:"flex justify-between items-center mt-3 pt-3 border-t border-gray-200 dark:border-gray-600"},le={class:"font-bold text-green-600 dark:text-green-400"},ne={class:"flex justify-between items-center"},se={class:"font-bold text-blue-600 dark:text-blue-400"},oe={class:"flex justify-between items-center"},de={key:1,class:"mt-3 p-2 bg-amber-50 dark:bg-amber-900/20 rounded border border-amber-200 dark:border-amber-800"},ue={class:"flex items-center gap-2"},ie={class:"text-sm text-amber-700 dark:text-amber-300"},ce={key:1,class:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4 border border-green-200 dark:border-green-800"},be={key:2,class:"bg-red-50 dark:bg-red-900/20 rounded-lg p-4 border border-red-200 dark:border-red-800"},me={class:"flex items-center gap-3"},ge={class:"text-red-600 dark:text-red-400 text-sm"},pe={class:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700"},ye=["disabled"],ve=["disabled"],ke={key:0,class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},xe={key:1,class:"w-4 h-4 mr-2 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},he={__name:"PaymentModal",props:["visible","payment","tenants","banks","editMode"],emits:["save","cancel","close"],setup(v,{emit:w}){const j=v,he=w,{handleNetworkError:fe}=x(),{showCreateSuccess:we,showUpdateSuccess:je}=h(),{emit:Ne}=f(),Ce=e([]),Me=e([]),Be=e({}),Ie=e(!1);e([]);const Se=e([]);e({});const Ae=e=>null==e||isNaN(e)?"₺0.00":Number(e).toLocaleString("tr-TR",{style:"currency",currency:"TRY"}),Te=t(()=>{const e=Object.values(Be.value).reduce((e,t)=>e+Number(t||0),0);return Math.min(e,Number(j.payment.amount||0))}),De=t(()=>Math.max(0,Number(j.payment.amount||0)-Te.value)),Pe=t(()=>j.payment.date&&j.payment.amount>0&&j.payment.bank&&j.payment.tenantId),Le=t(()=>Object.keys(Be.value).some(e=>{const t=Ue(e);if(!t)return!1;const a=Number(t.amount);return Number(Be.value[e]||0)>a})),ze=t(()=>{const e=[];return Object.keys(Be.value).forEach(t=>{const a=Ue(t);if(a){const r=Number(a.amount),l=Number(Be.value[t]||0);l>r&&e.push(`${a.typeLabel}: ${Ae(l-r)} fazla`)}}),e.join(", ")}),Ee=e=>{if(!e)return 0;const t=new Date-new Date(e),a=Math.ceil(t/864e5);return a>0?a:0},Ue=e=>Ce.value.find(t=>t.id===e),He=async()=>{if(j.payment.tenantId)try{const e=await k.getUtilityDebts({tenantId:j.payment.tenantId,status:"Unpaid"});Ce.value=e||[]}catch(e){fe(e,{component:"PaymentModal",action:"fetchTenantDebts"}),Ce.value=[]}},Oe=()=>{if(!j.payment.amount||0===Ce.value.length)return;let e=Number(j.payment.amount);Me.value=[],Be.value={};for(const t of Ce.value){if(e<=0)break;const a=Number(t.amount),r=Math.min(e,a);Me.value.push(t.id),Be.value[t.id]=r,e-=r}if(Me.value.length>1){Me.value.length;const e=Object.values(Be.value).reduce((e,t)=>e+Number(t||0),0);Number(j.payment.amount)}},Ve=()=>{if(Ce.value.length>0){const e=Ce.value[0];Me.value=[e.id],Be.value={[e.id]:Number(e.amount)}}},Ke=()=>{Me.value=[],Be.value={}},Fe=()=>{Object.keys(Be.value).forEach(e=>{Me.value.includes(e)||delete Be.value[e]});let e=Number(j.payment.amount||0);Me.value.forEach(t=>{if(!Be.value[t]){const a=Ue(t);if(a){const r=Number(a.amount)-Number(a.paidAmount||0),l=Math.min(e,r);Be.value[t]=l,e-=l}}});let t=Object.values(Be.value).reduce((e,t)=>e+Number(t||0),0);if(t>Number(j.payment.amount||0)){const e=Me.value[Me.value.length-1];e&&(Be.value[e]-=t-Number(j.payment.amount||0))}},$e=async()=>{if(Pe.value&&!Ie.value&&!Ie.value){Ie.value=!0;try{const e={tenantId:j.payment.tenantId,amount:Number(j.payment.amount),date:j.payment.date,type:j.payment.type,bank:j.payment.bank,description:j.payment.description||"",debtAllocations:Object.keys(Be.value).map(e=>({debtId:e,amountPaid:Number(Be.value[e]||0)})).filter(e=>e.amountPaid>0),advanceAllocations:Object.keys(Se.value).map(e=>({advanceAccountId:e,amount:Number(Se.value[e]||0)})).filter(e=>e.amount>0)},t=await k.createPayment(e);j.editMode?je("Ödeme"):we("Ödeme"),Ne("payment:created",{tenantId:j.payment.tenantId,amount:j.payment.amount,paymentId:t.id}),he("save",t)}catch(e){fe(e,{component:"PaymentModal",action:"savePayment"})}finally{Ie.value=!1}}},Ge=()=>{Ie.value||he("cancel")};return a(()=>j.payment.tenantId,e=>{e&&He()}),a(()=>j.visible,e=>{e&&He()}),r(()=>{}),(e,t)=>(n(),l("dialog",{class:"modal",open:v.visible},[s("div",C,[s("div",M,[t[7]||(t[7]=s("h3",{class:"text-xl font-bold text-gray-800 dark:text-gray-100 flex items-center gap-2"},[s("span",{class:"text-2xl"},"💳"),o(" Akıllı Ödeme Sistemi ")],-1)),s("button",{onClick:t[0]||(t[0]=t=>e.$emit("cancel")),class:"btn btn-sm btn-ghost text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"},t[6]||(t[6]=[s("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),s("form",B,[s("div",I,[t[12]||(t[12]=s("h4",{class:"text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4 flex items-center gap-2"},[s("span",{class:"text-xl"},"🏦"),o(" Banka Hareketi Bilgileri ")],-1)),s("div",S,[s("div",A,[t[8]||(t[8]=s("label",{class:"label"},[s("span",{class:"label-text font-semibold text-gray-700 dark:text-gray-300"},"Hareket Tarihi")],-1)),u(s("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>v.payment.date=e),type:"date",class:"input input-bordered w-full bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-800 dark:text-gray-200 focus:border-blue-500 dark:focus:border-blue-400",required:""},null,512),[[i,v.payment.date]])]),s("div",T,[t[9]||(t[9]=s("label",{class:"label"},[s("span",{class:"label-text font-semibold text-gray-700 dark:text-gray-300"},"Gelen Tutar (₺)")],-1)),u(s("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>v.payment.amount=e),type:"number",step:"0.01",placeholder:"0.00",class:"input input-bordered w-full bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-800 dark:text-gray-200 focus:border-blue-500 dark:focus:border-blue-400",required:""},null,512),[[i,v.payment.amount,void 0,{number:!0}]])]),s("div",D,[t[11]||(t[11]=s("label",{class:"label"},[s("span",{class:"label-text font-semibold text-gray-700 dark:text-gray-300"},"Banka")],-1)),u(s("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>v.payment.bank=e),class:"select select-bordered w-full bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-800 dark:text-gray-200 focus:border-blue-500 dark:focus:border-blue-400",required:""},[t[10]||(t[10]=s("option",{disabled:"",value:""},"Banka Seçin",-1)),(n(!0),l(b,null,m(v.banks,e=>(n(),l("option",{key:e,value:e},g(e),9,P))),128))],512),[[c,v.payment.bank]])])])]),s("div",L,[t[15]||(t[15]=s("h4",{class:"text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4 flex items-center gap-2"},[s("span",{class:"text-xl"},"👤"),o(" Kiracı Seçimi ")],-1)),s("div",z,[t[14]||(t[14]=s("label",{class:"label"},[s("span",{class:"label-text font-semibold text-gray-700 dark:text-gray-300"},"Kiracı")],-1)),u(s("select",{"onUpdate:modelValue":t[4]||(t[4]=e=>v.payment.tenantId=e),onChange:He,class:"select select-bordered w-full bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-800 dark:text-gray-200 focus:border-blue-500 dark:focus:border-blue-400",required:""},[t[13]||(t[13]=s("option",{disabled:"",value:""},"Kiracı seçin",-1)),(n(!0),l(b,null,m(v.tenants,e=>(n(),l("option",{key:e.id,value:e.id},g(e.company||`${e.firstName} ${e.lastName}`),9,E))),128))],544),[[c,v.payment.tenantId]])])]),v.payment.tenantId&&Ce.value.length>0?(n(),l("div",U,[s("div",{class:"flex items-center justify-between mb-4"},[t[19]||(t[19]=s("h4",{class:"text-lg font-semibold text-gray-800 dark:text-gray-100 flex items-center gap-2"},[s("span",{class:"text-xl"},"📋"),o(" Borç Eşleştirme ")],-1)),s("div",{class:"flex gap-2"},[s("button",{type:"button",onClick:Oe,class:"btn btn-sm btn-primary bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 border-0 text-white"},t[16]||(t[16]=[s("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})],-1),o(" Otomatik Eşleştir ")])),s("button",{type:"button",onClick:Ve,class:"btn btn-sm btn-secondary bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 border-0 text-white"},t[17]||(t[17]=[s("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})],-1),o(" Sadece En Eski Borç ")])),s("button",{type:"button",onClick:Ke,class:"btn btn-sm btn-outline border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300"},t[18]||(t[18]=[s("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),o(" Temizle ")]))])]),s("div",H,[(n(!0),l(b,null,m(Ce.value,e=>(n(),l("div",{key:e.id,class:"flex items-center gap-3 p-3 bg-white dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600"},[u(s("input",{type:"checkbox",value:e.id,"onUpdate:modelValue":t[5]||(t[5]=e=>Me.value=e),onChange:Fe,class:"checkbox checkbox-primary"},null,40,O),[[p,Me.value]]),s("div",V,[s("div",K,[s("div",null,[s("p",F,g(e.typeLabel||e.type),1),s("p",$,[o(g(e.period||e.dueDateFormatted)+" ",1),e.unit&&"-"!==e.unit?(n(),l("span",G," ("+g(e.unit)+") ",1)):d("",!0)])]),s("div",Y,[s("p",q,g(Ae(e.amount)),1),s("p",_,g(Ee(e.dueDate))+" gün gecikmiş",1),e.paidAmount>0?(n(),l("p",R,g(Ae(e.amount-e.paidAmount))+" kalan ",1)):d("",!0)])])])]))),128))]),Me.value.length>0?(n(),l("div",W,[t[27]||(t[27]=s("h5",{class:"font-semibold text-gray-800 dark:text-gray-100 mb-2"},"Ödeme Dağılımı",-1)),Me.value.length>1?(n(),l("div",Z,[s("div",J,[t[21]||(t[21]=s("svg",{class:"w-4 h-4 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),s("span",Q,[s("strong",null,g(Me.value.length)+" borç",1),t[20]||(t[20]=o(" otomatik olarak seçildi. Her borç için ödeme tutarını manuel olarak ayarlayabilirsiniz. "))])])])):d("",!0),s("div",X,[(n(!0),l(b,null,m(Me.value,e=>{var t,a,r,c,b,m,p;return n(),l("div",{key:e,class:"flex items-center justify-between"},[s("span",ee,[o(g((null==(t=Ue(e))?void 0:t.typeLabel)||(null==(a=Ue(e))?void 0:a.type))+" ",1),(null==(r=Ue(e))?void 0:r.unit)&&"-"!==(null==(c=Ue(e))?void 0:c.unit)?(n(),l("span",te," ("+g(null==(b=Ue(e))?void 0:b.unit)+") ",1)):d("",!0)]),u(s("input",{type:"number","onUpdate:modelValue":t=>Be.value[e]=t,step:"0.01",class:"input input-sm input-bordered w-24 bg-white dark:bg-gray-600 border-gray-300 dark:border-gray-500 text-gray-800 dark:text-gray-200",max:(null==(m=Ue(e))?void 0:m.amount)-((null==(p=Ue(e))?void 0:p.paidAmount)||0),onInput:t=>(e=>{const t=Ue(e);if(!t)return;const a=Number(t.amount),r=Number(Be.value[e]||0);r<0&&(Be.value[e]=0),r>a&&(Be.value[e]=a);const l=Object.values(Be.value).reduce((e,t)=>e+Number(t||0),0);l>Number(j.payment.amount||0)&&(Be.value[e]-=l-Number(j.payment.amount||0))})(e)},null,40,ae),[[i,Be.value[e]]])])}),128))]),s("div",re,[t[22]||(t[22]=s("span",{class:"font-semibold text-gray-800 dark:text-gray-100"},"Toplam Seçilen:",-1)),s("span",le,g(Ae(Te.value)),1)]),s("div",ne,[t[23]||(t[23]=s("span",{class:"font-semibold text-gray-800 dark:text-gray-100"},"Gelen Tutar:",-1)),s("span",se,g(Ae(v.payment.amount||0)),1)]),s("div",oe,[t[24]||(t[24]=s("span",{class:"font-semibold text-gray-800 dark:text-gray-100"},"Kalan:",-1)),s("span",{class:y([De.value>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400","font-bold"])},g(Ae(De.value)),3)]),De.value>0?(n(),l("div",de,[s("div",ue,[t[26]||(t[26]=s("svg",{class:"w-4 h-4 text-amber-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"})],-1)),s("span",ie,[s("strong",null,g(Ae(De.value)),1),t[25]||(t[25]=o(" avans hesabına aktarılacak. Gelecekteki borçlardan otomatik düşülecek. "))])])])):d("",!0)])):d("",!0)])):d("",!0),v.payment.tenantId&&0===Ce.value.length?(n(),l("div",ce,t[28]||(t[28]=[s("div",{class:"flex items-center gap-3"},[s("svg",{class:"w-6 h-6 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})]),s("p",{class:"text-green-700 dark:text-green-300"},"Seçilen kiracının ödenmemiş borcu bulunmuyor.")],-1)]))):d("",!0),Le.value?(n(),l("div",be,[s("div",me,[t[30]||(t[30]=s("svg",{class:"w-6 h-6 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})],-1)),s("div",null,[t[29]||(t[29]=s("p",{class:"text-red-700 dark:text-red-300 font-semibold"},"Fazla Ödeme Uyarısı",-1)),s("p",ge,g(ze.value),1)])])])):d("",!0),s("div",pe,[s("button",{type:"button",class:"btn btn-outline border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700",onClick:Ge,disabled:Ie.value},[t[31]||(t[31]=s("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)),o(" "+g(Ie.value?"İşlem Devam Ediyor...":"İptal"),1)],8,ye),s("button",{type:"button",class:"btn btn-success bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 border-0 text-white shadow-lg",disabled:!Pe.value||Ie.value,onClick:$e},[Ie.value?(n(),l("svg",xe,t[33]||(t[33]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)]))):(n(),l("svg",ke,t[32]||(t[32]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)]))),o(" "+g(Ie.value?"Kaydediliyor...":"Ödemeyi Kaydet"),1)],8,ve)])])])],8,N))}},fe={class:"p-4 sm:p-6 bg-gray-50 min-h-screen font-sans dark:bg-gray-900"},we={class:"max-w-7xl mx-auto"},je={class:"flex items-center justify-between mb-6"},Ne={class:"flex items-center gap-4"},Ce={class:"bg-green-100 dark:bg-green-900/50 text-green-600 dark:text-green-400 px-3 py-1 rounded-full text-sm"},Me={class:"bg-blue-100 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400 px-3 py-1 rounded-full text-sm"},Be={class:"bg-purple-100 dark:bg-purple-900/50 text-purple-600 dark:text-purple-400 px-3 py-1 rounded-full text-sm"},Ie={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8"},Se={class:"bg-white dark:bg-gray-800 p-5 rounded-xl shadow-md flex items-center gap-4 border border-gray-200 dark:border-gray-700"},Ae={class:"text-2xl font-bold text-gray-800 dark:text-gray-100"},Te={class:"bg-white dark:bg-gray-800 p-5 rounded-xl shadow-md flex items-center gap-4 border border-gray-200 dark:border-gray-700"},De={class:"text-2xl font-bold text-gray-800 dark:text-gray-100"},Pe={class:"bg-white dark:bg-gray-800 p-5 rounded-xl shadow-md flex items-center gap-4 border border-gray-200 dark:border-gray-700"},Le={class:"text-2xl font-bold text-gray-800 dark:text-gray-100"},ze={class:"bg-white dark:bg-gray-800 p-5 rounded-xl shadow-md flex items-center gap-4 border border-gray-200 dark:border-gray-700"},Ee={class:"text-2xl font-bold text-gray-800 dark:text-gray-100"},Ue={class:"mb-6"},He={key:0,class:"bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md border border-gray-200 dark:border-gray-700 mb-6"},Oe={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},Ve={class:"flex items-center justify-between mb-2"},Ke={class:"font-semibold text-gray-800 dark:text-gray-100"},Fe={class:"text-2xl font-bold text-purple-600 dark:text-purple-400 mb-1"},$e={class:"text-sm text-gray-600 dark:text-gray-400"},Ge={class:"bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md border border-gray-200 dark:border-gray-700"},Ye={class:"mt-6 space-y-2"},qe={key:0,class:"text-center py-12 text-gray-500 dark:text-gray-400"},_e={key:1},Re={class:"md:col-span-5 flex items-center gap-4"},We={class:"font-bold text-gray-800 dark:text-gray-100"},Ze={class:"text-sm text-gray-500 dark:text-gray-400"},Je={class:"md:col-span-3 text-left md:text-center text-2xl font-semibold text-green-600 dark:text-green-400"},Qe={class:"md:col-span-2 text-left md:text-center text-sm text-gray-600 dark:text-gray-300"},Xe={class:"font-semibold text-gray-800 dark:text-gray-100"},et={key:0,class:"badge badge-primary badge-sm"},tt={key:1},at={class:"md:col-span-2 text-right"},rt={class:"dropdown dropdown-end"},lt={tabindex:"0",class:"dropdown-content menu p-2 shadow bg-base-200 rounded-box w-32 z-10"},nt=["onClick"],st=["onClick"],ot={__name:"Payments",setup(a){const{handleNetworkError:u}=x(),{showCreateSuccess:i,showDeleteSuccess:c}=h(),p=e([]),f=e([]),N=e([]),C=e(["Ziraat","İş Bankası","Garanti","Yapı Kredi","Halkbank"]),M=e(!1);e(!0);const B=e({searchTerm:"",period:""}),I=e=>null==e||isNaN(e)?"₺0.00":Number(e).toLocaleString("tr-TR",{style:"currency",currency:"TRY"}),S=t(()=>p.value.reduce((e,t)=>e+Number(t.amount||0),0)),A=t(()=>{const e=new Date,t=e.getFullYear()+"-"+String(e.getMonth()+1).padStart(2,"0");return p.value.filter(e=>e.date.startsWith(t)).reduce((e,t)=>e+Number(t.amount||0),0)}),T=t(()=>{const e=new Date,t=e.getFullYear()+"-"+String(e.getMonth()+1).padStart(2,"0");return p.value.filter(e=>e.date.startsWith(t)).length}),D=t(()=>p.value.length),P=t(()=>N.value.reduce((e,t)=>e+Number(t.amount||0),0)),L=e=>{if(!e)return"bg-gray-500";const t=["bg-blue-500","bg-purple-500","bg-amber-500","bg-emerald-500","bg-red-500","bg-pink-500","bg-indigo-500","bg-teal-500"];return t[e.split("").reduce((e,t)=>e+t.charCodeAt(0),0)%t.length]},z=t(()=>{let e=p.value;const t=B.value.searchTerm.toLowerCase();return B.value.period&&(e=e.filter(e=>e.date.startsWith(B.value.period))),t&&(e=e.filter(e=>e.amount.toString().includes(t)||K(e.tenantId).toLowerCase().includes(t)||e.type.toLowerCase().includes(t)||e.bank.toLowerCase().includes(t))),e.sort((e,t)=>new Date(t.date)-new Date(e.date))}),E=e({date:(new Date).toISOString().substring(0,10),tenantId:"",amount:null,type:"",bank:""}),U=e(!1),H=e(null),O=async()=>{try{const e=await k.getPayments();p.value=e}catch(e){u(e,{component:"Payments",action:"fetchPayments"})}},V=async()=>{try{const e=(await k.getAdvanceAccounts()).filter(e=>e.balance>0);N.value=e}catch(e){N.value=[],u(e,{component:"Payments",action:"fetchAdvanceAccounts"})}},K=e=>{const t=f.value.find(t=>t.id===e);return t?t.company||`${t.firstName} ${t.lastName}`:"Bilinmiyor"},F=()=>{M.value=!1,E.value={date:(new Date).toISOString().substring(0,10),tenantId:"",amount:null,type:"",bank:""},U.value=!1,H.value=null},$=()=>{B.value={searchTerm:"",period:""},O()},G=async()=>{M.value=!1,E.value={date:(new Date).toISOString().substring(0,10),tenantId:"",amount:null,type:"",bank:""},U.value=!1,H.value=null,await Promise.all([O(),V()]),i("Ödeme")};return r(()=>{(async()=>{try{const e=await j.getTenants();f.value=e}catch(e){u(e,{component:"Payments",action:"fetchTenants"})}})(),V(),O()}),(e,t)=>(n(),l("div",fe,[s("div",we,[s("div",je,[t[3]||(t[3]=s("h1",{class:"text-3xl font-bold text-gray-800 dark:text-gray-100"},"Kiracı Ödemeleri",-1)),s("div",Ne,[s("div",Ce," Toplam: "+g(I(S.value)),1),s("div",Me," Bu Ay: "+g(I(A.value)),1),s("div",Be,g(D.value)+" ödeme ",1)])]),s("section",Ie,[s("div",Se,[t[5]||(t[5]=s("div",{class:"bg-green-100 dark:bg-green-900/50 text-green-600 dark:text-green-400 rounded-full p-3"},[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})])],-1)),s("div",null,[t[4]||(t[4]=s("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Bu Ayki Gelir",-1)),s("p",Ae,g(I(A.value)),1)])]),s("div",Te,[t[7]||(t[7]=s("div",{class:"bg-blue-100 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400 rounded-full p-3"},[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"})])],-1)),s("div",null,[t[6]||(t[6]=s("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Toplam Gelir",-1)),s("p",De,g(I(S.value)),1)])]),s("div",Pe,[t[9]||(t[9]=s("div",{class:"bg-amber-100 dark:bg-amber-900/50 text-amber-600 dark:text-amber-400 rounded-full p-3"},[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),s("div",null,[t[8]||(t[8]=s("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Bu Ayki İşlem Sayısı",-1)),s("p",Le,g(T.value),1)])]),s("div",ze,[t[11]||(t[11]=s("div",{class:"bg-purple-100 dark:bg-purple-900/50 text-purple-600 dark:text-purple-400 rounded-full p-3"},[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"})])],-1)),s("div",null,[t[10]||(t[10]=s("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Toplam Avans",-1)),s("p",Ee,g(I(P.value)),1)])])]),s("div",Ue,[s("button",{onClick:t[0]||(t[0]=e=>M.value=!0),class:"w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-semibold py-4 px-6 rounded-xl shadow-lg transition-all duration-300 flex items-center justify-center gap-3"},t[12]||(t[12]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1),s("span",null,"Yeni Ödeme Ekle",-1)]))]),N.value.length>0?(n(),l("div",He,[t[14]||(t[14]=s("h3",{class:"text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4 flex items-center gap-2"},[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-purple-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"})]),o(" Avans Hesapları ")],-1)),s("div",Oe,[(n(!0),l(b,null,m(N.value,e=>(n(),l("div",{key:e.id,class:"bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg border border-purple-200 dark:border-purple-800"},[s("div",Ve,[s("span",Ke,g(K(e.tenantId)),1),t[13]||(t[13]=s("span",{class:"badge badge-success badge-sm"},"Aktif",-1))]),s("p",Fe,g(I(e.amount)),1),s("p",$e,g(e.paymentDate),1)]))),128))])])):d("",!0),s("div",Ge,[v(w,{search:B.value.searchTerm,"onUpdate:search":t[1]||(t[1]=e=>B.value.searchTerm=e),"search-placeholder":"Firma, tutar, tip veya banka ara...",period:B.value.period,"onUpdate:period":t[2]||(t[2]=e=>B.value.period=e),onClearFilters:$},null,8,["search","period"]),s("div",Ye,[0===z.value.length?(n(),l("div",qe,t[15]||(t[15]=[s("p",null,"Aramanızla eşleşen ödeme bulunamadı.",-1)]))):(n(),l("div",_e,[(n(!0),l(b,null,m(z.value,e=>{return n(),l("div",{key:e.id,class:"grid grid-cols-1 md:grid-cols-12 gap-4 items-center p-4 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors duration-200 border-b dark:border-gray-700/50"},[s("div",Re,[s("div",{class:y(["flex-shrink-0 h-12 w-12 flex items-center justify-center text-white rounded-full text-xl font-bold",L(K(e.tenantId))])},g((a=K(e.tenantId),a&&"Bilinmiyor"!==a?a.charAt(0).toUpperCase():"?")),3),s("div",null,[s("p",We,g(K(e.tenantId)),1),s("p",Ze,g(e.date),1)])]),s("div",Je,g(I(e.amount)),1),s("div",Qe,[s("p",Xe,["Karma"===e.type?(n(),l("span",et,"Karma Ödeme")):(n(),l("span",tt,g(e.type),1))]),s("p",null,g(e.bank),1)]),s("div",at,[s("div",rt,[t[16]||(t[16]=s("label",{tabindex:"0",class:"btn btn-ghost btn-sm"},"İşlemler",-1)),s("ul",lt,[s("li",null,[s("a",{onClick:t=>{return a=e,E.value={...a},H.value=a.id,U.value=!0,void(M.value=!0);var a}},"Düzenle",8,nt)]),s("li",null,[s("a",{onClick:t=>(async e=>{try{await k.deletePayment(e),c("Ödeme"),await O(),await V()}catch(t){u(t,{component:"Payments",action:"deletePayment"})}})(e.id),class:"text-red-500"},"Sil",8,st)])])])])]);var a}),128))]))])])]),v(he,{visible:M.value,payment:E.value,tenants:f.value,banks:C.value,editMode:U.value,onSave:G,onCancel:F},null,8,["visible","payment","tenants","banks","editMode"])]))}};export{ot as default};
