import{r as e,C as a,w as t,o as l,c as n,l as i,b as s,e as o,p as d,t as r,q as u,D as p,E as b,F as c,i as m,H as v,n as y,V as g}from"./vue-vendor-C74T0G6D.js";import{a as f}from"./index-C-WeNbY_.js";import{u as w}from"./utilityDebtsService-CRQj309-.js";import{u as h}from"./useErrorHandler-3PH04EMR.js";const x=["onKeydown"],k={class:"modal-box max-w-2xl bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 shadow-2xl p-0"},D={class:"flex items-center justify-between p-6 border-b border-gray-100 dark:border-gray-700"},I={class:"flex items-center gap-3"},S={key:0},M={key:1},U={key:2},V={class:"text-xl font-bold text-gray-800 dark:text-gray-100"},C=["disabled"],Y={key:0,class:"tabs tabs-boxed bg-transparent px-6 pt-4 gap-2"},N={class:"p-6"},j={class:"form-control"},T=["disabled"],q=["value"],O={class:"grid grid-cols-2 gap-4"},B={class:"form-control"},F={class:"form-control"},K=["value"],$={class:"grid grid-cols-2 gap-4"},A={class:"form-control"},G={class:"form-control"},z={class:"form-control"},E={class:"flex justify-end gap-3 pt-6 border-t border-gray-200 dark:border-gray-700"},_=["disabled"],H=["disabled"],L={key:0,class:"loading loading-spinner loading-xs mr-2"},J={key:1,class:"space-y-6"},P={class:"grid grid-cols-2 gap-4 p-4 bg-gray-50 dark:bg-gray-900 rounded-xl"},Q={class:"form-control"},R={class:"form-control"},W={class:"overflow-x-auto max-h-[40vh] border border-gray-200 dark:border-gray-700 rounded-lg"},X={class:"table table-zebra table-sm"},Z={class:"whitespace-nowrap"},ee={class:"font-bold"},ae={class:"text-[10px] opacity-60"},te=["id","name","onUpdate:modelValue"],le=["id","name","onUpdate:modelValue"],ne={class:"flex justify-end gap-3 pt-6 border-t border-gray-200 dark:border-gray-700"},ie=["disabled"],se=["disabled"],oe={key:0,class:"loading loading-spinner loading-xs mr-2"},de={__name:"ManualDebtModal",props:{type:{type:Number,required:!0},initialData:{type:Object,default:null}},emits:["close","refresh"],setup(de,{emit:re}){const ue=de,pe=re,{showSuccess:be}=h(),ce=e(!1),me=e([]),ve=e("individual"),ye=e({id:null,flatId:"",type:ue.type,periodYear:(new Date).getFullYear(),periodMonth:(new Date).getMonth()+1,amount:0,dueDate:new Date((new Date).getFullYear(),(new Date).getMonth()+1,15).toISOString().split("T")[0],description:""}),ge=e((new Date).toISOString().substring(0,7)),fe=e(new Date((new Date).getFullYear(),(new Date).getMonth()+1,15).toISOString().split("T")[0]),we=e([]),he=a(()=>0===ue.type?"Aidat":1===ue.type?"Elektrik":"Su"),xe=a(()=>we.value.some(e=>e.amount>0));t(we,e=>{e.filter(e=>e.amount>0).length},{deep:!0});const ke=()=>{const[e,a]=ge.value.split("-").map(Number),t=new Date(e,a,15);fe.value=t.toISOString().split("T")[0]},De=()=>{ce.value||pe("close")},Ie=async()=>{ce.value=!0;try{const e={...ye.value};if(ue.initialData)e.tenantId=ue.initialData.tenantId,e.ownerId=ue.initialData.ownerId;else{const a=me.value.find(e=>e.id===ye.value.flatId);a&&(e.tenantId=a.tenantId||null,e.ownerId=a.ownerId||null)}e.id?(await w.updateUtilityDebt(e.id,e),be(`${he.value} borcu gÃ¼ncellendi.`)):(await w.createUtilityDebt(e),be(`Yeni ${he.value} borcu eklendi.`)),pe("refresh"),pe("close")}catch(e){}finally{ce.value=!1}},Se=async()=>{const e=we.value.filter(e=>e.amount>0);if(e.length){ce.value=!0;try{const[a,t]=ge.value.split("-").map(Number),l=e.map(e=>({flatId:e.id,type:ue.type,periodYear:a,periodMonth:t,amount:e.amount,dueDate:fe.value,description:e.description||`Toplu ${he.value} giriÅŸi`,tenantId:e.tenantId,ownerId:e.ownerId}));await w.createBulkUtilityDebts(l),be(`${l.length} adet ${he.value} borcu toplu olarak eklendi.`),pe("refresh"),pe("close")}catch(a){}finally{ce.value=!1}}};return l(()=>{(async()=>{try{const e=(await f.get("/flats")||[]).sort((e,a)=>(e.code||"").localeCompare(a.code||""));me.value=e,we.value=e.map(e=>({id:e.id,code:e.code||e.unitNumber,tenantName:e.tenantCompanyName,tenantId:e.tenantId,ownerId:e.ownerId,amount:0,description:""}))}catch(e){}})(),ue.initialData&&(ye.value={...ye.value,...ue.initialData,dueDate:ue.initialData.dueDate?new Date(ue.initialData.dueDate).toISOString().split("T")[0]:ye.value.dueDate,periodYear:ue.initialData.periodYear||(new Date).getFullYear(),periodMonth:ue.initialData.periodMonth||(new Date).getMonth()+1})}),(e,a)=>{var t,l,f;return i(),n("dialog",{open:"",class:"modal",onKeydown:g(u(De,["prevent"]),["esc"])},[s("div",k,[s("div",D,[s("div",I,[s("div",{class:d(["rounded-full p-2 text-white shadow-md",0===de.type?"bg-emerald-600":1===de.type?"bg-amber-500":"bg-blue-500"])},[0===de.type?(i(),n("span",S,"ðŸ“‹")):1===de.type?(i(),n("span",M,"âš¡")):(i(),n("span",U,"ðŸ’§"))],2),s("h3",V," Manuel "+r(he.value)+" GiriÅŸi ",1)]),s("button",{onClick:De,class:"btn btn-ghost btn-sm",disabled:ce.value},a[10]||(a[10]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,C)]),(null==(t=de.initialData)?void 0:t.id)?o("",!0):(i(),n("div",Y,[s("button",{onClick:a[0]||(a[0]=e=>ve.value="individual"),class:d(["tab flex-1 transition-all","individual"===ve.value?"tab-active bg-primary text-white":"hover:bg-gray-100 dark:hover:bg-gray-700"])}," ðŸ‘¤ Bireysel GiriÅŸ ",2),s("button",{onClick:a[1]||(a[1]=e=>ve.value="bulk"),class:d(["tab flex-1 transition-all","bulk"===ve.value?"tab-active bg-primary text-white":"hover:bg-gray-100 dark:hover:bg-gray-700"])}," ðŸ‘¥ Toplu GiriÅŸ ",2)])),s("div",N,["individual"===ve.value?(i(),n("form",{key:0,onSubmit:u(Ie,["prevent"]),class:"space-y-5"},[s("div",j,[a[12]||(a[12]=s("label",{class:"label"},[s("span",{class:"label-text font-semibold text-gray-700 dark:text-gray-300"},"Daire / Ãœnite *")],-1)),p(s("select",{"onUpdate:modelValue":a[2]||(a[2]=e=>ye.value.flatId=e),class:"select select-bordered w-full bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600",required:"",disabled:!!(null==(l=de.initialData)?void 0:l.id)},[a[11]||(a[11]=s("option",{disabled:"",value:""},"Daire seÃ§iniz",-1)),(i(!0),n(c,null,m(me.value,e=>(i(),n("option",{key:e.id,value:e.id},r(e.code||e.unitNumber)+" ("+r(e.tenantCompanyName||"BoÅŸ")+") ",9,q))),128))],8,T),[[b,ye.value.flatId]])]),s("div",O,[s("div",B,[a[13]||(a[13]=s("label",{class:"label"},[s("span",{class:"label-text font-semibold"},"YÄ±l *")],-1)),p(s("input",{type:"number","onUpdate:modelValue":a[3]||(a[3]=e=>ye.value.periodYear=e),class:"input input-bordered w-full",required:"",min:"2020"},null,512),[[v,ye.value.periodYear,void 0,{number:!0}]])]),s("div",F,[a[14]||(a[14]=s("label",{class:"label"},[s("span",{class:"label-text font-semibold"},"Ay *")],-1)),p(s("select",{"onUpdate:modelValue":a[4]||(a[4]=e=>ye.value.periodMonth=e),class:"select select-bordered w-full",required:""},[(i(),n(c,null,m(12,e=>s("option",{key:e,value:e},r(e),9,K)),64))],512),[[b,ye.value.periodMonth,void 0,{number:!0}]])])]),s("div",$,[s("div",A,[a[15]||(a[15]=s("label",{class:"label"},[s("span",{class:"label-text font-semibold"},"Tutar (â‚º) *")],-1)),p(s("input",{type:"number","onUpdate:modelValue":a[5]||(a[5]=e=>ye.value.amount=e),step:"0.01",class:"input input-bordered w-full text-lg font-bold text-success",required:"",min:"0"},null,512),[[v,ye.value.amount,void 0,{number:!0}]])]),s("div",G,[a[16]||(a[16]=s("label",{class:"label"},[s("span",{class:"label-text font-semibold"},"Son Ã–deme *")],-1)),p(s("input",{type:"date","onUpdate:modelValue":a[6]||(a[6]=e=>ye.value.dueDate=e),class:"input input-bordered w-full",required:""},null,512),[[v,ye.value.dueDate]])])]),s("div",z,[a[17]||(a[17]=s("label",{class:"label"},[s("span",{class:"label-text font-semibold"},"AÃ§Ä±klama")],-1)),p(s("textarea",{"onUpdate:modelValue":a[7]||(a[7]=e=>ye.value.description=e),class:"textarea textarea-bordered h-20",placeholder:"Opsiyonel notlar..."},null,512),[[v,ye.value.description]])]),s("div",E,[s("button",{type:"button",class:"btn btn-outline btn-sm",onClick:De,disabled:ce.value},"Ä°ptal",8,_),s("button",{type:"submit",class:"btn btn-primary btn-sm px-8",disabled:ce.value},[ce.value?(i(),n("span",L)):o("",!0),y(" "+r((null==(f=de.initialData)?void 0:f.id)?"GÃ¼ncelle":"Kaydet"),1)],8,H)])],32)):(i(),n("div",J,[s("div",P,[s("div",Q,[a[18]||(a[18]=s("label",{class:"label"},[s("span",{class:"label-text font-semibold"},"DÃ¶nem")],-1)),p(s("input",{type:"month","onUpdate:modelValue":a[8]||(a[8]=e=>ge.value=e),class:"input input-bordered w-full input-sm",onChange:ke},null,544),[[v,ge.value]])]),s("div",R,[a[19]||(a[19]=s("label",{class:"label"},[s("span",{class:"label-text font-semibold"},"Son Ã–deme")],-1)),p(s("input",{type:"date","onUpdate:modelValue":a[9]||(a[9]=e=>fe.value=e),class:"input input-bordered w-full input-sm"},null,512),[[v,fe.value]])])]),s("div",W,[s("table",X,[a[20]||(a[20]=s("thead",{class:"sticky top-0 bg-white dark:bg-gray-800 z-10 shadow-sm"},[s("tr",null,[s("th",{class:"w-1/3"},"Daire / KiracÄ±"),s("th",{class:"w-1/3 text-center"},"Tutar (â‚º)"),s("th",{class:"w-1/3"},"AÃ§Ä±klama")])],-1)),s("tbody",null,[(i(!0),n(c,null,m(we.value,e=>(i(),n("tr",{key:e.id},[s("td",Z,[s("div",ee,r(e.code),1),s("div",ae,r(e.tenantName||"BoÅŸ"),1)]),s("td",null,[p(s("input",{id:"bulk-amount-"+e.id,name:"bulk-amount-"+e.id,type:"number","onUpdate:modelValue":a=>e.amount=a,min:"0",step:"0.01",class:"input input-bordered input-xs w-full text-center font-bold text-success",placeholder:"0.00",autocomplete:"off"},null,8,te),[[v,e.amount,void 0,{number:!0}]])]),s("td",null,[p(s("input",{id:"bulk-desc-"+e.id,name:"bulk-desc-"+e.id,"onUpdate:modelValue":a=>e.description=a,class:"input input-bordered input-xs w-full",placeholder:"Not...",autocomplete:"off"},null,8,le),[[v,e.description]])])]))),128))])])]),s("div",ne,[s("button",{type:"button",class:"btn btn-outline btn-sm",onClick:De,disabled:ce.value},"Ä°ptal",8,ie),s("button",{onClick:Se,class:"btn btn-primary btn-sm px-8",disabled:ce.value||!xe.value},[ce.value?(i(),n("span",oe)):o("",!0),a[21]||(a[21]=y(" Toplu Kaydet "))],8,se)])]))])])],40,x)}}};export{de as _};
