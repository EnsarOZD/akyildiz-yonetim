import{e,u as a,R as t}from"./index-C-WeNbY_.js";import{J as l,w as r,r as s,C as n,o,a as d,c as i,e as u,l as c,b,n as m,D as g,K as v,E as p,F as y,i as x,t as k,H as h,G as f,I as w,p as A,u as D,d as M,f as C,x as I}from"./vue-vendor-C74T0G6D.js";import{p as j}from"./paymentsService-BRWY_5RO.js";import{o as B}from"./ownersService-DmE85ur1.js";import{u as N}from"./utilityDebtsService-CRQj309-.js";import{u as S,a as T}from"./useErrorHandler-3PH04EMR.js";import{_ as V}from"./CustomFilterBar-DAYFRPMz.js";import{t as P,_ as U,L as z,s as F}from"./AdvanceAccountManager-BA7QXoPh.js";import{t as L}from"./tenantsService-COb7ls1o.js";import{f as E}from"./utils-vendor-DKZIJpv7.js";import{a as H,e as R,g as Y,b as K,p as O,c as _}from"./enums-CeMB0k1K.js";import{u as G,f as $,g as q,a as J}from"./uiHelpers-CScyf4mM.js";import"./tenantsService-fWeC8dko.js";const W={key:0,class:"modal",open:""},Z={class:"modal-box max-w-4xl bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-900 border border-gray-200 dark:border-gray-700 shadow-2xl"},Q={class:"flex items-center justify-between pb-4 border-b border-gray-200 dark:border-gray-700 mb-6"},X={class:"space-y-6"},ee={class:"form-control"},ae={class:"flex gap-4"},te={class:"flex items-center gap-2"},le={class:"flex items-center gap-2"},re={key:0,class:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4 border border-green-200 dark:border-green-800"},se={class:"form-control"},ne=["value"],oe={key:1,class:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 border border-blue-200 dark:border-blue-800"},de={class:"form-control"},ie=["value"],ue={class:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 border border-blue-200 dark:border-blue-800"},ce={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},be={class:"form-control"},me={class:"form-control"},ge={class:"form-control"},ve={class:"form-control"},pe=["value"],ye={key:2,class:"bg-amber-50 dark:bg-amber-900/20 rounded-lg p-4 border border-amber-200 dark:border-amber-800"},xe={class:"flex items-center justify-between mb-4"},ke={class:"flex gap-2"},he={class:"mb-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded border border-blue-200 dark:border-blue-800"},fe={class:"flex items-center gap-2"},we={class:"text-sm text-blue-700 dark:text-blue-300"},Ae={key:0},De={key:1},Me={key:0,class:"space-y-3 max-h-64 overflow-y-auto"},Ce=["value"],Ie={class:"flex-1"},je={class:"flex items-center justify-between"},Be={class:"font-semibold text-gray-800 dark:text-gray-100"},Ne={class:"text-sm text-gray-600 dark:text-gray-400"},Se={key:0,class:"ml-2 text-blue-600 dark:text-blue-400"},Te={class:"text-right"},Ve={class:"font-bold text-red-600 dark:text-red-400"},Pe={class:"text-xs text-gray-500 dark:text-gray-400"},Ue={key:0,class:"text-xs text-yellow-600 dark:text-yellow-400"},ze={key:0,class:"mt-2"},Fe=["onUpdate:modelValue","max"],Le={key:1,class:"mt-4 p-3 bg-white dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600"},Ee={class:"space-y-2"},He={class:"flex justify-between items-center"},Re={class:"font-semibold text-gray-800 dark:text-gray-100"},Ye={class:"flex justify-between items-center"},Ke={class:"font-semibold text-gray-800 dark:text-gray-100"},Oe={class:"flex justify-between items-center"},_e={class:"font-semibold text-primary"},Ge={key:3,class:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4 border border-green-200 dark:border-green-800"},$e={class:"flex items-center gap-3"},qe={class:"text-green-600 dark:text-green-400 text-sm"},Je={key:4,class:"bg-red-50 dark:bg-red-900/20 rounded-lg p-4 border border-red-200 dark:border-red-800 mb-2"},We={class:"flex items-center gap-3"},Ze={class:"text-red-700 dark:text-red-300 font-semibold"},Qe={class:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700"},Xe=["disabled"],ea=["disabled"],aa={key:0,class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ta={key:1,class:"w-4 h-4 mr-2 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},la={__name:"PaymentModal",props:{visible:{type:Boolean,default:!1},payment:{type:Object,default:()=>({tenantId:null,ownerId:null,amount:null,date:"",type:"",bank:"",description:""})},tenants:{type:Array,default:()=>[]},banks:{type:Array,default:()=>[]},editMode:{type:Boolean,default:!1}},emits:["save","cancel","close"],setup(e,{emit:a}){const t=e,A=a,{handleNetworkError:D}=S(),M=l({tenantId:null,ownerId:null,amount:null,date:"",type:"",bank:"",description:""});r(()=>t.payment,e=>{Object.assign(M,e||{})},{immediate:!0,deep:!0});const C=s([]),I=n(()=>t.tenants||[]),T=n(()=>t.banks||[]),V=s("tenant");r(()=>t.payment,e=>{(null==e?void 0:e.ownerId)?V.value="owner":(null==e?void 0:e.tenantId)&&(V.value="tenant")},{immediate:!0});const P=s([]),U=s([]),z=s(!0),F=s({}),L=e=>{z.value=e,e&&(U.value=[],F.value={})},E=n(()=>U.value.reduce((e,a)=>e+(Number(F.value[a])||0),0)),H=()=>{U.value=[],F.value={}},R=()=>{},Y=s(!1),K=s(""),O=e=>Number(e||0).toLocaleString("tr-TR",{style:"currency",currency:"TRY"}),_=e=>{if(!e)return 0;const a=new Date,t=new Date(e),l=Math.ceil((a-t)/864e5);return l>0?l:0},G=n(()=>!!M.date&&Number(M.amount)>0&&""!==M.type&&!!M.bank&&("tenant"===V.value&&!!M.tenantId||"owner"===V.value&&!!M.ownerId)),$=async()=>{if(M.tenantId)try{const e=await N.getUtilityDebts({tenantId:M.tenantId,status:"Unpaid"});P.value=e||[]}catch(e){D(e,{component:"PaymentModal",action:"fetchTenantDebts"}),P.value=[]}},q=async()=>{if(M.ownerId)try{const e=await N.getUtilityDebts({ownerId:M.ownerId,status:"Unpaid"});P.value=e||[]}catch(e){D(e,{component:"PaymentModal",action:"fetchOwnerDebts"}),P.value=[]}},J=async()=>{if(!G.value)return K.value="LÃ¼tfen tÃ¼m zorunlu alanlarÄ± doldurun ve geÃ§erli bir tutar girin.",void ra(K.value);Y.value=!0,K.value="";try{const e={tenantId:"tenant"===V.value?M.tenantId:null,ownerId:"owner"===V.value?M.ownerId:null,amount:Number(M.amount),paymentDate:M.date,type:parseInt(M.type)||0,bank:M.bank,description:M.description||"",autoAllocate:z.value,debtAllocations:z.value?[]:U.value.map(e=>({debtId:e,amount:Number(F.value[e]||0)}))},a=await j.createPaymentWithAllocation(e);A("save",a)}catch(e){try{D(e,{component:"PaymentModal",action:"savePayment"})}catch{ra("Ã–deme kaydedilirken bir hata oluÅŸtu.")}}finally{Y.value=!1}},la=()=>{P.value=[],U.value=[],F.value={},Y.value=!1,K.value="",A("cancel")};function ra(e){try{"undefined"!=typeof window&&window.$toast?window.$toast.error(e):alert(e)}catch{alert(e)}}const sa=e=>{t.visible&&"Escape"===e.key&&la()};return o(async()=>{window.addEventListener("keydown",sa);try{const e=await B.getOwners();C.value=e||[]}catch{C.value=[]}"tenant"===V.value?await $():await q()}),d(()=>{window.removeEventListener("keydown",sa)}),r(V,e=>{"tenant"===e?$():q()}),r(()=>M.tenantId,()=>{"tenant"===V.value&&$()}),r(()=>M.ownerId,()=>{"owner"===V.value&&q()}),(a,t)=>e.visible?(c(),i("dialog",W,[b("div",Z,[b("div",Q,[t[13]||(t[13]=b("h3",{class:"text-xl font-bold text-gray-800 dark:text-gray-100 flex items-center gap-2"},[b("span",{class:"text-2xl"},"ğŸ’³"),m(" AkÄ±llÄ± Ã–deme Sistemi ")],-1)),b("button",{onClick:t[0]||(t[0]=e=>a.$emit("cancel")),class:"btn btn-sm btn-ghost text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"},t[12]||(t[12]=[b("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[b("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),b("form",X,[b("div",ee,[t[16]||(t[16]=b("label",{class:"label"},[b("span",{class:"label-text font-semibold text-gray-700 dark:text-gray-300"},"Ã–deme TÃ¼rÃ¼")],-1)),b("div",ae,[b("label",te,[g(b("input",{type:"radio",value:"tenant","onUpdate:modelValue":t[1]||(t[1]=e=>V.value=e)},null,512),[[v,V.value]]),t[14]||(t[14]=b("span",null,"KÄ°RACI",-1))]),b("label",le,[g(b("input",{type:"radio",value:"owner","onUpdate:modelValue":t[2]||(t[2]=e=>V.value=e)},null,512),[[v,V.value]]),t[15]||(t[15]=b("span",null,"MAL SAHÄ°BÄ°",-1))])])]),"tenant"===V.value?(c(),i("div",re,[t[19]||(t[19]=b("h4",{class:"text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4 flex items-center gap-2"},[b("span",{class:"text-xl"},"ğŸ‘¤"),m(" KiracÄ± SeÃ§imi ")],-1)),b("div",se,[t[18]||(t[18]=b("label",{class:"label"},[b("span",{class:"label-text font-semibold text-gray-700 dark:text-gray-300"},"KiracÄ±")],-1)),g(b("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>M.tenantId=e),onChange:$,class:"select select-bordered w-full bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-800 dark:text-gray-200 focus:border-blue-500 dark:focus:border-blue-400",required:""},[t[17]||(t[17]=b("option",{disabled:"",value:""},"KiracÄ± seÃ§in",-1)),(c(!0),i(y,null,x(I.value,e=>{return c(),i("option",{key:e.id,value:e.id},k((null==(a=e)?void 0:a.companyName)||(null==a?void 0:a.company)||(null==a?void 0:a.contactPersonName)||(null==a?void 0:a.fullName)||[null==a?void 0:a.firstName,null==a?void 0:a.lastName].filter(Boolean).join(" ")||(null==a?void 0:a.email)||`#${null==a?void 0:a.id}`),9,ne);var a}),128))],544),[[p,M.tenantId]])])])):u("",!0),"owner"===V.value?(c(),i("div",oe,[t[22]||(t[22]=b("h4",{class:"text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4 flex items-center gap-2"},[b("span",{class:"text-xl"},"ğŸ "),m(" Mal Sahibi SeÃ§imi ")],-1)),b("div",de,[t[21]||(t[21]=b("label",{class:"label"},[b("span",{class:"label-text font-semibold text-gray-700 dark:text-gray-300"},"Mal Sahibi")],-1)),g(b("select",{"onUpdate:modelValue":t[4]||(t[4]=e=>M.ownerId=e),onChange:q,class:"select select-bordered w-full bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-800 dark:text-gray-200 focus:border-blue-500 dark:focus:border-blue-400",required:""},[t[20]||(t[20]=b("option",{disabled:"",value:""},"Mal Sahibi seÃ§in",-1)),(c(!0),i(y,null,x(C.value,e=>(c(),i("option",{key:e.id,value:e.id},k(e.company||e.fullName||e.name||e.email||`#${e.id}`),9,ie))),128))],544),[[p,M.ownerId]])])])):u("",!0),b("div",ue,[t[29]||(t[29]=b("h4",{class:"text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4 flex items-center gap-2"},[b("span",{class:"text-xl"},"ğŸ¦"),m(" Banka Hareketi Bilgileri ")],-1)),b("div",ce,[b("div",be,[t[23]||(t[23]=b("label",{class:"label"},[b("span",{class:"label-text font-semibold text-gray-700 dark:text-gray-300"},"Hareket Tarihi")],-1)),g(b("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>M.date=e),type:"date",class:"input input-bordered w-full bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-800 dark:text-gray-200 focus:border-blue-500 dark:focus:border-blue-400",required:""},null,512),[[h,M.date]])]),b("div",me,[t[24]||(t[24]=b("label",{class:"label"},[b("span",{class:"label-text font-semibold text-gray-700 dark:text-gray-300"},"Gelen Tutar (â‚º)")],-1)),g(b("input",{"onUpdate:modelValue":t[6]||(t[6]=e=>M.amount=e),type:"number",step:"0.01",placeholder:"0.00",class:"input input-bordered w-full bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-800 dark:text-gray-200 focus:border-blue-500 dark:focus:border-blue-400",required:""},null,512),[[h,M.amount,void 0,{number:!0}]])]),b("div",ge,[t[26]||(t[26]=b("label",{class:"label"},[b("span",{class:"label-text font-semibold text-gray-700 dark:text-gray-300"},"Ã–deme Tipi")],-1)),g(b("select",{"onUpdate:modelValue":t[7]||(t[7]=e=>M.type=e),class:"select select-bordered w-full bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-800 dark:text-gray-200 focus:border-blue-500 dark:focus:border-blue-400",required:""},t[25]||(t[25]=[f('<option disabled value="">Ã–deme Tipi SeÃ§in</option><option value="0">Aidat</option><option value="1">Elektrik</option><option value="2">Su</option><option value="3">DoÄŸalgaz</option><option value="4">DiÄŸer</option>',6)]),512),[[p,M.type]])]),b("div",ve,[t[28]||(t[28]=b("label",{class:"label"},[b("span",{class:"label-text font-semibold text-gray-700 dark:text-gray-300"},"Banka")],-1)),g(b("select",{"onUpdate:modelValue":t[8]||(t[8]=e=>M.bank=e),class:"select select-bordered w-full bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-800 dark:text-gray-200 focus:border-blue-500 dark:focus:border-blue-400",required:""},[t[27]||(t[27]=b("option",{disabled:"",value:""},"Banka SeÃ§in",-1)),(c(!0),i(y,null,x(T.value,e=>(c(),i("option",{key:e,value:e},k(e),9,pe))),128))],512),[[p,M.bank]])])])]),M.tenantId&&P.value.length>0?(c(),i("div",ye,[b("div",xe,[t[33]||(t[33]=b("h4",{class:"text-lg font-semibold text-gray-800 dark:text-gray-100 flex items-center gap-2"},[b("span",{class:"text-xl"},"ğŸ“‹"),m(" BorÃ§ EÅŸleÅŸtirme ")],-1)),b("div",ke,[b("button",{type:"button",onClick:t[9]||(t[9]=e=>L(!0)),class:"btn btn-sm btn-primary bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 border-0 text-white"},t[30]||(t[30]=[b("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[b("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})],-1),m(" Otomatik EÅŸleÅŸtir ")])),b("button",{type:"button",onClick:t[10]||(t[10]=e=>L(!1)),class:"btn btn-sm btn-outline border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300"},t[31]||(t[31]=[b("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[b("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1),m(" Manuel SeÃ§ ")])),b("button",{type:"button",onClick:H,class:"btn btn-sm btn-outline border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300"},t[32]||(t[32]=[b("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[b("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),m(" Temizle ")]))])]),b("div",he,[b("div",fe,[t[35]||(t[35]=b("svg",{class:"w-4 h-4 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[b("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),b("span",we,[t[34]||(t[34]=b("strong",null,"AkÄ±llÄ± Ã–deme Sistemi:",-1)),z.value?(c(),i("span",Ae,"Otomatik mod - Backend borÃ§larÄ± kapatacak ve fazla tutarÄ± avans hesabÄ±na aktaracak.")):(c(),i("span",De,"Manuel mod - Hangi borÃ§larÄ±n Ã¶deneceÄŸini seÃ§ebilirsiniz."))])])]),z.value?u("",!0):(c(),i("div",Me,[(c(!0),i(y,null,x(P.value,e=>(c(),i("div",{key:e.id,class:"flex items-center gap-3 p-3 bg-white dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600"},[g(b("input",{type:"checkbox",value:e.id,"onUpdate:modelValue":t[11]||(t[11]=e=>U.value=e),onChange:R,class:"checkbox checkbox-primary"},null,40,Ce),[[w,U.value]]),b("div",Ie,[b("div",je,[b("div",null,[b("p",Be,k(e.typeLabel||e.type),1),b("p",Ne,[m(k(e.period||e.dueDateFormatted)+" ",1),e.unit&&"-"!==e.unit?(c(),i("span",Se," ("+k(e.unit)+") ",1)):u("",!0)])]),b("div",Te,[b("p",Ve,k(O(e.remainingAmount||e.amount)),1),b("p",Pe,k(_(e.dueDate))+" gÃ¼n gecikmiÅŸ",1),e.paidAmount>0?(c(),i("p",Ue,k(O((e.remainingAmount||e.amount)-e.paidAmount))+" kalan ",1)):u("",!0)])]),U.value.includes(e.id)?(c(),i("div",ze,[g(b("input",{"onUpdate:modelValue":a=>F.value[e.id]=a,type:"number",step:"0.01",max:e.remainingAmount||e.amount,class:"input input-sm input-bordered w-32",placeholder:"Tutar"},null,8,Fe),[[h,F.value[e.id]]])])):u("",!0)])]))),128))])),U.value.length>0||z.value?(c(),i("div",Le,[t[39]||(t[39]=b("h5",{class:"font-semibold text-gray-800 dark:text-gray-100 mb-2"},"Ã–deme Ã–zeti",-1)),b("div",Ee,[b("div",He,[t[36]||(t[36]=b("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"Toplam Tutar:",-1)),b("span",Re,k(O(M.amount)),1)]),b("div",Ye,[t[37]||(t[37]=b("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"EÅŸleÅŸtirilecek:",-1)),b("span",Ke,k(O(E.value)),1)]),b("div",Oe,[t[38]||(t[38]=b("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"Avans HesabÄ±na:",-1)),b("span",_e,k(O((M.amount||0)-E.value)),1)])])])):u("",!0)])):u("",!0),M.tenantId&&0===P.value.length?(c(),i("div",Ge,[b("div",$e,[t[43]||(t[43]=b("svg",{class:"w-6 h-6 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[b("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),b("div",null,[t[42]||(t[42]=b("p",{class:"text-green-700 dark:text-green-300 font-semibold"},"BorÃ§ BulunamadÄ±",-1)),b("p",qe,[t[40]||(t[40]=m(" SeÃ§ilen kiracÄ±nÄ±n Ã¶denmemiÅŸ borcu bulunmuyor. ")),b("strong",null,k(O(M.amount||0)),1),t[41]||(t[41]=m(" tutarÄ± avans hesabÄ±na aktarÄ±lacak. "))])])])])):u("",!0),K.value?(c(),i("div",Je,[b("div",We,[t[44]||(t[44]=b("svg",{class:"w-6 h-6 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[b("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})],-1)),b("span",Ze,k(K.value),1)])])):u("",!0),b("div",Qe,[b("button",{type:"button",class:"btn btn-outline border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700",onClick:la,disabled:Y.value},[t[45]||(t[45]=b("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[b("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)),m(" "+k(Y.value?"Ä°ÅŸlem Devam Ediyor...":"Ä°ptal"),1)],8,Xe),b("button",{type:"button",class:"btn btn-success bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 border-0 text-white shadow-lg",disabled:!G.value||Y.value,onClick:J},[Y.value?(c(),i("svg",ta,t[47]||(t[47]=[b("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)]))):(c(),i("svg",aa,t[46]||(t[46]=[b("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)]))),m(" "+k(Y.value?"Kaydediliyor...":"Ã–demeyi Kaydet"),1)],8,ea)])])])])):u("",!0)}},ra={class:"financial-reports bg-base-100 p-6 rounded-lg shadow-lg"},sa={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6"},na={class:"form-control"},oa={class:"form-control"},da={class:"form-control"},ia=["value"],ua={class:"form-control"},ca=["disabled","title"],ba={key:0,class:"loading loading-spinner loading-sm"},ma={key:0,class:"alert alert-warning mb-4"},ga={key:1,class:"text-center py-8 text-gray-500"},va={key:2,class:"space-y-6"},pa={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},ya={class:"stat bg-base-200 rounded-lg"},xa={class:"stat-value text-primary"},ka={class:"stat-desc"},ha={class:"stat bg-base-200 rounded-lg"},fa={class:"stat-value text-error"},wa={class:"stat-desc"},Aa={class:"stat bg-base-200 rounded-lg"},Da={class:"stat-value text-success"},Ma={class:"stat-desc"},Ca={class:"stat bg-base-200 rounded-lg"},Ia={class:"overflow-x-auto"},ja={class:"table table-zebra w-full"},Ba={class:"text-success"},Na={class:"text-error"},Sa={key:3,class:"text-center py-8"},Ta={__name:"FinancialReports",setup(e){const{handleNetworkError:a,handleValidationError:t}=S(),{showError:l,showSuccess:r}=T(),d=s(!1),v=s([]),w=s(null),D=new Date,M=new Date(D.getFullYear(),D.getMonth(),1),C=s({startDate:E(M,"yyyy-MM-dd"),endDate:E(D,"yyyy-MM-dd"),tenantId:"",ownerId:""}),I=e=>new Intl.NumberFormat("tr-TR",{style:"currency",currency:"TRY"}).format(Number(e||0)),B=e=>{if(!e)return"-";const a="string"==typeof e||"number"==typeof e?new Date(e):e;return isNaN(a)?"-":E(a,"dd MMM yyyy",{locale:P})},N=n(()=>!C.value.startDate||!C.value.endDate||new Date(C.value.startDate)<=new Date(C.value.endDate)),V=Object.freeze({totalPayments:0,paymentCount:0,totalDebts:0,debtCount:0,advanceBalance:0,advanceAccountCount:0,netBalance:0,details:[]}),U=n(()=>{const e=w.value||{};return{totalPayments:Number(e.totalPayments||0),paymentCount:Number(e.paymentCount||0),totalDebts:Number(e.totalDebts||0),debtCount:Number(e.debtCount||0),advanceBalance:Number(e.advanceBalance||0),advanceAccountCount:Number(e.advanceAccountCount||0),netBalance:Number(e.netBalance||(e.totalPayments||0)-(e.totalDebts||0)),details:Array.isArray(e.details)?e.details.map((e,a)=>({_idx:a,...e})):[]}}),z=n(()=>{const e=U.value;return e.paymentCount>0||e.debtCount>0||e.advanceAccountCount>0||e.details&&e.details.length>0});function F(e){return e.companyName||e.company||e.fullName||[e.firstName,e.lastName].filter(Boolean).join(" ")||e.email||"KiracÄ±"}function H(e){const a=v.value.find(a=>a.id===e);return a?F(a):"Bilinmiyor"}async function R(){if(N.value){d.value=!0;try{const e=await j.getFinancialReports({startDate:C.value.startDate,endDate:C.value.endDate,tenantId:C.value.tenantId||void 0,ownerId:C.value.ownerId||void 0});w.value=e&&"object"==typeof e?e:V,r("Rapor gÃ¼ncellendi")}catch(e){w.value=V,a(e,{component:"FinancialReports",action:"loadReports"}),l("Rapor yÃ¼klenemedi")}finally{d.value=!1}}else t(new Error("Tarih aralÄ±ÄŸÄ± geÃ§ersiz"),{component:"FinancialReports",action:"loadReports"})}return o(()=>{!async function(){try{const e=await L.getTenants();v.value=Array.isArray(e)?e:[]}catch(e){a(e,{component:"FinancialReports",action:"loadTenants"}),v.value=[]}}(),R()}),(e,a)=>(c(),i("div",ra,[a[16]||(a[16]=b("h2",{class:"text-2xl font-bold mb-6 text-primary"},"Finansal Raporlar",-1)),b("div",sa,[b("div",na,[a[3]||(a[3]=b("label",{class:"label"},[b("span",{class:"label-text font-semibold"},"BaÅŸlangÄ±Ã§ Tarihi")],-1)),g(b("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>C.value.startDate=e),type:"date",class:"input input-bordered"},null,512),[[h,C.value.startDate]])]),b("div",oa,[a[4]||(a[4]=b("label",{class:"label"},[b("span",{class:"label-text font-semibold"},"BitiÅŸ Tarihi")],-1)),g(b("input",{"onUpdate:modelValue":a[1]||(a[1]=e=>C.value.endDate=e),type:"date",class:"input input-bordered"},null,512),[[h,C.value.endDate]])]),b("div",da,[a[6]||(a[6]=b("label",{class:"label"},[b("span",{class:"label-text font-semibold"},"KiracÄ±")],-1)),g(b("select",{"onUpdate:modelValue":a[2]||(a[2]=e=>C.value.tenantId=e),class:"select select-bordered"},[a[5]||(a[5]=b("option",{value:""},"TÃ¼m KiracÄ±lar",-1)),(c(!0),i(y,null,x(v.value,e=>(c(),i("option",{key:e.id,value:e.id},k(F(e)),9,ia))),128))],512),[[p,C.value.tenantId]])]),b("div",ua,[a[7]||(a[7]=b("label",{class:"label"},[b("span",{class:"label-text font-semibold"},"Â ")],-1)),b("button",{onClick:R,class:"btn btn-primary",disabled:d.value||!N.value,title:N.value?"":"BaÅŸlangÄ±Ã§ tarihi bitiÅŸten bÃ¼yÃ¼k olamaz"},[d.value?(c(),i("span",ba)):u("",!0),m(" "+k(d.value?"YÃ¼kleniyor...":"Rapor YÃ¼kle"),1)],8,ca)])]),N.value?u("",!0):(c(),i("div",ma," BaÅŸlangÄ±Ã§ tarihi, bitiÅŸ tarihinden bÃ¼yÃ¼k olamaz. ")),d.value?(c(),i("div",ga,"YÃ¼kleniyorâ€¦")):z.value?(c(),i("div",va,[b("div",pa,[b("div",ya,[a[8]||(a[8]=b("div",{class:"stat-title"},"Toplam Ã–deme",-1)),b("div",xa,k(I(U.value.totalPayments)),1),b("div",ka,k(U.value.paymentCount)+" Ã¶deme",1)]),b("div",ha,[a[9]||(a[9]=b("div",{class:"stat-title"},"Toplam BorÃ§",-1)),b("div",fa,k(I(U.value.totalDebts)),1),b("div",wa,k(U.value.debtCount)+" borÃ§",1)]),b("div",Aa,[a[10]||(a[10]=b("div",{class:"stat-title"},"Avans Bakiyesi",-1)),b("div",Da,k(I(U.value.advanceBalance)),1),b("div",Ma,k(U.value.advanceAccountCount)+" hesap",1)]),b("div",Ca,[a[11]||(a[11]=b("div",{class:"stat-title"},"Net Durum",-1)),b("div",{class:A(["stat-value",U.value.netBalance>=0?"text-success":"text-error"])},k(I(U.value.netBalance)),3),a[12]||(a[12]=b("div",{class:"stat-desc"},"Ã–deme - BorÃ§",-1))])]),b("div",Ia,[b("table",ja,[a[13]||(a[13]=b("thead",null,[b("tr",null,[b("th",null,"Tarih"),b("th",null,"KiracÄ±"),b("th",null,"Ã–deme"),b("th",null,"BorÃ§"),b("th",null,"Kalan"),b("th",null,"Durum")])],-1)),b("tbody",null,[(c(!0),i(y,null,x(U.value.details,e=>(c(),i("tr",{key:e.id||e._idx},[b("td",null,k(B(e.date)),1),b("td",null,k(e.tenantName||H(e.tenantId)),1),b("td",Ba,k(I(e.paymentAmount||0)),1),b("td",Na,k(I(e.debtAmount||0)),1),b("td",{class:A((e.remainingAmount||0)>=0?"text-success":"text-error")},k(I(e.remainingAmount||0)),3),b("td",null,[b("span",{class:A(["badge",(e.remainingAmount||0)>=0?"badge-success":"badge-error"])},k((e.remainingAmount||0)>=0?"Pozitif":"Negatif"),3)])]))),128))])])]),a[14]||(a[14]=f('<div class="bg-base-200 p-4 rounded-lg"><h3 class="text-lg font-semibold mb-3">Grafik GÃ¶rÃ¼nÃ¼mÃ¼</h3><div class="text-center py-8 text-gray-500"><svg class="w-16 h-16 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2z"></path></svg><p>Grafik gÃ¶rÃ¼nÃ¼mÃ¼ yakÄ±nda eklenecek</p></div></div>',1))])):d.value?u("",!0):(c(),i("div",Sa,a[15]||(a[15]=[f('<div class="text-gray-500"><svg class="w-16 h-16 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg><p class="text-lg font-medium">Rapor bulunamadÄ±</p><p class="text-sm">Filtreleri deÄŸiÅŸtirip tekrar deneyin.</p></div>',1)])))]))}},Va={class:"audit-logs bg-base-100 p-6 rounded-lg shadow-lg"},Pa={class:"grid grid-cols-1 md:grid-cols-5 gap-4 mb-6"},Ua={class:"form-control"},za={class:"form-control"},Fa={class:"form-control"},La=["value"],Ea={class:"form-control"},Ha=["value"],Ra={class:"form-control"},Ya=["disabled"],Ka={key:0,class:"loading loading-spinner loading-sm"},Oa={key:0,class:"overflow-x-auto"},_a={class:"table table-zebra w-full"},Ga={class:"flex items-center space-x-2"},$a={class:"avatar placeholder"},qa={class:"bg-neutral text-neutral-content rounded-full w-8"},Ja={class:"text-xs"},Wa={class:"font-medium"},Za={class:"text-sm text-gray-500"},Qa={class:"font-medium"},Xa={class:"text-sm text-gray-500"},et={class:"text-sm text-gray-500"},at=["onClick"],tt={key:1,class:"text-center py-8"},lt={id:"log_details_modal",class:"modal"},rt={class:"modal-box w-11/12 max-w-4xl"},st={key:0,class:"space-y-4"},nt={class:"grid grid-cols-2 gap-4"},ot={class:"text-sm"},dt={class:"text-sm"},it={class:"text-sm"},ut={class:"text-sm"},ct={class:"text-sm"},bt={class:"text-sm text-xs"},mt={key:0},gt={class:"bg-base-200 p-4 rounded-lg"},vt={key:0,class:"mb-3"},pt={class:"text-xs bg-error text-error-content p-2 rounded"},yt={key:1},xt={class:"text-xs bg-success text-success-content p-2 rounded"},kt={key:1},ht={class:"bg-base-200 p-4 rounded-lg"},ft={class:"text-xs"},wt={__name:"AuditLogs",setup(e){const a=s(!1),t=s([]),l=s(null),r=s({startDate:E(new Date((new Date).getFullYear(),(new Date).getMonth(),1),"yyyy-MM-dd"),endDate:E(new Date,"yyyy-MM-dd"),action:"",entityType:"",userId:""}),n=e=>E(new Date(e),"dd MMM yyyy HH:mm",{locale:P}),d=async()=>{a.value=!0;try{const e=await j.getAuditLogs(r.value);t.value=e||[]}catch(e){alert("Loglar yÃ¼klenemedi: "+e.message)}finally{a.value=!1}};return o(()=>{d()}),(e,s)=>(c(),i("div",Va,[s[25]||(s[25]=b("h2",{class:"text-2xl font-bold mb-6 text-primary"},"Sistem LoglarÄ±",-1)),b("div",Pa,[b("div",Ua,[s[4]||(s[4]=b("label",{class:"label"},[b("span",{class:"label-text font-semibold"},"BaÅŸlangÄ±Ã§ Tarihi")],-1)),g(b("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>r.value.startDate=e),type:"date",class:"input input-bordered"},null,512),[[h,r.value.startDate]])]),b("div",za,[s[5]||(s[5]=b("label",{class:"label"},[b("span",{class:"label-text font-semibold"},"BitiÅŸ Tarihi")],-1)),g(b("input",{"onUpdate:modelValue":s[1]||(s[1]=e=>r.value.endDate=e),type:"date",class:"input input-bordered"},null,512),[[h,r.value.endDate]])]),b("div",Fa,[s[7]||(s[7]=b("label",{class:"label"},[b("span",{class:"label-text font-semibold"},"Ä°ÅŸlem TÃ¼rÃ¼")],-1)),g(b("select",{"onUpdate:modelValue":s[2]||(s[2]=e=>r.value.action=e),class:"select select-bordered"},[s[6]||(s[6]=b("option",{value:""},"TÃ¼m Ä°ÅŸlemler",-1)),(c(!0),i(y,null,x(D(H),(e,a)=>(c(),i("option",{key:a,value:a},k(e),9,La))),128))],512),[[p,r.value.action]])]),b("div",Ea,[s[9]||(s[9]=b("label",{class:"label"},[b("span",{class:"label-text font-semibold"},"VarlÄ±k TÃ¼rÃ¼")],-1)),g(b("select",{"onUpdate:modelValue":s[3]||(s[3]=e=>r.value.entityType=e),class:"select select-bordered"},[s[8]||(s[8]=b("option",{value:""},"TÃ¼m VarlÄ±klar",-1)),(c(!0),i(y,null,x(D(R),(e,a)=>(c(),i("option",{key:a,value:a},k(e),9,Ha))),128))],512),[[p,r.value.entityType]])]),b("div",Ra,[s[10]||(s[10]=b("label",{class:"label"},[b("span",{class:"label-text font-semibold"},"Â ")],-1)),b("button",{onClick:d,class:"btn btn-primary",disabled:a.value},[a.value?(c(),i("span",Ka)):u("",!0),m(" "+k(a.value?"YÃ¼kleniyor...":"Log YÃ¼kle"),1)],8,Ya)])]),t.value.length>0?(c(),i("div",Oa,[b("table",_a,[s[11]||(s[11]=b("thead",null,[b("tr",null,[b("th",null,"Tarih"),b("th",null,"KullanÄ±cÄ±"),b("th",null,"Ä°ÅŸlem"),b("th",null,"VarlÄ±k"),b("th",null,"IP Adresi"),b("th",null,"Detaylar")])],-1)),b("tbody",null,[(c(!0),i(y,null,x(t.value,e=>{var a,t;return c(),i("tr",{key:e.id},[b("td",null,k(n(e.createdAt)),1),b("td",null,[b("div",Ga,[b("div",$a,[b("div",qa,[b("span",Ja,k((null==(a=e.userName)?void 0:a.charAt(0))||"U"),1)])]),b("div",null,[b("div",Wa,k(e.userName||"Sistem"),1),b("div",Za,k(e.userEmail||"-"),1)])])]),b("td",null,[b("span",{class:A(["badge",(t=e.action,{Create:"badge-success",Update:"badge-warning",Delete:"badge-error",Payment:"badge-primary",DebtAllocation:"badge-info",AdvanceUsage:"badge-secondary"}[t]||"badge-neutral")])},k(D(Y)(e.action)),3)]),b("td",null,[b("div",null,[b("div",Qa,k(D(K)(e.entityType)),1),b("div",Xa,"ID: "+k(e.entityId),1)])]),b("td",et,k(e.ipAddress||"-"),1),b("td",null,[b("button",{onClick:a=>(e=>{l.value=e,document.getElementById("log_details_modal").showModal()})(e),class:"btn btn-sm btn-outline"}," Detaylar ",8,at)])])}),128))])])])):a.value?u("",!0):(c(),i("div",tt,s[12]||(s[12]=[f('<div class="text-gray-500"><svg class="w-16 h-16 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg><p class="text-lg font-medium">Log bulunamadÄ±</p><p class="text-sm">Filtreleri deÄŸiÅŸtirip tekrar deneyin.</p></div>',1)]))),b("dialog",lt,[b("div",rt,[s[23]||(s[23]=b("h3",{class:"font-bold text-lg mb-4"},"Log DetaylarÄ±",-1)),l.value?(c(),i("div",st,[b("div",nt,[b("div",null,[s[13]||(s[13]=b("label",{class:"label"},[b("span",{class:"label-text font-semibold"},"Tarih")],-1)),b("div",ot,k(n(l.value.createdAt)),1)]),b("div",null,[s[14]||(s[14]=b("label",{class:"label"},[b("span",{class:"label-text font-semibold"},"KullanÄ±cÄ±")],-1)),b("div",dt,k(l.value.userName||"Sistem"),1)]),b("div",null,[s[15]||(s[15]=b("label",{class:"label"},[b("span",{class:"label-text font-semibold"},"Ä°ÅŸlem")],-1)),b("div",it,k(D(Y)(l.value.action)),1)]),b("div",null,[s[16]||(s[16]=b("label",{class:"label"},[b("span",{class:"label-text font-semibold"},"VarlÄ±k")],-1)),b("div",ut,k(D(K)(l.value.entityType))+" (ID: "+k(l.value.entityId)+")",1)]),b("div",null,[s[17]||(s[17]=b("label",{class:"label"},[b("span",{class:"label-text font-semibold"},"IP Adresi")],-1)),b("div",ct,k(l.value.ipAddress||"-"),1)]),b("div",null,[s[18]||(s[18]=b("label",{class:"label"},[b("span",{class:"label-text font-semibold"},"User Agent")],-1)),b("div",bt,k(l.value.userAgent||"-"),1)])]),l.value.oldValues||l.value.newValues?(c(),i("div",mt,[s[21]||(s[21]=b("label",{class:"label"},[b("span",{class:"label-text font-semibold"},"DeÄŸiÅŸiklikler")],-1)),b("div",gt,[l.value.oldValues?(c(),i("div",vt,[s[19]||(s[19]=b("div",{class:"font-semibold text-error mb-2"},"Eski DeÄŸerler:",-1)),b("pre",pt,k(JSON.stringify(l.value.oldValues,null,2)),1)])):u("",!0),l.value.newValues?(c(),i("div",yt,[s[20]||(s[20]=b("div",{class:"font-semibold text-success mb-2"},"Yeni DeÄŸerler:",-1)),b("pre",xt,k(JSON.stringify(l.value.newValues,null,2)),1)])):u("",!0)])])):u("",!0),l.value.additionalData?(c(),i("div",kt,[s[22]||(s[22]=b("label",{class:"label"},[b("span",{class:"label-text font-semibold"},"Ek Bilgiler")],-1)),b("div",ht,[b("pre",ft,k(JSON.stringify(l.value.additionalData,null,2)),1)])])):u("",!0)])):u("",!0),s[24]||(s[24]=b("div",{class:"modal-action"},[b("form",{method:"dialog"},[b("button",{class:"btn"},"Kapat")])],-1))])])]))}},At=M("payments",{state:()=>({payments:[],advanceAccounts:[],loading:!1,lastFetched:null}),actions:{async fetchPayments(a=!1){if(!a&&this.payments.length>0&&this.lastFetched&&Date.now()-this.lastFetched<3e5)return this.payments;this.loading=!0;try{const e=await j.getPayments();return this.payments=e||[],this.lastFetched=Date.now(),this.payments}catch(t){throw e.logError(t,{component:"PaymentsStore",action:"fetchPayments"}),t}finally{this.loading=!1}},async fetchAdvanceAccounts(){this.loading=!0;try{const e=await j.getAdvanceAccounts(),a=Array.isArray(e)?e:(null==e?void 0:e.items)||[];return this.advanceAccounts=a.map(e=>({...e,balance:Number(e.balance??0)})).filter(e=>e.balance>0),this.advanceAccounts}catch(a){throw e.logError(a,{component:"PaymentsStore",action:"fetchAdvanceAccounts"}),a}finally{this.loading=!1}},async deletePayment(e){try{await j.deletePayment(e),this.payments=this.payments.filter(a=>a.id!==e),await this.fetchAdvanceAccounts()}catch(a){throw a}}}}),Dt={class:"p-4 sm:p-6 bg-gray-50 min-h-screen font-sans dark:bg-gray-900"},Mt={class:"max-w-7xl mx-auto"},Ct={class:"flex items-center justify-between mb-6"},It={class:"flex items-center gap-4"},jt={class:"bg-green-100 dark:bg-green-900/50 text-green-600 dark:text-green-400 px-3 py-1 rounded-full text-sm"},Bt={class:"bg-blue-100 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400 px-3 py-1 rounded-full text-sm"},Nt={class:"bg-purple-100 dark:bg-purple-900/50 text-purple-600 dark:text-purple-400 px-3 py-1 rounded-full text-sm"},St={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8"},Tt={class:"bg-white dark:bg-gray-800 p-5 rounded-xl shadow-md flex items-center gap-4 border border-gray-200 dark:border-gray-700"},Vt={class:"text-2xl font-bold text-gray-800 dark:text-gray-100"},Pt={class:"bg-white dark:bg-gray-800 p-5 rounded-xl shadow-md flex items-center gap-4 border border-gray-200 dark:border-gray-700"},Ut={class:"text-2xl font-bold text-gray-800 dark:text-gray-100"},zt={class:"bg-white dark:bg-gray-800 p-5 rounded-xl shadow-md flex items-center gap-4 border border-gray-200 dark:border-gray-700"},Ft={class:"text-2xl font-bold text-gray-800 dark:text-gray-100"},Lt={class:"bg-white dark:bg-gray-800 p-5 rounded-xl shadow-md flex items-center gap-4 border border-gray-200 dark:border-gray-700"},Et={class:"text-2xl font-bold text-gray-800 dark:text-gray-100"},Ht={class:"bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md border border-gray-200 dark:border-gray-700 mb-8"},Rt={class:"h-64 flex items-end justify-between gap-2"},Yt={class:"text-xs text-gray-500 dark:text-gray-400"},Kt={class:"bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md border border-gray-200 dark:border-gray-700 mb-8"},Ot={class:"grid grid-cols-2 sm:grid-cols-4 gap-4"},_t={class:"flex items-center gap-3 mb-2"},Gt={class:"text-2xl"},$t={class:"font-semibold text-gray-800 dark:text-gray-100"},qt={class:"text-sm text-gray-500 dark:text-gray-400"},Jt={class:"text-lg font-bold text-green-600 dark:text-green-400"},Wt={key:0,class:"mb-6"},Zt={key:1,class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6"},Qt={key:2,class:"bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md border border-gray-200 dark:border-gray-700 mb-6"},Xt={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},el={class:"flex items-center justify-between mb-2"},al={class:"font-semibold text-gray-800 dark:text-gray-100"},tl={class:"text-2xl font-bold text-purple-600 dark:text-purple-400 mb-1"},ll={class:"text-sm text-gray-600 dark:text-gray-400"},rl={class:"bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md border border-gray-200 dark:border-gray-700"},sl={class:"mt-6 space-y-2"},nl={key:0,class:"text-center py-12 text-gray-500 dark:text-gray-400"},ol={key:1},dl={class:"md:col-span-5 flex items-center gap-4"},il={class:"font-bold text-gray-800 dark:text-gray-100"},ul={class:"text-sm text-gray-500 dark:text-gray-400"},cl={class:"md:col-span-3 text-left md:text-center text-2xl font-semibold text-green-600 dark:text-green-400"},bl={class:"md:col-span-2 text-left md:text-center text-sm text-gray-600 dark:text-gray-300"},ml={class:"font-semibold text-gray-800 dark:text-gray-100 flex items-center gap-2"},gl={key:0,class:"md:col-span-2 text-right"},vl={class:"dropdown dropdown-end"},pl={tabindex:"0",class:"dropdown-content menu p-2 shadow bg-base-200 rounded-box w-32 z-10"},yl=["onClick"],xl=["onClick"],kl={key:0,class:"modal",open:""},hl={class:"modal-box max-w-4xl"},fl={class:"flex items-center justify-between mb-4"},wl={key:1,class:"modal",open:""},Al={class:"modal-box max-w-6xl"},Dl={class:"flex items-center justify-between mb-4"},Ml={key:2,class:"modal",open:""},Cl={class:"modal-box max-w-6xl"},Il={class:"flex items-center justify-between mb-4"},jl={key:3,class:"flex justify-center items-center py-12"},Bl={__name:"Payments",setup(e){const{handleNetworkError:l}=S(),{showCreateSuccess:r,showUpdateSuccess:d,showDeleteSuccess:g,showSuccess:v}=T(),p=a(),h=At(),f=G(),w=e=>F(e,"dd MMM yyyy"),M=n(()=>h.payments),j=n(()=>f.tenants),B=n(()=>h.advanceAccounts),N=s(["Ziraat","Ä°ÅŸ BankasÄ±","Garanti","YapÄ± Kredi","Halkbank"]),P=s(!1),L=s(!1),E=s(!1),H=s(!1),R=n(()=>h.loading||f.loading),Y=s({searchTerm:"",period:"",type:""}),K=e=>{if("number"==typeof e)return e;if(""===e||null==e)return"";if(!Number.isNaN(Number(e)))return Number(e);const a=Object.entries(O).find(([,a])=>a===e);return a?Number(a[0]):""},W={0:"ğŸ¢",1:"âš¡ï¸",2:"ğŸ’§",3:"ğŸ”¥",4:"ğŸ’³"},Z=e=>W[K(e)]??"ğŸ’³",Q=n(()=>Object.entries(O).map(([e,a])=>({value:Number(e),label:a,icon:Z(Number(e))}))),X=n(()=>[{value:"",label:"TÃ¼m Tipler",icon:"ğŸ“¦"},...Q.value]),ee=e=>(null==e?void 0:e.date)||(null==e?void 0:e.paymentDate)||(null==e?void 0:e.createdAt)||"",ae=n(()=>M.value.reduce((e,a)=>e+Number(a.amount||0),0)),te=n(()=>{const e=new Date,a=`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}`;return M.value.filter(e=>(ee(e)||"").startsWith(a)).reduce((e,a)=>e+Number(a.amount||0),0)}),le=n(()=>{const e=new Date,a=`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}`;return M.value.filter(e=>(ee(e)||"").startsWith(a)).length}),re=n(()=>M.value.length),se=n(()=>B.value.reduce((e,a)=>e+Number(a.balance??0),0)),ne=e=>{if(!e)return"Mal Sahibi Ã–demesi";const a=f.getTenantById(e);return(null==a?void 0:a.companyName)||(null==a?void 0:a.company)||(null==a?void 0:a.contactPersonName)||(null==a?void 0:a.fullName)||[null==a?void 0:a.firstName,null==a?void 0:a.lastName].filter(Boolean).join(" ")||(null==a?void 0:a.email)||`#${e}`},oe=n(()=>{let e=M.value;const a=(Y.value.searchTerm||"").toLowerCase(),t=K(Y.value.type);return""!==t&&void 0!==t&&(e=e.filter(e=>K(e.type)===t)),Y.value.period&&(e=e.filter(e=>{const a=ee(e);if(!a)return!1;const t=new Date(Y.value.period),l=new Date(a);return l.getFullYear()===t.getFullYear()&&l.getMonth()===t.getMonth()})),a&&(e=e.filter(e=>ne(e.tenantId).toLowerCase().includes(a)||_(K(e.type)).toLowerCase().includes(a)||e.bank&&e.bank.toLowerCase().includes(a)||e.amount&&String(e.amount).includes(a))),e.sort((e,a)=>new Date(ee(a))-new Date(ee(e)))}),de=s({date:(new Date).toISOString().substring(0,10),tenantId:"",ownerId:null,amount:null,type:"",bank:"",description:""}),ie=s(!1),ue=s(null),ce=()=>{P.value=!1,de.value={date:(new Date).toISOString().substring(0,10),tenantId:"",ownerId:null,amount:null,type:"",bank:"",description:""},ie.value=!1,ue.value=null},be=()=>{Y.value={searchTerm:"",period:"",type:""},h.fetchPayments(!0)},me=async()=>{P.value=!1,de.value={date:(new Date).toISOString().substring(0,10),tenantId:"",ownerId:null,amount:null,type:"",bank:"",description:""};const e=ie.value;ie.value=!1,ue.value=null,await Promise.all([h.fetchPayments(!0),h.fetchAdvanceAccounts()]),e?d("Ã–deme"):r("Ã–deme")},ge=()=>{L.value=!1,h.fetchAdvanceAccounts(),v("Avans hesabÄ± iÅŸlemi baÅŸarÄ±yla tamamlandÄ±")},ve=n(()=>{const e=[],a=new Date;for(let t=5;t>=0;t--){const l=new Date(a.getFullYear(),a.getMonth()-t,1),r=`${l.getFullYear()}-${String(l.getMonth()+1).padStart(2,"0")}`,s=l.toLocaleDateString("tr-TR",{month:"short"}),n=M.value.filter(e=>(ee(e)||"").startsWith(r)).reduce((e,a)=>e+Number(a.amount||0),0);e.push({month:s,total:n})}return e}),pe=n(()=>Math.max(...ve.value.map(e=>e.total),1)),ye=n(()=>{const e={};return M.value.forEach(a=>{const t=K(a.type);""!==t&&(e[t]||(e[t]={name:t,label:_(t),icon:Z(t),count:0,total:0}),e[t].count++,e[t].total+=Number(a.amount||0))}),Object.values(e).sort((e,a)=>a.total-e.total)});return o(()=>{f.fetchTenants(),h.fetchAdvanceAccounts(),h.fetchPayments()}),(e,a)=>(c(),i("div",Dt,[b("div",Mt,[b("div",Ct,[a[10]||(a[10]=b("h1",{class:"text-3xl font-bold text-gray-800 dark:text-gray-100"},"KiracÄ± Ã–demeleri",-1)),b("div",It,[b("div",jt," Toplam: "+k(D($)(ae.value)),1),b("div",Bt," Bu Ay: "+k(D($)(te.value)),1),b("div",Nt,k(re.value)+" Ã¶deme ",1)])]),b("section",St,[b("div",Tt,[a[12]||(a[12]=b("div",{class:"bg-green-100 dark:bg-green-900/50 text-green-600 dark:text-green-400 rounded-full p-3"},[b("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[b("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})])],-1)),b("div",null,[a[11]||(a[11]=b("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Bu Ayki Gelir",-1)),b("p",Vt,k(D($)(te.value)),1)])]),b("div",Pt,[a[14]||(a[14]=b("div",{class:"bg-blue-100 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400 rounded-full p-3"},[b("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[b("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"})])],-1)),b("div",null,[a[13]||(a[13]=b("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Toplam Gelir",-1)),b("p",Ut,k(D($)(ae.value)),1)])]),b("div",zt,[a[16]||(a[16]=b("div",{class:"bg-amber-100 dark:bg-amber-900/50 text-amber-600 dark:text-amber-400 rounded-full p-3"},[b("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[b("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),b("div",null,[a[15]||(a[15]=b("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Bu Ayki Ä°ÅŸlem SayÄ±sÄ±",-1)),b("p",Ft,k(le.value),1)])]),b("div",Lt,[a[18]||(a[18]=b("div",{class:"bg-purple-100 dark:bg-purple-900/50 text-purple-600 dark:text-purple-400 rounded-full p-3"},[b("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[b("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"})])],-1)),b("div",null,[a[17]||(a[17]=b("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Toplam Avans",-1)),b("p",Et,k(D($)(se.value)),1)])])]),b("section",Ht,[a[19]||(a[19]=b("div",{class:"flex items-center justify-between mb-4"},[b("h2",{class:"text-xl font-semibold text-gray-800 dark:text-gray-100"},"AylÄ±k Ã–deme GrafiÄŸi")],-1)),b("div",Rt,[(c(!0),i(y,null,x(ve.value,(e,a)=>(c(),i("div",{key:a,class:"flex-1 flex flex-col items-center gap-2"},[b("div",{class:"w-full bg-green-500 rounded-t",style:I({height:e.total/pe.value*200+"px"})},null,4),b("span",Yt,k(e.month),1)]))),128))])]),b("section",Kt,[a[20]||(a[20]=b("h2",{class:"text-xl font-semibold text-gray-800 dark:text-gray-100 mb-4"},"Ã–deme Tipi DaÄŸÄ±lÄ±mÄ±",-1)),b("div",Ot,[(c(!0),i(y,null,x(ye.value,e=>(c(),i("div",{key:e.name,class:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg border border-gray-200 dark:border-gray-600"},[b("div",_t,[b("span",Gt,k(e.icon),1),b("div",null,[b("p",$t,k(e.label),1),b("p",qt,k(e.count)+" Ã¶deme",1)])]),b("p",Jt,k(D($)(e.total)),1)]))),128))])]),D(p).role===D(t).ADMIN||D(p).role===D(t).MANAGER?(c(),i("div",Wt,[b("button",{onClick:a[0]||(a[0]=e=>P.value=!0),class:"w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-semibold py-4 px-6 rounded-xl shadow-lg transition-all duration-300 flex items-center justify-center gap-3"},a[21]||(a[21]=[b("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[b("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1),b("span",null,"Yeni Ã–deme Ekle",-1)]))])):u("",!0),D(p).role===D(t).ADMIN||D(p).role===D(t).MANAGER?(c(),i("div",Zt,[b("button",{onClick:a[1]||(a[1]=e=>L.value=!0),class:"bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 text-white font-semibold py-3 px-4 rounded-xl shadow-lg transition-all duration-300 flex items-center justify-center gap-2"},a[22]||(a[22]=[b("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[b("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"})],-1),b("span",null,"Avans HesabÄ±",-1)])),b("button",{onClick:a[2]||(a[2]=e=>E.value=!0),class:"bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white font-semibold py-3 px-4 rounded-xl shadow-lg transition-all duration-300 flex items-center justify-center gap-2"},a[23]||(a[23]=[b("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[b("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2z"})],-1),b("span",null,"Finansal Raporlar",-1)])),D(p).role===D(t).ADMIN?(c(),i("button",{key:0,onClick:a[3]||(a[3]=e=>H.value=!0),class:"bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-semibold py-3 px-4 rounded-xl shadow-lg transition-all duration-300 flex items-center justify-center gap-2"},a[24]||(a[24]=[b("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[b("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),b("span",null,"Sistem LoglarÄ±",-1)]))):u("",!0)])):u("",!0),B.value.length>0?(c(),i("div",Qt,[a[26]||(a[26]=b("h3",{class:"text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4 flex items-center gap-2"},[b("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-purple-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[b("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"})]),m(" Avans HesaplarÄ± ")],-1)),b("div",Xt,[(c(!0),i(y,null,x(B.value,e=>(c(),i("div",{key:e.id,class:"bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg border border-purple-200 dark:border-purple-800"},[b("div",el,[b("span",al,k(ne(e.tenantId)),1),a[25]||(a[25]=b("span",{class:"badge badge-success badge-sm"},"Aktif",-1))]),b("p",tl,k(D($)(Number(e.balance??e.amount??0))),1),b("p",ll,k(w(e.updatedAt||e.lastMovementAt||e.createdAt||e.paymentDate)),1)]))),128))])])):u("",!0),b("div",rl,[C(V,{search:Y.value.searchTerm,"search-placeholder":"Firma, tutar, tip veya banka ara...",period:Y.value.period,"select-type":Y.value.type,"select-type-options":X.value,"onUpdate:search":a[4]||(a[4]=e=>Y.value.searchTerm=e),"onUpdate:period":a[5]||(a[5]=e=>Y.value.period=e),"onUpdate:selectType":a[6]||(a[6]=e=>Y.value.type=e),onClearFilters:be},null,8,["search","period","select-type","select-type-options"]),b("div",sl,[0===oe.value.length?(c(),i("div",nl,a[27]||(a[27]=[b("p",null,"AramanÄ±zla eÅŸleÅŸen Ã¶deme bulunamadÄ±.",-1)]))):(c(),i("div",ol,[(c(!0),i(y,null,x(oe.value,e=>(c(),i("div",{key:e.id,class:"grid grid-cols-1 md:grid-cols-12 gap-4 items-center p-4 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors duration-200 border-b dark:border-gray-700/50"},[b("div",dl,[b("div",{class:A(["flex-shrink-0 h-12 w-12 flex items-center justify-center text-white rounded-full text-xl font-bold",D(q)(ne(e.tenantId))])},k(D(J)(ne(e.tenantId))),3),b("div",null,[b("p",il,k(ne(e.tenantId)),1),b("p",ul,k(w(ee(e))),1)])]),b("div",cl,k(D($)(e.amount)),1),b("div",bl,[b("p",ml,[b("span",null,k(Z(e.type)),1),b("span",null,k(D(_)(K(e.type))),1)]),b("p",null,k(e.bank),1)]),D(p).role===D(t).ADMIN||D(p).role===D(t).MANAGER?(c(),i("div",gl,[b("div",vl,[a[28]||(a[28]=b("label",{tabindex:"0",class:"btn btn-ghost btn-sm"},"Ä°ÅŸlemler",-1)),b("ul",pl,[b("li",null,[b("a",{onClick:a=>{return t=e,de.value={date:(ee(t)||(new Date).toISOString()).substring(0,10),tenantId:t.tenantId||"",ownerId:t.ownerId??null,amount:t.amount??null,type:K(t.type),bank:t.bank??"",description:t.description??""},ue.value=t.id,ie.value=!0,void(P.value=!0);var t}},"DÃ¼zenle",8,yl)]),b("li",null,[b("a",{onClick:a=>(async e=>{try{await h.deletePayment(e),g("Ã–deme")}catch(a){l(a,{component:"Payments",action:"deletePayment"})}})(e.id),class:"text-red-500"},"Sil",8,xl)])])])])):u("",!0)]))),128))]))])])]),C(la,{visible:P.value,payment:de.value,tenants:j.value,banks:N.value,editMode:ie.value,onSave:me,onCancel:ce},null,8,["visible","payment","tenants","banks","editMode"]),L.value?(c(),i("dialog",kl,[b("div",hl,[b("div",fl,[a[29]||(a[29]=b("h3",{class:"text-xl font-bold"},"Avans HesabÄ± YÃ¶netimi",-1)),b("button",{onClick:a[7]||(a[7]=e=>L.value=!1),class:"btn btn-sm btn-ghost"},"âœ•")]),C(U,{onSuccess:ge})])])):u("",!0),E.value?(c(),i("dialog",wl,[b("div",Al,[b("div",Dl,[a[30]||(a[30]=b("h3",{class:"text-xl font-bold"},"Finansal Raporlar",-1)),b("button",{onClick:a[8]||(a[8]=e=>E.value=!1),class:"btn btn-sm btn-ghost"},"âœ•")]),C(Ta)])])):u("",!0),H.value?(c(),i("dialog",Ml,[b("div",Cl,[b("div",Il,[a[31]||(a[31]=b("h3",{class:"text-xl font-bold"},"Sistem LoglarÄ±",-1)),b("button",{onClick:a[9]||(a[9]=e=>H.value=!1),class:"btn btn-sm btn-ghost"},"âœ•")]),C(wt)])])):u("",!0),R.value?(c(),i("div",jl,[C(z)])):u("",!0)]))}};export{Bl as default};
