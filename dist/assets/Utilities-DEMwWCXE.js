import{r as e,C as a,o as t,c as r,l,b as s,J as d,D as o,H as n,t as i,F as u,i as c,n as g,e as b,w as y,q as v,K as p,m,f as k,E as x}from"./vue-vendor-BE3w9SvD.js";import{a as w}from"./index-CAkTsZV-.js";import{t as h}from"./tenantsService-DcFCN9jj.js";import{u as f}from"./useErrorHandler-CQcR_3b6.js";import{e as V}from"./expensesService-B7LaUaPi.js";import{a as T}from"./aidatService-B1kcwMFg.js";import{_ as C}from"./FilterBar-wXoQM61V.js";import{u as M}from"./utilityDebtsService-BN5YpzJB.js";import"./useNotification-Dv4wKXE4.js";const A={id:"electricityModal",class:"modal",open:""},D={class:"modal-box max-w-7xl bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700"},S={class:"flex items-center justify-between mb-6 pb-4 border-b border-gray-200 dark:border-gray-700"},j={class:"space-y-6"},N={class:"form-control w-full max-w-xs"},B={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},H={class:"form-control"},E={class:"form-control"},U={class:"form-control"},K={class:"form-control"},L=["value"],I={class:"bg-gray-50 dark:bg-gray-900 rounded-lg p-4"},z={class:"flex items-center justify-between mb-4"},$={class:"bg-blue-100 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400 px-3 py-1 rounded-full text-sm font-medium"},R={class:"overflow-x-auto"},O={class:"table w-full bg-white dark:bg-gray-800 rounded-lg overflow-hidden border border-gray-200 dark:border-gray-700"},W={class:"divide-y divide-gray-200 dark:divide-gray-700"},_={class:"font-medium text-gray-800 dark:text-gray-100"},P={key:0,class:"badge badge-warning badge-xs ml-1"},F={class:"text-gray-700 dark:text-gray-300"},G={key:0,class:"text-xs text-gray-500 dark:text-gray-400 block"},Y=["onUpdate:modelValue","onInput"],q=["onUpdate:modelValue","onInput"],J={class:"font-semibold text-blue-600 dark:text-blue-400"},Q=["onUpdate:modelValue","onInput"],X=["value"],Z={class:"modal-action flex justify-between items-center pt-6 border-t border-gray-200 dark:border-gray-700"},ee={class:"flex gap-2"},ae=["disabled"],te=["disabled"],re={__name:"ElectricityModal",emits:["close"],setup(y,{emit:v}){const p=v,m=e((new Date).toISOString().slice(0,7)),k=e([]),x=e(""),f=e(""),V=e(""),T=a(()=>{if(!x.value||!f.value)return 0;const e=new Date(x.value),a=new Date(f.value)-e;return Math.floor(a/864e5)}),C=a(()=>k.value.some(e=>e.current>0)),M=a(()=>k.value.every(e=>e.current>0)),re=e=>{const a=k.value[e],t=.2*Number(a.kdvHaric);a.toplamTutar=+(Number(a.kdvHaric)+t).toFixed(2)},le=e=>{const a=k.value[e];a.usage=Math.max(0,a.current-a.previous),re(e)},se=async()=>{try{const e=k.value.filter(e=>e.current>0);for(const a of e){const e={flatNumber:a.unit,tenantId:a.tenantId,ownerId:a.ownerId,utilityType:"Electricity",period:m.value,previousReading:a.previous,currentReading:a.current,consumption:a.usage,amount:a.toplamTutar,dueDate:V.value,startDate:x.value,endDate:f.value,isPaid:!1,paidAmount:0};await w.post("/utilitydebts",e)}p("close")}catch(e){alert("Kayıtlar kaydedilirken bir hata oluştu.")}},de=async()=>{try{const e=k.value.filter(e=>e.current>0);for(const a of e){const e={flatNumber:a.unit,tenantId:a.tenantId,ownerId:a.ownerId,utilityType:"Electricity",period:m.value,previousReading:a.previous,currentReading:a.current,consumption:a.usage,amount:a.toplamTutar,dueDate:V.value,startDate:x.value,endDate:f.value,isPaid:!1,paidAmount:0};await w.post("/utilitydebts",e)}p("close")}catch(e){alert("Kayıtlar kaydedilirken bir hata oluştu.")}};return t(async()=>{try{const e=await h.getTenants(),a=await w.get("/flats"),t=await w.get("/utilitydebts/last-readings/electricity"),r=new Map(t.map(e=>[e.flatNumber,e]));k.value=[];const l=[{tenantId:null,ownerId:null,unit:"MESCİT",company:"MESCİT",isActive:!0},{tenantId:null,ownerId:null,unit:"ORTAK ALAN",company:"ORTAK ALAN",isActive:!0}];for(const s of l){const e=r.get(s.unit);k.value.push({...s,previous:e?e.currentReading:0,current:0,usage:0,kdvHaric:0,toplamTutar:0})}e.forEach(e=>{e.flats&&Array.isArray(e.flats)&&e.flats.forEach(t=>{const l=a.find(e=>e.id===t);if(l){const a=r.get(l.flatNumber),t={tenantId:e.id,ownerId:null,unit:l.flatNumber,company:e.company||`${e.firstName} ${e.lastName}`,isActive:"Active"===e.status,previous:a?a.currentReading:0,current:0,usage:0,kdvHaric:0,toplamTutar:0};k.value.push(t)}})});(await w.get("/owners")).forEach(e=>{e.flats&&Array.isArray(e.flats)&&e.flats.forEach(t=>{const l=a.find(e=>e.id===t);if(l){const a=r.get(l.flatNumber),t={tenantId:null,ownerId:e.id,unit:l.flatNumber,company:e.company||`${e.firstName} ${e.lastName}`,isActive:!0,previous:a?a.currentReading:0,current:0,usage:0,kdvHaric:0,toplamTutar:0};k.value.push(t)}})})}catch(e){alert("Veriler yüklenirken bir hata oluştu.")}}),(e,a)=>(l(),r("dialog",A,[s("div",D,[s("div",S,[a[7]||(a[7]=d('<div class="flex items-center gap-3"><div class="bg-amber-100 dark:bg-amber-900/50 text-amber-600 dark:text-amber-400 rounded-full p-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg></div><h3 class="text-xl font-bold text-gray-800 dark:text-gray-100">Elektrik Sayaç Girişi</h3></div>',1)),s("button",{onClick:a[0]||(a[0]=a=>e.$emit("close")),class:"btn btn-ghost btn-sm"},a[6]||(a[6]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),s("div",j,[s("div",N,[a[8]||(a[8]=s("label",{class:"label"},[s("span",{class:"label-text font-semibold text-gray-700 dark:text-gray-300"},"Dönem")],-1)),o(s("input",{type:"month","onUpdate:modelValue":a[1]||(a[1]=e=>m.value=e),class:"input input-bordered w-full bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300"},null,512),[[n,m.value]])]),s("div",B,[s("div",H,[a[9]||(a[9]=s("label",{class:"label"},[s("span",{class:"label-text font-semibold text-gray-700 dark:text-gray-300"},"İlk Okuma Tarihi")],-1)),o(s("input",{type:"date","onUpdate:modelValue":a[2]||(a[2]=e=>x.value=e),class:"input input-bordered w-full bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300"},null,512),[[n,x.value]])]),s("div",E,[a[10]||(a[10]=s("label",{class:"label"},[s("span",{class:"label-text font-semibold text-gray-700 dark:text-gray-300"},"Son Okuma Tarihi")],-1)),o(s("input",{type:"date","onUpdate:modelValue":a[3]||(a[3]=e=>f.value=e),class:"input input-bordered w-full bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300"},null,512),[[n,f.value]])]),s("div",U,[a[11]||(a[11]=s("label",{class:"label"},[s("span",{class:"label-text font-semibold text-gray-700 dark:text-gray-300"},"Son Ödeme Tarihi")],-1)),o(s("input",{type:"date","onUpdate:modelValue":a[4]||(a[4]=e=>V.value=e),class:"input input-bordered w-full bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300"},null,512),[[n,V.value]])]),s("div",K,[a[12]||(a[12]=s("label",{class:"label"},[s("span",{class:"label-text font-semibold text-gray-700 dark:text-gray-300"},"Gün Sayısı")],-1)),s("input",{type:"number",value:T.value,disabled:"",class:"input input-bordered w-full bg-gray-100 dark:bg-gray-600 border-gray-300 dark:border-gray-600 text-gray-500 dark:text-gray-400"},null,8,L)])]),s("div",I,[s("div",z,[a[13]||(a[13]=s("h4",{class:"text-lg font-semibold text-gray-800 dark:text-gray-100"},"Sayaç Okumaları",-1)),s("div",$,i(k.value.length)+" Birim ",1)]),s("div",R,[s("table",O,[a[14]||(a[14]=s("thead",{class:"bg-gray-100 dark:bg-gray-700"},[s("tr",null,[s("th",{class:"text-gray-700 dark:text-gray-300 font-semibold"},"Kat"),s("th",{class:"text-gray-700 dark:text-gray-300 font-semibold"},"Şirket"),s("th",{class:"text-gray-700 dark:text-gray-300 font-semibold"},"Önceki Sayaç"),s("th",{class:"text-gray-700 dark:text-gray-300 font-semibold"},"Yeni Sayaç"),s("th",{class:"text-gray-700 dark:text-gray-300 font-semibold"},"Tüketim"),s("th",{class:"text-gray-700 dark:text-gray-300 font-semibold"},"KDV Hariç"),s("th",{class:"text-gray-700 dark:text-gray-300 font-semibold"},"Toplam Tutar")])],-1)),s("tbody",W,[(l(!0),r(u,null,c(k.value,(e,a)=>(l(),r("tr",{key:a,class:"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors duration-200"},[s("td",_,[g(i(e.unit)+" ",1),!1===e.isActive?(l(),r("span",P,"Pasif")):b("",!0)]),s("td",F,[g(i(e.company)+" ",1),!1===e.isActive?(l(),r("span",G,"(Pasif Kiracı)")):b("",!0)]),s("td",null,[o(s("input",{type:"number",class:"input input-bordered input-sm w-24 bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300","onUpdate:modelValue":a=>e.previous=a,onInput:e=>le(a)},null,40,Y),[[n,e.previous,void 0,{number:!0}]])]),s("td",null,[o(s("input",{type:"number",class:"input input-bordered input-sm w-24 bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300","onUpdate:modelValue":a=>e.current=a,onInput:e=>le(a)},null,40,q),[[n,e.current,void 0,{number:!0}]])]),s("td",J,i(e.usage),1),s("td",null,[o(s("input",{type:"number",class:"input input-bordered input-sm w-28 bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300","onUpdate:modelValue":a=>e.kdvHaric=a,onInput:e=>re(a)},null,40,Q),[[n,e.kdvHaric,void 0,{number:!0}]])]),s("td",null,[s("input",{type:"number",class:"input input-bordered input-sm w-28 bg-gray-100 dark:bg-gray-600 border-gray-300 dark:border-gray-600 text-gray-500 dark:text-gray-400",value:e.toplamTutar,disabled:""},null,8,X)])]))),128))])])])])]),s("div",Z,[s("div",ee,[s("button",{class:"btn btn-success btn-sm",onClick:de,disabled:!C.value},a[15]||(a[15]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5 13l4 4L19 7"})],-1),g(" Girilenleri Kaydet ")]),8,ae),s("button",{class:"btn btn-primary btn-sm",onClick:se,disabled:!M.value},a[16]||(a[16]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1),g(" Tümünü Kaydet ")]),8,te)]),s("button",{class:"btn btn-outline btn-sm",onClick:a[5]||(a[5]=a=>e.$emit("close"))},a[17]||(a[17]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1),g(" Kapat ")]))])])]))}},le={id:"waterModal",class:"modal",open:""},se={class:"modal-box max-w-7xl bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700"},de={class:"flex items-center justify-between mb-6 pb-4 border-b border-gray-200 dark:border-gray-700"},oe={class:"space-y-6"},ne={class:"form-control w-full max-w-xs"},ie={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},ue={class:"form-control"},ce={class:"form-control"},ge={class:"form-control"},be={class:"form-control"},ye=["value"],ve={class:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 border border-blue-200 dark:border-blue-800"},pe={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},me={class:"form-control"},ke={class:"form-control"},xe={class:"bg-gray-50 dark:bg-gray-900 rounded-lg p-4"},we={class:"flex items-center justify-between mb-4"},he={class:"bg-blue-100 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400 px-3 py-1 rounded-full text-sm font-medium"},fe={class:"overflow-x-auto"},Ve={class:"table w-full bg-white dark:bg-gray-800 rounded-lg overflow-hidden border border-gray-200 dark:border-gray-700"},Te={class:"divide-y divide-gray-200 dark:divide-gray-700"},Ce={class:"font-medium text-gray-800 dark:text-gray-100"},Me={key:0,class:"badge badge-warning badge-xs ml-1"},Ae={class:"text-gray-700 dark:text-gray-300"},De={key:0,class:"text-xs text-gray-500 dark:text-gray-400 block"},Se=["onUpdate:modelValue","onInput"],je=["onUpdate:modelValue","onInput"],Ne={class:"font-semibold text-blue-600 dark:text-blue-400"},Be={class:"font-medium text-gray-800 dark:text-gray-100"},He={class:"font-bold text-green-600 dark:text-green-400"},Ee={class:"modal-action flex justify-between items-center pt-6 border-t border-gray-200 dark:border-gray-700"},Ue={class:"flex gap-2"},Ke=["disabled"],Le=["disabled"],Ie={__name:"WaterModal",emits:["close"],setup(v,{emit:p}){const m=p,k=e([]),x=e([]),f=e((new Date).toISOString().slice(0,7)),V=e(""),T=e(""),C=e(""),M=e(0),A=e(0),D=a(()=>{if(!V.value||!T.value)return 0;const e=new Date(V.value),a=new Date(T.value)-e;return Math.floor(a/864e5)}),S=a(()=>V.value&&T.value&&D.value>0),j=a(()=>x.value.some(e=>e.previous>=0&&e.current>e.previous)),N=a(()=>x.value.every(e=>e.previous>=0&&e.current>e.previous)),B=e=>isNaN(e)?"0.00":Number(e).toFixed(2),H=e=>{const a=x.value[e];a.usage=Math.max(0,a.current-a.previous);const t=a.usage*(M.value+A.value),r=a.usage*M.value*.01,l=a.usage*A.value*.1;a.kdvHaric=t,a.kdvDahil=t+r+l,a.toplamTutar=a.kdvDahil};y([M,A],()=>{x.value.forEach((e,a)=>H(a))});const E=async(e=!1)=>{if(S.value)try{const a=e?x.value.filter(e=>e.previous>=0&&e.current>e.previous):x.value;for(const e of a){const a={flatNumber:e.unit,tenantId:e.tenantId,ownerId:e.ownerId,utilityType:"Water",period:f.value,previousReading:e.previous,currentReading:e.current,consumption:e.usage,amount:e.kdvDahil,dueDate:C.value,startDate:V.value,endDate:T.value,isPaid:!1,paidAmount:0,waterUnitPrice:M.value,wasteUnitPrice:A.value};await w.post("/utilitydebts",a)}alert(e?"Girilen kayıtlar eklendi.":"Tüm kayıtlar eklendi."),m("close")}catch(a){alert("Kayıtlar kaydedilirken bir hata oluştu.")}else alert("Lütfen geçerli bir tarih aralığı seçin.")},U=()=>E(!1),K=()=>E(!0);return t(async()=>{try{k.value=[],x.value=[];const e=await h.getTenants(),a=await w.get("/flats"),t=await w.get("/utilitydebts/last-readings/water"),r=new Map(t.map(e=>[e.flatNumber,e])),l=[{tenantId:null,ownerId:null,unit:"ORTAK ALAN",name:"ORTAK ALAN",isActive:!0},{tenantId:null,ownerId:null,unit:"MESCİT",name:"MESCİT",isActive:!0}];for(const s of l){const e=r.get(s.unit);x.value.push({...s,previous:e?e.currentReading:0,current:0,usage:0,kdvHaric:0,kdvDahil:0})}e.forEach(e=>{e.flats&&Array.isArray(e.flats)&&e.flats.forEach(t=>{const l=a.find(e=>e.id===t);if(l){const a=r.get(l.flatNumber),t={tenantId:e.id,ownerId:null,unit:l.flatNumber,name:e.company||`${e.firstName} ${e.lastName}`,isActive:"Active"===e.status,previous:a?a.currentReading:0,current:0,usage:0,kdvHaric:0,kdvDahil:0};x.value.push(t)}})});(await w.get("/owners")).forEach(e=>{e.flats&&Array.isArray(e.flats)&&e.flats.forEach(t=>{const l=a.find(e=>e.id===t);if(l){const a=r.get(l.flatNumber),t={tenantId:null,ownerId:e.id,unit:l.flatNumber,name:e.company||`${e.firstName} ${e.lastName}`,isActive:!0,previous:a?a.currentReading:0,current:0,usage:0,kdvHaric:0,kdvDahil:0};x.value.push(t)}})})}catch(e){alert("Veriler yüklenirken bir hata oluştu.")}}),(e,a)=>(l(),r("dialog",le,[s("div",se,[s("div",de,[a[9]||(a[9]=d('<div class="flex items-center gap-3"><div class="bg-blue-100 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400 rounded-full p-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path></svg></div><h3 class="text-xl font-bold text-gray-800 dark:text-gray-100">Su Sayaç Girişi</h3></div>',1)),s("button",{onClick:a[0]||(a[0]=a=>e.$emit("close")),class:"btn btn-ghost btn-sm"},a[8]||(a[8]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),s("div",oe,[s("div",ne,[a[10]||(a[10]=s("label",{class:"label"},[s("span",{class:"label-text font-semibold text-gray-700 dark:text-gray-300"},"Dönem")],-1)),o(s("input",{type:"month","onUpdate:modelValue":a[1]||(a[1]=e=>f.value=e),class:"input input-bordered w-full bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300"},null,512),[[n,f.value]])]),s("div",ie,[s("div",ue,[a[11]||(a[11]=s("label",{class:"label"},[s("span",{class:"label-text font-semibold text-gray-700 dark:text-gray-300"},"Başlangıç Tarihi")],-1)),o(s("input",{type:"date","onUpdate:modelValue":a[2]||(a[2]=e=>V.value=e),class:"input input-bordered w-full bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300"},null,512),[[n,V.value]])]),s("div",ce,[a[12]||(a[12]=s("label",{class:"label"},[s("span",{class:"label-text font-semibold text-gray-700 dark:text-gray-300"},"Bitiş Tarihi")],-1)),o(s("input",{type:"date","onUpdate:modelValue":a[3]||(a[3]=e=>T.value=e),class:"input input-bordered w-full bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300"},null,512),[[n,T.value]])]),s("div",ge,[a[13]||(a[13]=s("label",{class:"label"},[s("span",{class:"label-text font-semibold text-gray-700 dark:text-gray-300"},"Son Ödeme Tarihi")],-1)),o(s("input",{type:"date","onUpdate:modelValue":a[4]||(a[4]=e=>C.value=e),class:"input input-bordered w-full bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300"},null,512),[[n,C.value]])]),s("div",be,[a[14]||(a[14]=s("label",{class:"label"},[s("span",{class:"label-text font-semibold text-gray-700 dark:text-gray-300"},"Gün Sayısı")],-1)),s("input",{type:"number",value:D.value,disabled:"",class:"input input-bordered w-full bg-gray-100 dark:bg-gray-600 border-gray-300 dark:border-gray-600 text-gray-500 dark:text-gray-400"},null,8,ye)])]),s("div",ve,[a[17]||(a[17]=s("h4",{class:"text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4"},"Birim Fiyatlar",-1)),s("div",pe,[s("div",me,[a[15]||(a[15]=s("label",{class:"label"},[s("span",{class:"label-text font-semibold text-gray-700 dark:text-gray-300"},"Su Birim Fiyatı (₺/m³)")],-1)),o(s("input",{type:"number","onUpdate:modelValue":a[5]||(a[5]=e=>M.value=e),class:"input input-bordered w-full bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300",step:"0.01"},null,512),[[n,M.value,void 0,{number:!0}]])]),s("div",ke,[a[16]||(a[16]=s("label",{class:"label"},[s("span",{class:"label-text font-semibold text-gray-700 dark:text-gray-300"},"Atık Su Birim Fiyatı (₺/m³)")],-1)),o(s("input",{type:"number","onUpdate:modelValue":a[6]||(a[6]=e=>A.value=e),class:"input input-bordered w-full bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300",step:"0.01"},null,512),[[n,A.value,void 0,{number:!0}]])])])]),s("div",xe,[s("div",we,[a[18]||(a[18]=s("h4",{class:"text-lg font-semibold text-gray-800 dark:text-gray-100"},"Sayaç Okumaları",-1)),s("div",he,i(x.value.length)+" Birim ",1)]),s("div",fe,[s("table",Ve,[a[19]||(a[19]=s("thead",{class:"bg-gray-100 dark:bg-gray-700"},[s("tr",null,[s("th",{class:"text-gray-700 dark:text-gray-300 font-semibold"},"Kat"),s("th",{class:"text-gray-700 dark:text-gray-300 font-semibold"},"Şirket"),s("th",{class:"text-gray-700 dark:text-gray-300 font-semibold"},"Önceki Sayaç"),s("th",{class:"text-gray-700 dark:text-gray-300 font-semibold"},"Yeni Sayaç"),s("th",{class:"text-gray-700 dark:text-gray-300 font-semibold"},"Tüketim (m³)"),s("th",{class:"text-gray-700 dark:text-gray-300 font-semibold"},"KDV Hariç"),s("th",{class:"text-gray-700 dark:text-gray-300 font-semibold"},"KDV Dahil")])],-1)),s("tbody",Te,[(l(!0),r(u,null,c(x.value,(e,a)=>(l(),r("tr",{key:a,class:"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors duration-200"},[s("td",Ce,[g(i(e.unit)+" ",1),!1===e.isActive?(l(),r("span",Me,"Pasif")):b("",!0)]),s("td",Ae,[g(i(e.name)+" ",1),!1===e.isActive?(l(),r("span",De,"(Pasif Kiracı)")):b("",!0)]),s("td",null,[o(s("input",{type:"number",class:"input input-bordered input-sm w-24 bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300","onUpdate:modelValue":a=>e.previous=a,onInput:e=>H(a)},null,40,Se),[[n,e.previous,void 0,{number:!0}]])]),s("td",null,[o(s("input",{type:"number",class:"input input-bordered input-sm w-24 bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300","onUpdate:modelValue":a=>e.current=a,onInput:e=>H(a)},null,40,je),[[n,e.current,void 0,{number:!0}]])]),s("td",Ne,i(B(e.usage)),1),s("td",Be,i(B(e.kdvHaric)),1),s("td",He,i(B(e.kdvDahil)),1)]))),128))])])])])]),s("div",Ee,[s("div",Ue,[s("button",{class:"btn btn-success btn-sm",onClick:K,disabled:!j.value||!S.value},a[20]||(a[20]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5 13l4 4L19 7"})],-1),g(" Girilenleri Kaydet ")]),8,Ke),s("button",{class:"btn btn-primary btn-sm",onClick:U,disabled:!N.value||!S.value},a[21]||(a[21]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1),g(" Tümünü Kaydet ")]),8,Le)]),s("button",{class:"btn btn-outline btn-sm",onClick:a[7]||(a[7]=a=>e.$emit("close"))},a[22]||(a[22]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1),g(" Kapat ")]))])])]))}},ze={open:"",class:"modal"},$e={class:"modal-box max-w-md bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700"},Re={class:"space-y-4"},Oe={class:"form-control"},We={class:"form-control"},_e={class:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700"},Pe=["disabled"],Fe={__name:"AidatModal",emits:["close","refresh"],setup(a,{emit:t}){const i=t,u=e(""),c=e(""),b=()=>{i("close")},y=async()=>{try{if(!u.value||!c.value)return void alert("Lütfen dönem ve son ödeme tarihini giriniz.");const e=parseInt(u.value.slice(0,4)),a=await w.post("/utilitydebts/create-aidat",{period:u.value,dueDate:c.value,year:e});if(0===a.tenantDuesCreated&&0===a.ownerDuesCreated)return void alert(`Seçilen dönem (${u.value}) için zaten tüm aidat kayıtları oluşturulmuş veya tanımlı aidat bulunmuyor.`);alert(`${a.tenantDuesCreated} kiracı ve ${a.ownerDuesCreated} mal sahibi için aidat kayıtları başarıyla oluşturuldu.`),i("refresh"),i("close")}catch(e){alert("Bir hata oluştu. Konsolu kontrol ediniz.")}};return(e,a)=>(l(),r("dialog",ze,[s("div",$e,[s("div",{class:"flex items-center justify-between mb-6 pb-4 border-b border-gray-200 dark:border-gray-700"},[a[3]||(a[3]=d('<div class="flex items-center gap-3"><div class="bg-green-100 dark:bg-green-900/50 text-green-600 dark:text-green-400 rounded-full p-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path></svg></div><h3 class="text-xl font-bold text-gray-800 dark:text-gray-100">Aidat Oluştur</h3></div>',1)),s("button",{onClick:b,class:"btn btn-ghost btn-sm"},a[2]||(a[2]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),s("form",{onSubmit:v(y,["prevent"]),class:"space-y-6"},[s("div",Re,[s("div",Oe,[a[4]||(a[4]=s("label",{class:"label"},[s("span",{class:"label-text font-semibold text-gray-700 dark:text-gray-300"},"Dönem"),s("span",{class:"label-text-alt text-red-500"},"*")],-1)),o(s("input",{type:"month","onUpdate:modelValue":a[0]||(a[0]=e=>u.value=e),class:"input input-bordered w-full bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300",required:""},null,512),[[n,u.value]]),a[5]||(a[5]=s("label",{class:"label"},[s("span",{class:"label-text-alt text-gray-500 dark:text-gray-400"},"Aidatın geçerli olacağı ay ve yıl")],-1))]),s("div",We,[a[6]||(a[6]=s("label",{class:"label"},[s("span",{class:"label-text font-semibold text-gray-700 dark:text-gray-300"},"Son Ödeme Tarihi"),s("span",{class:"label-text-alt text-red-500"},"*")],-1)),o(s("input",{type:"date","onUpdate:modelValue":a[1]||(a[1]=e=>c.value=e),class:"input input-bordered w-full bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300",required:""},null,512),[[n,c.value]]),a[7]||(a[7]=s("label",{class:"label"},[s("span",{class:"label-text-alt text-gray-500 dark:text-gray-400"},"Aidatın son ödeme tarihi")],-1))])]),a[10]||(a[10]=d('<div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 border border-blue-200 dark:border-blue-800"><div class="flex items-start gap-3"><div class="bg-blue-100 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400 rounded-full p-1 mt-0.5"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div><div class="text-sm text-gray-700 dark:text-gray-300"><p class="font-medium mb-1">Bilgi</p><p>Seçilen dönem için yıllık aidat tanımlarından otomatik olarak aidat kayıtları oluşturulacaktır.</p></div></div></div>',1)),s("div",_e,[s("button",{type:"button",class:"btn btn-outline btn-sm",onClick:b},a[8]||(a[8]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1),g(" İptal ")])),s("button",{type:"submit",class:"btn btn-primary btn-sm",disabled:!u.value||!c.value},a[9]||(a[9]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1),g(" Oluştur ")]),8,Pe)])],32)])]))}},Ge={key:0,open:"",class:"modal"},Ye={class:"modal-box max-w-2xl bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700"},qe={class:"flex items-center justify-between mb-6 pb-4 border-b border-gray-200 dark:border-gray-700"},Je={class:"space-y-6"},Qe={class:"bg-gray-50 dark:bg-gray-900 rounded-lg p-4 space-y-4"},Xe={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ze={class:"form-control"},ea=["value"],aa={class:"form-control"},ta=["value"],ra={class:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 space-y-4"},la={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},sa={class:"form-control"},da={class:"form-control"},oa={class:"bg-white dark:bg-gray-700 rounded-lg p-4 border border-blue-200 dark:border-blue-800"},na={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ia={class:"text-center"},ua={class:"text-lg font-bold text-blue-600 dark:text-blue-400"},ca={class:"text-center"},ga={class:"text-lg font-bold text-green-600 dark:text-green-400"},ba={class:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4 space-y-4"},ya={class:"form-control"},va={key:0,class:"space-y-3"},pa={key:0,class:"bg-red-50 dark:bg-red-900/20 rounded-lg p-4 border border-red-200 dark:border-red-800"},ma={class:"flex items-start gap-3"},ka={class:"text-sm text-gray-700 dark:text-gray-300"},xa={class:"list-disc list-inside space-y-1"},wa={key:1,class:"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4 border border-yellow-200 dark:border-yellow-800"},ha={class:"flex items-start gap-3"},fa={class:"text-sm text-gray-700 dark:text-gray-300"},Va={class:"list-disc list-inside space-y-1"},Ta={class:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700"},Ca=["disabled"],Ma={__name:"EditElectricityModal",props:{record:Object},emits:["close","updated"],setup(a,{emit:t}){const v=a,p=t,{handleNetworkError:m,handleValidationError:k,showSuccess:x}=f(),w=e({previousValue:0,currentValue:0,kdvHaric:0}),h=e({isValid:!0,issues:[],warnings:[]}),T=()=>{var e;const a={currentValue:w.value.currentValue,previousValue:w.value.previousValue,endDate:null==(e=v.record)?void 0:e.endDate};h.value=V.validateReadingEdit(v.record,a)};y(()=>v.record,e=>{e&&(w.value.previousValue=e.previousValue??0,w.value.currentValue=e.currentValue??0,w.value.kdvHaric=e.kdvHaric??0,T())},{immediate:!0});const C=async()=>{try{if(T(),!h.value.isValid)return void k("Lütfen hataları düzeltin.");const e=V.calculateConsumption(w.value.currentValue,w.value.previousValue),a=V.calculateTotalWithVAT(w.value.kdvHaric,.2);await V.updateReading(v.record.id,{previousValue:w.value.previousValue,currentValue:w.value.currentValue,consumption:e,kdvHaric:w.value.kdvHaric,toplamTutar:a,kdvDahil:a,remainingAmount:a-(v.record.paidAmount||0),isPaid:a-(v.record.paidAmount||0)<=0,lastModified:new Date,modifiedBy:"unknown_user"}),x("Elektrik kaydı başarıyla güncellendi."),p("updated"),p("close")}catch(e){m("Elektrik kaydı güncellenirken bir hata oluştu.",e)}};return(e,t)=>{return a.record?(l(),r("dialog",Ge,[s("div",Ye,[s("div",qe,[t[6]||(t[6]=d('<div class="flex items-center gap-3"><div class="bg-yellow-100 dark:bg-yellow-900/50 text-yellow-600 dark:text-yellow-400 rounded-full p-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg></div><h3 class="text-xl font-bold text-gray-800 dark:text-gray-100">Elektrik Kaydı Düzenle</h3></div>',1)),s("button",{onClick:t[0]||(t[0]=a=>e.$emit("close")),class:"btn btn-ghost btn-sm"},t[5]||(t[5]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),s("div",Je,[s("div",Qe,[t[9]||(t[9]=s("h4",{class:"text-lg font-semibold text-gray-800 dark:text-gray-100 mb-3"},"Kayıt Bilgileri",-1)),s("div",Xe,[s("div",Ze,[t[7]||(t[7]=s("label",{class:"label"},[s("span",{class:"label-text font-semibold text-gray-700 dark:text-gray-300"},"Kat")],-1)),s("input",{type:"text",class:"input input-bordered w-full bg-gray-100 dark:bg-gray-600 border-gray-300 dark:border-gray-600 text-gray-500 dark:text-gray-400",value:a.record.unit,disabled:""},null,8,ea)]),s("div",aa,[t[8]||(t[8]=s("label",{class:"label"},[s("span",{class:"label-text font-semibold text-gray-700 dark:text-gray-300"},"Şirket")],-1)),s("input",{type:"text",class:"input input-bordered w-full bg-gray-100 dark:bg-gray-600 border-gray-300 dark:border-gray-600 text-gray-500 dark:text-gray-400",value:a.record.tenantName||"-",disabled:""},null,8,ta)])])]),s("div",ra,[t[14]||(t[14]=s("h4",{class:"text-lg font-semibold text-gray-800 dark:text-gray-100 mb-3"},"Sayaç Okumaları",-1)),s("div",la,[s("div",sa,[t[10]||(t[10]=s("label",{class:"label"},[s("span",{class:"label-text font-semibold text-gray-700 dark:text-gray-300"},"Önceki Endeks (kWh)"),s("span",{class:"label-text-alt text-red-500"},"*")],-1)),o(s("input",{type:"number","onUpdate:modelValue":t[1]||(t[1]=e=>w.value.previousValue=e),class:"input input-bordered w-full bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300",min:"0",step:"0.01",onInput:T},null,544),[[n,w.value.previousValue,void 0,{number:!0}]])]),s("div",da,[t[11]||(t[11]=s("label",{class:"label"},[s("span",{class:"label-text font-semibold text-gray-700 dark:text-gray-300"},"Yeni Endeks (kWh)"),s("span",{class:"label-text-alt text-red-500"},"*")],-1)),o(s("input",{type:"number","onUpdate:modelValue":t[2]||(t[2]=e=>w.value.currentValue=e),class:"input input-bordered w-full bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300",min:"0",step:"0.01",onInput:T},null,544),[[n,w.value.currentValue,void 0,{number:!0}]])])]),s("div",oa,[s("div",na,[s("div",ia,[t[12]||(t[12]=s("p",{class:"text-sm text-gray-600 dark:text-gray-400 mb-1"},"Tüketim",-1)),s("p",ua,i(w.value.currentValue-w.value.previousValue)+" kWh ",1)]),s("div",ca,[t[13]||(t[13]=s("p",{class:"text-sm text-gray-600 dark:text-gray-400 mb-1"},"Toplam (KDV Dahil)",-1)),s("p",ga,i((y=1.2*w.value.kdvHaric,isNaN(y)?"-":y.toLocaleString("tr-TR",{style:"currency",currency:"TRY"}))),1)])])])]),s("div",ba,[t[17]||(t[17]=s("h4",{class:"text-lg font-semibold text-gray-800 dark:text-gray-100 mb-3"},"Tutar Bilgileri",-1)),s("div",ya,[t[15]||(t[15]=s("label",{class:"label"},[s("span",{class:"label-text font-semibold text-gray-700 dark:text-gray-300"},"KDV Hariç Tutar (₺)"),s("span",{class:"label-text-alt text-red-500"},"*")],-1)),o(s("input",{type:"number","onUpdate:modelValue":t[3]||(t[3]=e=>w.value.kdvHaric=e),class:"input input-bordered w-full bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300",step:"0.01",min:"0"},null,512),[[n,w.value.kdvHaric,void 0,{number:!0}]]),t[16]||(t[16]=s("label",{class:"label"},[s("span",{class:"label-text-alt text-gray-500 dark:text-gray-400"},"KDV hariç elektrik tutarı")],-1))])]),h.value.issues.length>0||h.value.warnings.length>0?(l(),r("div",va,[h.value.issues.length>0?(l(),r("div",pa,[s("div",ma,[t[19]||(t[19]=s("div",{class:"bg-red-100 dark:bg-red-900/50 text-red-600 dark:text-red-400 rounded-full p-1 mt-0.5"},[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),s("div",ka,[t[18]||(t[18]=s("p",{class:"font-medium mb-1 text-red-600 dark:text-red-400"},"Hatalar",-1)),s("ul",xa,[(l(!0),r(u,null,c(h.value.issues,e=>(l(),r("li",{key:e,class:"text-red-600 dark:text-red-400"},i(e),1))),128))])])])])):b("",!0),h.value.warnings.length>0?(l(),r("div",wa,[s("div",ha,[t[21]||(t[21]=s("div",{class:"bg-yellow-100 dark:bg-yellow-900/50 text-yellow-600 dark:text-yellow-400 rounded-full p-1 mt-0.5"},[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})])],-1)),s("div",fa,[t[20]||(t[20]=s("p",{class:"font-medium mb-1"},"Uyarılar",-1)),s("ul",Va,[(l(!0),r(u,null,c(h.value.warnings,e=>(l(),r("li",{key:e},i(e),1))),128))])])])])):b("",!0)])):b("",!0),s("div",Ta,[s("button",{class:"btn btn-outline btn-sm",onClick:t[4]||(t[4]=a=>e.$emit("close"))},t[22]||(t[22]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1),g(" İptal ")])),s("button",{class:"btn btn-primary btn-sm",onClick:C,disabled:!h.value.isValid||w.value.previousValue<0||w.value.currentValue<0||w.value.kdvHaric<0},t[23]||(t[23]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5 13l4 4L19 7"})],-1),g(" Kaydet ")]),8,Ca)])])])])):b("",!0);var y}}},Aa={open:"",class:"modal"},Da={class:"modal-box max-w-2xl bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700"},Sa={class:"flex items-center justify-between mb-6 pb-4 border-b border-gray-200 dark:border-gray-700"},ja={class:"space-y-6"},Na={class:"bg-gray-50 dark:bg-gray-900 rounded-lg p-4 space-y-4"},Ba={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ha={class:"form-control"},Ea=["value"],Ua={class:"form-control"},Ka=["value"],La={class:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 space-y-4"},Ia={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},za={class:"form-control"},$a={class:"form-control"},Ra={class:"bg-white dark:bg-gray-700 rounded-lg p-4 border border-blue-200 dark:border-blue-800"},Oa={class:"text-center"},Wa={class:"text-lg font-bold text-blue-600 dark:text-blue-400"},_a={class:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4 space-y-4"},Pa={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Fa={class:"form-control"},Ga={class:"form-control"},Ya={class:"bg-white dark:bg-gray-700 rounded-lg p-4 border border-green-200 dark:border-green-800"},qa={class:"text-center"},Ja={class:"text-lg font-bold text-green-600 dark:text-green-400"},Qa={class:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700"},Xa=["disabled"],Za={__name:"EditWaterModal",props:{record:Object},emits:["close","updated"],setup(t,{emit:u}){const c=t,b=u,{handleNetworkError:y,handleValidationError:v,showSuccess:m}=f(),k=e({previousValue:0,currentValue:0,kdvHaric:0}),x=e({isValid:!0,issues:[],warnings:[]}),w=()=>{var e;const a={currentValue:k.value.currentValue,previousValue:k.value.previousValue,endDate:null==(e=c.record)?void 0:e.endDate};x.value=meterManager.validateReadingEdit(c.record,a)};p(()=>{c.record&&(k.value.previousValue=c.record.previousValue??0,k.value.currentValue=c.record.currentValue??0,k.value.kdvHaric=c.record.kdvHaric??0,w())});const h=a(()=>+(1.01*k.value.kdvHaric+1.1*k.value.wasteAmount).toFixed(2)),V=async()=>{var e,a;try{if(w(),!x.value.isValid)return void v("Lütfen hataları düzeltin.",{component:"EditWaterModal",action:"save"});const t=calculateConsumption(k.value.currentValue,k.value.previousValue),r=calculateTotalWithVAT(k.value.kdvHaric,.2),l=doc(db,"readings",c.record.id),s=meterManager.createAuditTrail(c.record,{...c.record,...k.value,consumption:t,toplamTutar:r},(null==(e=authStore.user)?void 0:e.uid)||"unknown_user");await updateDoc(l,{previousValue:k.value.previousValue,currentValue:k.value.currentValue,consumption:t,kdvHaric:k.value.kdvHaric,toplamTutar:r,kdvDahil:r,remainingAmount:r-(c.record.paidAmount||0),isPaid:r-(c.record.paidAmount||0)<=0,lastModified:new Date,modifiedBy:(null==(a=authStore.user)?void 0:a.uid)||"unknown_user"}),await addDoc(collection(db,"auditTrail"),s),meterManager.clearCacheForUnit(c.record.unit,"water"),m("Su kaydı başarıyla güncellendi.",{component:"EditWaterModal",action:"save"}),b("updated"),b("close")}catch(t){y(t,{component:"EditWaterModal",action:"save"})}};return(e,a)=>{return l(),r("dialog",Aa,[s("div",Da,[s("div",Sa,[a[7]||(a[7]=d('<div class="flex items-center gap-3"><div class="bg-yellow-100 dark:bg-yellow-900/50 text-yellow-600 dark:text-yellow-400 rounded-full p-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg></div><h3 class="text-xl font-bold text-gray-800 dark:text-gray-100">Su Kaydı Düzenle</h3></div>',1)),s("button",{onClick:a[0]||(a[0]=a=>e.$emit("close")),class:"btn btn-ghost btn-sm"},a[6]||(a[6]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),s("div",ja,[s("div",Na,[a[10]||(a[10]=s("h4",{class:"text-lg font-semibold text-gray-800 dark:text-gray-100 mb-3"},"Kayıt Bilgileri",-1)),s("div",Ba,[s("div",Ha,[a[8]||(a[8]=s("label",{class:"label"},[s("span",{class:"label-text font-semibold text-gray-700 dark:text-gray-300"},"Kat")],-1)),s("input",{type:"text",class:"input input-bordered w-full bg-gray-100 dark:bg-gray-600 border-gray-300 dark:border-gray-600 text-gray-500 dark:text-gray-400",value:t.record.unit,disabled:""},null,8,Ea)]),s("div",Ua,[a[9]||(a[9]=s("label",{class:"label"},[s("span",{class:"label-text font-semibold text-gray-700 dark:text-gray-300"},"Şirket")],-1)),s("input",{type:"text",class:"input input-bordered w-full bg-gray-100 dark:bg-gray-600 border-gray-300 dark:border-gray-600 text-gray-500 dark:text-gray-400",value:t.record.tenantName||"-",disabled:""},null,8,Ka)])])]),s("div",La,[a[14]||(a[14]=s("h4",{class:"text-lg font-semibold text-gray-800 dark:text-gray-100 mb-3"},"Sayaç Okumaları",-1)),s("div",Ia,[s("div",za,[a[11]||(a[11]=s("label",{class:"label"},[s("span",{class:"label-text font-semibold text-gray-700 dark:text-gray-300"},"Önceki Endeks (m³)"),s("span",{class:"label-text-alt text-red-500"},"*")],-1)),o(s("input",{type:"number","onUpdate:modelValue":a[1]||(a[1]=e=>k.value.previousValue=e),class:"input input-bordered w-full bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300",min:"0",step:"0.01"},null,512),[[n,k.value.previousValue,void 0,{number:!0}]])]),s("div",$a,[a[12]||(a[12]=s("label",{class:"label"},[s("span",{class:"label-text font-semibold text-gray-700 dark:text-gray-300"},"Yeni Endeks (m³)"),s("span",{class:"label-text-alt text-red-500"},"*")],-1)),o(s("input",{type:"number","onUpdate:modelValue":a[2]||(a[2]=e=>k.value.currentValue=e),class:"input input-bordered w-full bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300",min:"0",step:"0.01"},null,512),[[n,k.value.currentValue,void 0,{number:!0}]])])]),s("div",Ra,[s("div",Oa,[a[13]||(a[13]=s("p",{class:"text-sm text-gray-600 dark:text-gray-400 mb-1"},"Tüketim",-1)),s("p",Wa,i(k.value.currentValue-k.value.previousValue)+" m³ ",1)])])]),s("div",_a,[a[20]||(a[20]=s("h4",{class:"text-lg font-semibold text-gray-800 dark:text-gray-100 mb-3"},"Tutar Bilgileri",-1)),s("div",Pa,[s("div",Fa,[a[15]||(a[15]=s("label",{class:"label"},[s("span",{class:"label-text font-semibold text-gray-700 dark:text-gray-300"},"Su Tutarı (₺)"),s("span",{class:"label-text-alt text-red-500"},"*")],-1)),o(s("input",{type:"number","onUpdate:modelValue":a[3]||(a[3]=e=>k.value.kdvHaric=e),class:"input input-bordered w-full bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300",step:"0.01",min:"0"},null,512),[[n,k.value.kdvHaric,void 0,{number:!0}]]),a[16]||(a[16]=s("label",{class:"label"},[s("span",{class:"label-text-alt text-gray-500 dark:text-gray-400"},"KDV hariç su tutarı (%1 KDV)")],-1))]),s("div",Ga,[a[17]||(a[17]=s("label",{class:"label"},[s("span",{class:"label-text font-semibold text-gray-700 dark:text-gray-300"},"Atık Su Tutarı (₺)"),s("span",{class:"label-text-alt text-red-500"},"*")],-1)),o(s("input",{type:"number","onUpdate:modelValue":a[4]||(a[4]=e=>k.value.wasteAmount=e),class:"input input-bordered w-full bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300",step:"0.01",min:"0"},null,512),[[n,k.value.wasteAmount,void 0,{number:!0}]]),a[18]||(a[18]=s("label",{class:"label"},[s("span",{class:"label-text-alt text-gray-500 dark:text-gray-400"},"KDV hariç atık su tutarı (%10 KDV)")],-1))])]),s("div",Ya,[s("div",qa,[a[19]||(a[19]=s("p",{class:"text-sm text-gray-600 dark:text-gray-400 mb-1"},"Toplam (KDV Dahil)",-1)),s("p",Ja,i((u=h.value,isNaN(u)?"-":u.toLocaleString("tr-TR",{style:"currency",currency:"TRY"}))),1)])])]),a[23]||(a[23]=d('<div class="bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4 border border-yellow-200 dark:border-yellow-800"><div class="flex items-start gap-3"><div class="bg-yellow-100 dark:bg-yellow-900/50 text-yellow-600 dark:text-yellow-400 rounded-full p-1 mt-0.5"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path></svg></div><div class="text-sm text-gray-700 dark:text-gray-300"><p class="font-medium mb-1">Dikkat</p><p>Bu değişiklik su kaydını kalıcı olarak güncelleyecektir. Tüketim ve toplam tutar otomatik olarak hesaplanacaktır.</p></div></div></div>',1)),s("div",Qa,[s("button",{class:"btn btn-outline btn-sm",onClick:a[5]||(a[5]=a=>e.$emit("close"))},a[21]||(a[21]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1),g(" İptal ")])),s("button",{class:"btn btn-primary btn-sm",onClick:V,disabled:k.value.previousValue<0||k.value.currentValue<0||k.value.kdvHaric<0||k.value.wasteAmount<0},a[22]||(a[22]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5 13l4 4L19 7"})],-1),g(" Kaydet ")]),8,Xa)])])])]);var u}}},et={open:"",class:"modal"},at={class:"modal-box max-w-md bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700"},tt={class:"flex items-center justify-between mb-6 pb-4 border-b border-gray-200 dark:border-gray-700"},rt={class:"space-y-6"},lt={class:"bg-gray-50 dark:bg-gray-900 rounded-lg p-4 space-y-4"},st={class:"form-control"},dt=["value"],ot={class:"form-control"},nt=["value"],it={class:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 space-y-4"},ut={class:"form-control"},ct={class:"form-control"},gt={class:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700"},bt=["disabled"],yt={__name:"EditAidatModal",props:{record:Object},emits:["close","updated"],setup(a,{emit:i}){const u=a,c=i,{handleValidationError:b,showSuccess:y}=f(),v=e({kdvHaric:0,toplamTutar:0});t(()=>{u.record&&(v.value.kdvHaric=u.record.kdvHaric??0,v.value.toplamTutar=u.record.toplamTutar??0)});const p=async()=>{try{await T.updateAidat(u.record.id,{kdvHaric:v.value.kdvHaric,kdvDahil:v.value.toplamTutar,remainingAmount:v.value.toplamTutar-(u.record.paidAmount||0),isPaid:v.value.toplamTutar-(u.record.paidAmount||0)<=0}),y("Aidat kaydı güncellendi."),c("updated"),c("close")}catch(e){b(e)}};return(e,t)=>(l(),r("dialog",et,[s("div",at,[s("div",tt,[t[5]||(t[5]=d('<div class="flex items-center gap-3"><div class="bg-yellow-100 dark:bg-yellow-900/50 text-yellow-600 dark:text-yellow-400 rounded-full p-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg></div><h3 class="text-xl font-bold text-gray-800 dark:text-gray-100">Aidat Kaydı Düzenle</h3></div>',1)),s("button",{onClick:t[0]||(t[0]=a=>e.$emit("close")),class:"btn btn-ghost btn-sm"},t[4]||(t[4]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),s("div",rt,[s("div",lt,[t[8]||(t[8]=s("h4",{class:"text-lg font-semibold text-gray-800 dark:text-gray-100 mb-3"},"Kayıt Bilgileri",-1)),s("div",st,[t[6]||(t[6]=s("label",{class:"label"},[s("span",{class:"label-text font-semibold text-gray-700 dark:text-gray-300"},"Kat")],-1)),s("input",{type:"text",class:"input input-bordered w-full bg-gray-100 dark:bg-gray-600 border-gray-300 dark:border-gray-600 text-gray-500 dark:text-gray-400",value:a.record.unit,disabled:""},null,8,dt)]),s("div",ot,[t[7]||(t[7]=s("label",{class:"label"},[s("span",{class:"label-text font-semibold text-gray-700 dark:text-gray-300"},"Şirket")],-1)),s("input",{type:"text",class:"input input-bordered w-full bg-gray-100 dark:bg-gray-600 border-gray-300 dark:border-gray-600 text-gray-500 dark:text-gray-400",value:a.record.tenantName||"-",disabled:""},null,8,nt)])]),s("div",it,[t[13]||(t[13]=s("h4",{class:"text-lg font-semibold text-gray-800 dark:text-gray-100 mb-3"},"Tutar Bilgileri",-1)),s("div",ut,[t[9]||(t[9]=s("label",{class:"label"},[s("span",{class:"label-text font-semibold text-gray-700 dark:text-gray-300"},"KDV Hariç Tutar (₺)"),s("span",{class:"label-text-alt text-red-500"},"*")],-1)),o(s("input",{type:"number","onUpdate:modelValue":t[1]||(t[1]=e=>v.value.kdvHaric=e),class:"input input-bordered w-full bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300",step:"0.01",min:"0"},null,512),[[n,v.value.kdvHaric,void 0,{number:!0}]]),t[10]||(t[10]=s("label",{class:"label"},[s("span",{class:"label-text-alt text-gray-500 dark:text-gray-400"},"KDV hariç aidat tutarı")],-1))]),s("div",ct,[t[11]||(t[11]=s("label",{class:"label"},[s("span",{class:"label-text font-semibold text-gray-700 dark:text-gray-300"},"Toplam Tutar (₺)"),s("span",{class:"label-text-alt text-red-500"},"*")],-1)),o(s("input",{type:"number","onUpdate:modelValue":t[2]||(t[2]=e=>v.value.toplamTutar=e),class:"input input-bordered w-full bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300",step:"0.01",min:"0"},null,512),[[n,v.value.toplamTutar,void 0,{number:!0}]]),t[12]||(t[12]=s("label",{class:"label"},[s("span",{class:"label-text-alt text-gray-500 dark:text-gray-400"},"KDV dahil toplam tutar")],-1))])]),t[16]||(t[16]=d('<div class="bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4 border border-yellow-200 dark:border-yellow-800"><div class="flex items-start gap-3"><div class="bg-yellow-100 dark:bg-yellow-900/50 text-yellow-600 dark:text-yellow-400 rounded-full p-1 mt-0.5"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path></svg></div><div class="text-sm text-gray-700 dark:text-gray-300"><p class="font-medium mb-1">Dikkat</p><p>Bu değişiklik aidat kaydını kalıcı olarak güncelleyecektir.</p></div></div></div>',1)),s("div",gt,[s("button",{class:"btn btn-outline btn-sm",onClick:t[3]||(t[3]=a=>e.$emit("close"))},t[14]||(t[14]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1),g(" İptal ")])),s("button",{class:"btn btn-primary btn-sm",onClick:p,disabled:v.value.kdvHaric<0||v.value.toplamTutar<0},t[15]||(t[15]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5 13l4 4L19 7"})],-1),g(" Kaydet ")]),8,bt)])])])]))}},vt={class:"p-4 sm:p-6 bg-gray-50 min-h-screen font-sans dark:bg-gray-900"},pt={class:"max-w-7xl mx-auto"},mt={key:0,class:"mb-6 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4"},kt={key:1,class:"mb-6 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4"},xt={class:"flex items-center gap-3"},wt={class:"text-red-700 dark:text-red-300"},ht={key:2,class:"mb-6 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4"},ft={class:"flex items-center justify-between"},Vt={class:"flex items-center gap-3"},Tt={class:"text-green-700 dark:text-green-300"},Ct={class:"text-sm text-green-600 dark:text-green-400"},Mt={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8"},At={class:"bg-white dark:bg-gray-800 p-5 rounded-xl shadow-md flex items-center gap-4 border border-gray-200 dark:border-gray-700"},Dt={class:"text-2xl font-bold text-gray-800 dark:text-gray-100"},St={class:"bg-white dark:bg-gray-800 p-5 rounded-xl shadow-md flex items-center gap-4 border border-gray-200 dark:border-gray-700"},jt={class:"text-2xl font-bold text-gray-800 dark:text-gray-100"},Nt={class:"bg-white dark:bg-gray-800 p-5 rounded-xl shadow-md flex items-center gap-4 border border-gray-200 dark:border-gray-700"},Bt={class:"text-2xl font-bold text-gray-800 dark:text-gray-100"},Ht={class:"bg-white dark:bg-gray-800 p-5 rounded-xl shadow-md flex items-center justify-center border-2 border-dashed border-gray-300 dark:border-gray-600"},Et={class:"flex flex-col gap-2 w-full"},Ut={class:"bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md border border-gray-200 dark:border-gray-700"},Kt={class:"mt-4 flex flex-wrap gap-2 items-center border-t dark:border-gray-700 pt-4"},Lt=["disabled"],It=["disabled"],zt={class:"mt-6 space-y-2"},$t={key:0,class:"text-center py-12 text-gray-500 dark:text-gray-400"},Rt={key:1},Ot={class:"md:col-span-4 flex items-center gap-4"},Wt={class:"flex-shrink-0 h-12 w-12 flex items-center justify-center bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 rounded-full text-2xl"},_t={class:"font-bold text-gray-800 dark:text-gray-100"},Pt={class:"text-sm text-gray-500 dark:text-gray-400"},Ft={key:0,class:"text-xs text-gray-400 dark:text-gray-500"},Gt={class:"md:col-span-3 text-left md:text-center text-lg font-semibold text-gray-700 dark:text-gray-200"},Yt={class:"md:col-span-3 text-left md:text-center text-xl font-bold text-sky-600 dark:text-sky-400"},qt={class:"md:col-span-2 text-center"},Jt={key:0,class:"badge badge-success badge-sm"},Qt={key:1,class:"badge badge-warning badge-sm"},Xt={key:2,class:"badge badge-error badge-sm"},Zt={class:"md:col-span-2 text-right"},er={class:"dropdown dropdown-end"},ar={tabindex:"0",class:"dropdown-content menu p-2 shadow bg-base-200 rounded-box w-32 z-10"},tr=["onClick"],rr=["onClick"],lr=["open"],sr={class:"modal-box"},dr={class:"form-control mb-2"},or={class:"form-control mb-4"},nr={class:"modal-action"},ir={__name:"Utilities",setup(d){const{handleNetworkError:y,showSuccess:v}=f(),p=e([]),w=e(""),V=e(""),T=e("all"),A=e(!1),D=e(!1),S=e(!1),j=e(!1),N=e(!1),B=e(!1),H=e(!1),E=e(null),U=e(null),K=e(null),L=[{value:"all",label:"Tümü"},{value:"Electricity",label:"Elektrik"},{value:"Water",label:"Su"},{value:"Aidat",label:"Aidat"},{value:"OwnerAidat",label:"Mal Sahibi Aidatı"}],I=a(()=>p.value.filter(e=>{const a=e.tenantName||e.ownerName||"",t=""===w.value||a.toLowerCase().includes(w.value.toLowerCase()),r=!V.value||e.period===V.value,l="all"===T.value||e.utilityType===T.value;return t&&r&&l}).sort((e,a)=>(a.period+(e.tenantName||e.ownerName)).localeCompare(e.period+(a.tenantName||a.ownerName)))),z=a(()=>{const e=new Date,a=e.getFullYear()+"-"+String(e.getMonth()+1).padStart(2,"0");return I.value.filter(e=>e.period===a).reduce((e,a)=>e+Number(a.amount||0),0)}),$=a(()=>{const e=new Date,a=e.getFullYear()+"-"+String(e.getMonth()+1).padStart(2,"0");return I.value.filter(e=>e.period===a&&"Electricity"===e.utilityType).reduce((e,a)=>e+Number(a.consumption||0),0)}),R=a(()=>{const e=new Date,a=e.getFullYear()+"-"+String(e.getMonth()+1).padStart(2,"0");return I.value.filter(e=>e.period===a&&"Water"===e.utilityType).reduce((e,a)=>e+Number(a.consumption||0),0)}),O=(e,a)=>null==e||isNaN(e)?"-":`${Number(e).toFixed(0)} ${a}`,W=e=>null==e||isNaN(e)?"₺0.00":Number(e).toLocaleString("tr-TR",{style:"currency",currency:"TRY"}),_=e({loading:!1,error:null,lastUpdated:null}),P=e([]),F=async()=>{_.value.loading=!0;try{const e=await M.getUtilityDebts();p.value=e||[],_.value.error=null,_.value.lastUpdated=(new Date).toLocaleString("tr-TR")}catch(e){y(e,{component:"Utilities",action:"fetchUtilityDebts"}),_.value.error=e.message,p.value=[]}finally{_.value.loading=!1}},G=e=>{A.value=!1,D.value=!1,e&&F()},Y=async()=>{if(V.value){if(confirm(`${V.value} dönemindeki tüm kayıtları silmek istediğinizden emin misiniz? Bu işlem geri alınamaz.`))try{await M.deleteUtilityDebtsByPeriod(V.value),v(`${V.value} dönemi kayıtları`),await F()}catch(e){alert("Kayıtlar silinirken bir hata oluştu.")}}else alert("Lütfen silinecek dönemi seçin.")},q=async()=>{if(!V.value)return void alert("Lütfen bir dönem seçin.");const e=p.value.filter(e=>e.period===V.value&&"Electricity"===e.utilityType);e.length>0?(E.value=e,j.value=!0):alert("Bu dönem için düzenlenecek elektrik kaydı bulunamadı.")},J=async()=>{if(!V.value||"all"===T.value||"Electricity"!==T.value&&"Water"!==T.value)alert("Lütfen dönem ve gider tipi olarak Elektrik veya Su seçiniz.");else try{await M.distributeSharedExpense(V.value,T.value),v("Ortak gider başarıyla paylaştırıldı."),H.value=!1,await F()}catch(e){alert("Ortak gider paylaştırılırken bir hata oluştu.")}},Q=()=>{w.value="",V.value="",T.value="all"};return t(()=>{(async()=>{try{const e=await h.getTenants();P.value=e||[]}catch(e){y(e,{component:"Utilities",action:"fetchTenants"}),P.value=[]}})(),F()}),(e,a)=>(l(),r("div",vt,[s("div",pt,[a[26]||(a[26]=s("h1",{class:"text-3xl font-bold text-gray-800 mb-6 dark:text-gray-100"},"Faturalar ve Sayaç Kayıtları",-1)),_.value.loading?(l(),r("div",mt,a[14]||(a[14]=[s("div",{class:"flex items-center gap-3"},[s("div",{class:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"}),s("span",{class:"text-blue-700 dark:text-blue-300"},"Veriler yükleniyor...")],-1)]))):b("",!0),_.value.error?(l(),r("div",kt,[s("div",xt,[a[15]||(a[15]=s("div",{class:"bg-red-100 dark:bg-red-900/50 text-red-600 dark:text-red-400 rounded-full p-1"},[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),s("span",wt,i(_.value.error),1)])])):b("",!0),_.value.lastUpdated?(l(),r("div",ht,[s("div",ft,[s("div",Vt,[a[16]||(a[16]=s("div",{class:"bg-green-100 dark:bg-green-900/50 text-green-600 dark:text-green-400 rounded-full p-1"},[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5 13l4 4L19 7"})])],-1)),s("span",Tt," Son güncelleme: "+i(_.value.lastUpdated),1)]),s("div",Ct,i(p.value.length)+" kayıt ",1)])])):b("",!0),s("section",Mt,[s("div",At,[a[18]||(a[18]=s("div",{class:"bg-cyan-100 dark:bg-cyan-900/50 text-cyan-600 dark:text-cyan-400 rounded-full p-3"},[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])],-1)),s("div",null,[a[17]||(a[17]=s("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Bu Ayki Fatura Toplamı",-1)),s("p",Dt,i(W(z.value)),1)])]),s("div",St,[a[20]||(a[20]=s("div",{class:"bg-amber-100 dark:bg-amber-900/50 text-amber-600 dark:text-amber-400 rounded-full p-3"},[s("span",{class:"text-2xl"},"⚡️")],-1)),s("div",null,[a[19]||(a[19]=s("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Aylık Elektrik Tüketimi",-1)),s("p",jt,i(O($.value,"kWh")),1)])]),s("div",Nt,[a[22]||(a[22]=s("div",{class:"bg-blue-100 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400 rounded-full p-3"},[s("span",{class:"text-2xl"},"💧")],-1)),s("div",null,[a[21]||(a[21]=s("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Aylık Su Tüketimi",-1)),s("p",Bt,i(O(R.value,"m³")),1)])]),s("div",Ht,[s("div",Et,[s("button",{class:"btn btn-primary btn-sm w-full",onClick:a[0]||(a[0]=e=>A.value=!0)},"⚡ Elektrik Girişi"),s("button",{class:"btn btn-secondary btn-sm w-full",onClick:a[1]||(a[1]=e=>D.value=!0)},"💧 Su Girişi"),s("button",{class:"btn btn-accent btn-sm w-full",onClick:a[2]||(a[2]=e=>S.value=!0)},"💰 Aidat Girişi")])])]),s("div",Ut,[k(C,{search:w.value,"onUpdate:search":a[3]||(a[3]=e=>w.value=e),"search-placeholder":"Şirket Ara...",period:V.value,"onUpdate:period":a[4]||(a[4]=e=>V.value=e),"select-type":T.value,"onUpdate:selectType":a[5]||(a[5]=e=>T.value=e),"select-type-options":L,onClearFilters:Q},null,8,["search","period","select-type"]),s("div",Kt,[s("button",{class:"btn btn-error btn-sm",onClick:Y,disabled:!V.value},"Dönemi Sil",8,Lt),s("button",{class:"btn btn-outline btn-sm",onClick:q,disabled:!V.value},"Toplu Elektrik Düzenle",8,It),s("button",{onClick:a[6]||(a[6]=e=>H.value=!0),class:"btn btn-warning btn-sm"},"Ortak Gider Paylaştır")]),s("div",zt,[0===I.value.length?(l(),r("div",$t,a[23]||(a[23]=[s("p",null,"Aramanızla eşleşen kayıt bulunamadı.",-1)]))):(l(),r("div",Rt,[(l(!0),r(u,null,c(I.value,e=>{return l(),r("div",{key:e.id,class:"grid grid-cols-1 md:grid-cols-12 gap-4 items-center p-4 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors duration-200 border-b dark:border-gray-700/50"},[s("div",Ot,[s("div",Wt,i((t=e.utilityType,{Electricity:"⚡️",Water:"💧",Aidat:"💰",OwnerAidat:"🏠"}[t]||"❓")),1),s("div",null,[s("p",_t,i(e.tenantName||e.ownerName||"-"),1),s("p",Pt,"Dönem: "+i(e.period),1),e.flatNumber?(l(),r("p",Ft,"Daire: "+i(e.flatNumber),1)):b("",!0)])]),s("div",Gt,[a[24]||(a[24]=s("span",{class:"font-normal text-sm text-gray-500"},"Tüketim:",-1)),g(" "+i(O(e.consumption,"Electricity"===e.utilityType?"kWh":"Water"===e.utilityType?"m³":"")),1)]),s("div",Yt,i(W(e.amount)),1),s("div",qt,[e.isPaid?(l(),r("div",Jt,"Ödendi")):e.paidAmount&&e.paidAmount>0?(l(),r("div",Qt,"Kısmi Ödeme")):(l(),r("div",Xt,"Ödenmedi"))]),s("div",Zt,[s("div",er,[a[25]||(a[25]=s("label",{tabindex:"0",class:"btn btn-ghost btn-sm"},"İşlemler",-1)),s("ul",ar,[s("li",null,[s("a",{onClick:a=>(e=>{"Electricity"===e.utilityType?(E.value=e,j.value=!0):"Water"===e.utilityType?(U.value=e,N.value=!0):"Aidat"===e.utilityType?(K.value=e,B.value=!0):"OwnerAidat"===e.utilityType&&alert(`Mal Sahibi Aidatı - ${e.flatNumber}\nDönem: ${e.period}\nTutar: ${W(e.amount)}`)})(e)},"Düzenle",8,tr)]),s("li",null,[s("a",{onClick:a=>(async e=>{if(confirm("Bu kaydı silmek istediğinizden emin misiniz?"))try{await M.deleteUtilityDebt(e),v("Utility Debt"),await F()}catch(a){alert("Kayıt silinirken bir hata oluştu.")}})(e.id),class:"text-red-500"},"Sil",8,rr)])])])])]);var t}),128))]))])])]),A.value?(l(),m(re,{key:0,onClose:G})):b("",!0),D.value?(l(),m(Ie,{key:1,onClose:G})):b("",!0),S.value?(l(),m(Fe,{key:2,onClose:a[7]||(a[7]=()=>S.value=!1),onRefresh:F})):b("",!0),j.value?(l(),m(Ma,{key:3,record:E.value,onClose:a[8]||(a[8]=()=>{j.value=!1,E.value=null}),onUpdated:F},null,8,["record"])):b("",!0),N.value?(l(),m(Za,{key:4,record:U.value,onClose:a[9]||(a[9]=()=>{N.value=!1,U.value=null}),onUpdated:F},null,8,["record"])):b("",!0),B.value?(l(),m(yt,{key:5,record:K.value,onClose:a[10]||(a[10]=()=>{B.value=!1,K.value=null}),onUpdated:F},null,8,["record"])):b("",!0),s("dialog",{id:"distributeModal",class:"modal",open:H.value},[s("div",sr,[a[30]||(a[30]=s("h3",{class:"font-bold text-lg mb-4"},"Ortak Gider Paylaştır",-1)),s("div",dr,[a[27]||(a[27]=s("label",{class:"label"},"Dönem",-1)),o(s("input",{type:"month","onUpdate:modelValue":a[11]||(a[11]=e=>V.value=e),class:"input input-bordered"},null,512),[[n,V.value]])]),s("div",or,[a[29]||(a[29]=s("label",{class:"label"},"Gider Tipi",-1)),o(s("select",{"onUpdate:modelValue":a[12]||(a[12]=e=>T.value=e),class:"select select-bordered"},a[28]||(a[28]=[s("option",{value:"Electricity"},"Elektrik",-1),s("option",{value:"Water"},"Su",-1)]),512),[[x,T.value]])]),s("div",nr,[s("button",{onClick:J,class:"btn btn-success"},"Paylaştır"),s("button",{onClick:a[13]||(a[13]=e=>H.value=!1),class:"btn"},"Kapat")])])],8,lr)]))}};export{ir as default};
