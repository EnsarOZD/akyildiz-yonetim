import{C as e,c as a,e as t,l as n,b as i,t as s,x as l,p as r,r as o,w as d,o as u,f as m,D as c,E as v,F as y,i as p,I as h,u as b,n as f,H as g,G as k}from"./vue-vendor-C74T0G6D.js";import{_ as w}from"./index-C-WeNbY_.js";import{p as x}from"./paymentsService-BRWY_5RO.js";import{t as M}from"./tenantsService-COb7ls1o.js";import{u as z}from"./utilityDebtsService-CRQj309-.js";import{j as P}from"./enums-CeMB0k1K.js";import{b as A,a as S,c as W,d as N,p as _,i as C,f as j}from"./utils-vendor-DKZIJpv7.js";const B={lessThanXSeconds:{one:"bir saniyeden az",other:"{{count}} saniyeden az"},xSeconds:{one:"1 saniye",other:"{{count}} saniye"},halfAMinute:"yarım dakika",lessThanXMinutes:{one:"bir dakikadan az",other:"{{count}} dakikadan az"},xMinutes:{one:"1 dakika",other:"{{count}} dakika"},aboutXHours:{one:"yaklaşık 1 saat",other:"yaklaşık {{count}} saat"},xHours:{one:"1 saat",other:"{{count}} saat"},xDays:{one:"1 gün",other:"{{count}} gün"},aboutXWeeks:{one:"yaklaşık 1 hafta",other:"yaklaşık {{count}} hafta"},xWeeks:{one:"1 hafta",other:"{{count}} hafta"},aboutXMonths:{one:"yaklaşık 1 ay",other:"yaklaşık {{count}} ay"},xMonths:{one:"1 ay",other:"{{count}} ay"},aboutXYears:{one:"yaklaşık 1 yıl",other:"yaklaşık {{count}} yıl"},xYears:{one:"1 yıl",other:"{{count}} yıl"},overXYears:{one:"1 yıldan fazla",other:"{{count}} yıldan fazla"},almostXYears:{one:"neredeyse 1 yıl",other:"neredeyse {{count}} yıl"}},H={date:A({formats:{full:"d MMMM y EEEE",long:"d MMMM y",medium:"d MMM y",short:"dd.MM.yyyy"},defaultWidth:"full"}),time:A({formats:{full:"HH:mm:ss zzzz",long:"HH:mm:ss z",medium:"HH:mm:ss",short:"HH:mm"},defaultWidth:"full"}),dateTime:A({formats:{full:"{{date}} 'saat' {{time}}",long:"{{date}} 'saat' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})},E={lastWeek:"'geçen hafta' eeee 'saat' p",yesterday:"'dün saat' p",today:"'bugün saat' p",tomorrow:"'yarın saat' p",nextWeek:"eeee 'saat' p",other:"P"},T={code:"tr",formatDistance:(e,a,t)=>{let n;const i=B[e];return n="string"==typeof i?i:1===a?i.one:i.other.replace("{{count}}",a.toString()),(null==t?void 0:t.addSuffix)?t.comparison&&t.comparison>0?n+" sonra":n+" önce":n},formatLong:H,formatRelative:(e,a,t,n)=>E[e],localize:{ordinalNumber:(e,a)=>Number(e)+".",era:S({values:{narrow:["MÖ","MS"],abbreviated:["MÖ","MS"],wide:["Milattan Önce","Milattan Sonra"]},defaultWidth:"wide"}),quarter:S({values:{narrow:["1","2","3","4"],abbreviated:["1Ç","2Ç","3Ç","4Ç"],wide:["İlk çeyrek","İkinci Çeyrek","Üçüncü çeyrek","Son çeyrek"]},defaultWidth:"wide",argumentCallback:e=>Number(e)-1}),month:S({values:{narrow:["O","Ş","M","N","M","H","T","A","E","E","K","A"],abbreviated:["Oca","Şub","Mar","Nis","May","Haz","Tem","Ağu","Eyl","Eki","Kas","Ara"],wide:["Ocak","Şubat","Mart","Nisan","Mayıs","Haziran","Temmuz","Ağustos","Eylül","Ekim","Kasım","Aralık"]},defaultWidth:"wide"}),day:S({values:{narrow:["P","P","S","Ç","P","C","C"],short:["Pz","Pt","Sa","Ça","Pe","Cu","Ct"],abbreviated:["Paz","Pzt","Sal","Çar","Per","Cum","Cts"],wide:["Pazar","Pazartesi","Salı","Çarşamba","Perşembe","Cuma","Cumartesi"]},defaultWidth:"wide"}),dayPeriod:S({values:{narrow:{am:"öö",pm:"ös",midnight:"gy",noon:"ö",morning:"sa",afternoon:"ös",evening:"ak",night:"ge"},abbreviated:{am:"ÖÖ",pm:"ÖS",midnight:"gece yarısı",noon:"öğle",morning:"sabah",afternoon:"öğleden sonra",evening:"akşam",night:"gece"},wide:{am:"Ö.Ö.",pm:"Ö.S.",midnight:"gece yarısı",noon:"öğle",morning:"sabah",afternoon:"öğleden sonra",evening:"akşam",night:"gece"}},defaultWidth:"wide",formattingValues:{narrow:{am:"öö",pm:"ös",midnight:"gy",noon:"ö",morning:"sa",afternoon:"ös",evening:"ak",night:"ge"},abbreviated:{am:"ÖÖ",pm:"ÖS",midnight:"gece yarısı",noon:"öğlen",morning:"sabahleyin",afternoon:"öğleden sonra",evening:"akşamleyin",night:"geceleyin"},wide:{am:"ö.ö.",pm:"ö.s.",midnight:"gece yarısı",noon:"öğlen",morning:"sabahleyin",afternoon:"öğleden sonra",evening:"akşamleyin",night:"geceleyin"}},defaultFormattingWidth:"wide"})},match:{ordinalNumber:N({matchPattern:/^(\d+)(\.)?/i,parsePattern:/\d+/i,valueCallback:function(e){return parseInt(e,10)}}),era:W({matchPatterns:{narrow:/^(mö|ms)/i,abbreviated:/^(mö|ms)/i,wide:/^(milattan önce|milattan sonra)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/(^mö|^milattan önce)/i,/(^ms|^milattan sonra)/i]},defaultParseWidth:"any"}),quarter:W({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^[1234]ç/i,wide:/^((i|İ)lk|(i|İ)kinci|üçüncü|son) çeyrek/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i],abbreviated:[/1ç/i,/2ç/i,/3ç/i,/4ç/i],wide:[/^(i|İ)lk çeyrek/i,/(i|İ)kinci çeyrek/i,/üçüncü çeyrek/i,/son çeyrek/i]},defaultParseWidth:"any",valueCallback:e=>e+1}),month:W({matchPatterns:{narrow:/^[oşmnhtaek]/i,abbreviated:/^(oca|şub|mar|nis|may|haz|tem|ağu|eyl|eki|kas|ara)/i,wide:/^(ocak|şubat|mart|nisan|mayıs|haziran|temmuz|ağustos|eylül|ekim|kasım|aralık)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^o/i,/^ş/i,/^m/i,/^n/i,/^m/i,/^h/i,/^t/i,/^a/i,/^e/i,/^e/i,/^k/i,/^a/i],any:[/^o/i,/^ş/i,/^mar/i,/^n/i,/^may/i,/^h/i,/^t/i,/^ağ/i,/^ey/i,/^ek/i,/^k/i,/^ar/i]},defaultParseWidth:"any"}),day:W({matchPatterns:{narrow:/^[psçc]/i,short:/^(pz|pt|sa|ça|pe|cu|ct)/i,abbreviated:/^(paz|pzt|sal|çar|per|cum|cts)/i,wide:/^(pazar(?!tesi)|pazartesi|salı|çarşamba|perşembe|cuma(?!rtesi)|cumartesi)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^p/i,/^p/i,/^s/i,/^ç/i,/^p/i,/^c/i,/^c/i],any:[/^pz/i,/^pt/i,/^sa/i,/^ça/i,/^pe/i,/^cu/i,/^ct/i],wide:[/^pazar(?!tesi)/i,/^pazartesi/i,/^salı/i,/^çarşamba/i,/^perşembe/i,/^cuma(?!rtesi)/i,/^cumartesi/i]},defaultParseWidth:"any"}),dayPeriod:W({matchPatterns:{narrow:/^(öö|ös|gy|ö|sa|ös|ak|ge)/i,any:/^(ö\.?\s?[ös]\.?|öğleden sonra|gece yarısı|öğle|(sabah|öğ|akşam|gece)(leyin))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^ö\.?ö\.?/i,pm:/^ö\.?s\.?/i,midnight:/^(gy|gece yarısı)/i,noon:/^öğ/i,morning:/^sa/i,afternoon:/^öğleden sonra/i,evening:/^ak/i,night:/^ge/i}},defaultParseWidth:"any"})},options:{weekStartsOn:1,firstWeekContainsDate:1}};function I(e,a="dd.MM.yyyy"){if(!e)return"Tarih belirtilmedi";try{let t;if("string"==typeof e)t=_(e);else{if(!(e instanceof Date))return"Geçersiz tarih";t=e}return C(t)?t.getFullYear()<=1900?"Tarih belirtilmedi":j(t,a,{locale:T}):"Geçersiz tarih"}catch(t){return"Geçersiz tarih"}}const Y={class:"loading-content"},D={key:0,class:"loading-text"},K={key:1,class:"progress-container"},X={class:"progress-bar"},L={class:"progress-text"},F=w({__name:"LoadingSpinner",props:{loading:{type:Boolean,default:!1},text:{type:String,default:"Yükleniyor..."},fullscreen:{type:Boolean,default:!1},overlay:{type:Boolean,default:!0},showProgress:{type:Boolean,default:!1},progress:{type:Number,default:null},size:{type:String,default:"medium",validator:e=>["small","medium","large"].includes(e)}},setup(o){const d=o;return e(()=>{switch(d.size){case"small":return"w-8 h-8";case"large":return"w-16 h-16";default:return"w-12 h-12"}}),(e,d)=>o.loading?(n(),a("div",{key:0,class:r(["loading-overlay",{fullscreen:o.fullscreen,overlay:o.overlay}])},[i("div",Y,[d[0]||(d[0]=i("div",{class:"spinner"},[i("div",{class:"spinner-ring"}),i("div",{class:"spinner-ring"}),i("div",{class:"spinner-ring"})],-1)),o.text?(n(),a("p",D,s(o.text),1)):t("",!0),o.showProgress&&null!==o.progress?(n(),a("div",K,[i("div",X,[i("div",{class:"progress-fill",style:l({width:`${o.progress}%`})},null,4)]),i("span",L,s(Math.round(o.progress))+"%",1)])):t("",!0)])],2)):t("",!0)}},[["__scopeId","data-v-83a88369"]]),U={key:0,class:"flex justify-center items-center py-12"},V={key:1,class:"advance-account-manager bg-base-100 p-6 rounded-lg shadow-lg"},O={class:"form-control mb-6"},G=["value"],$={key:0,class:"mb-6"},q={class:"bg-base-200 p-4 rounded-lg"},R={class:"text-3xl font-bold text-primary"},J={class:"text-sm text-gray-600 mt-2"},Q={key:1,class:"border-t pt-6"},Z={class:"space-y-3 mb-4 max-h-80 overflow-auto pr-1"},ee={class:"flex items-center justify-between gap-3"},ae={class:"flex items-center gap-3 min-w-0"},te=["value","disabled"],ne={class:"truncate"},ie={class:"font-medium truncate"},se={class:"text-sm text-gray-600"},le={class:"ml-2"},re={key:0,class:"w-36"},oe=["onUpdate:modelValue","onInput","max"],de={key:0,class:"text-sm text-warning mt-2"},ue={key:0,class:"bg-base-200 p-4 rounded-lg mb-4"},me={class:"flex justify-between mb-2"},ce={class:"font-semibold"},ve={class:"flex justify-between mb-2"},ye={class:"font-semibold"},pe={class:"flex justify-between"},he={key:0,class:"text-sm text-error mt-2"},be=["disabled"],fe={key:0,class:"loading loading-spinner loading-sm"},ge={key:2,class:"text-center py-8"},ke={key:3,class:"text-center py-8"},we={__name:"AdvanceAccountManager",props:{tenantId:{type:String,default:""}},emits:["success"],setup(l,{emit:w}){const A=l,S=w,W=o(!1),N=o([]),_=o(A.tenantId||""),C=o(null),j=o([]),B=o([]),H=o({}),E=e=>new Intl.NumberFormat("tr-TR",{style:"currency",currency:"TRY"}).format(Number(e||0)),T=e=>I(e,"dd MMM yyyy"),Y=e(()=>{var e;return Number((null==(e=null==C?void 0:C.value)?void 0:e.balance)||0)}),D=e=>Number((null==e?void 0:e.remainingAmount)??(null==e?void 0:e.amount)??0),K=e=>{const a=j.value.find(a=>(a.id||a._id)===e);if(!a)return 0;const t=Number(H.value[e]||0),n=Me(a);return!isFinite(t)||t<=0?0:Math.min(t,n)},X=e(()=>B.value.reduce((e,a)=>e+K(a),0)),L=e(()=>Y.value-X.value),we=e(()=>B.value.length>0&&X.value>0&&L.value>=0),xe=e=>Y.value>0&&D(e)>0&&Y.value>=.01,Me=e=>{const a=D(e),t=e.id||e._id,n=B.value.filter(e=>e!==t).reduce((e,a)=>{const t=Number(H.value[a]||0),n=j.value.find(e=>(e.id||e._id)===a),i=n?D(n):1/0;return e+Math.min(t,i)},0),i=Math.max(0,Y.value-n);return Math.max(0,Math.min(a,i))},ze=async()=>{var e;if(B.value=[],H.value={},C.value=null,j.value=[],_.value){W.value=!0;try{const a=await x.getAdvanceAccounts({tenantId:_.value,activeOnly:!0});C.value=Array.isArray(a)?a[0]:(null==(e=null==a?void 0:a.items)?void 0:e[0])||null;const t=await z.getUtilityDebts({tenantId:_.value,status:"Unpaid"});j.value=Array.isArray(t)?t:(null==t?void 0:t.items)||[]}catch(a){C.value=null,j.value=[]}finally{W.value=!1}}},Pe=async()=>{if(!W.value&&we.value){W.value=!0;try{const e=B.value.map(e=>({debtId:e,amount:K(e)})).filter(e=>e.amount>0),a={tenantId:_.value,debtPayments:e,description:"Avans hesabından borç ödemesi"},t=await x.useAdvanceAccount(a);S("success",t),await ze()}catch(e){alert("Avans kullanılamadı. Lütfen tekrar deneyin.")}finally{W.value=!1}}};return d(_,()=>{ze()}),d(B,(e,a)=>{e.filter(e=>!(null==a?void 0:a.includes(e))).forEach(e=>{const a=j.value.find(a=>(a.id||a._id)===e);if(!a)return;const t=Me(a);H.value[e]?H.value[e]=Math.min(Number(H.value[e]||0),t):H.value[e]=t});(a||[]).filter(a=>!e.includes(a)).forEach(e=>{delete H.value[e]})}),u(()=>{(async()=>{W.value=!0;try{const e=await M.getTenants();N.value=Array.isArray(e)?e:(null==e?void 0:e.items)||[]}catch(e){N.value=[]}finally{W.value=!1}})()}),(e,l)=>W.value?(n(),a("div",U,[m(F)])):(n(),a("div",V,[l[12]||(l[12]=i("h2",{class:"text-2xl font-bold mb-6 text-primary"},"Avans Hesabı Yönetimi",-1)),i("div",O,[l[3]||(l[3]=i("label",{class:"label"},[i("span",{class:"label-text font-semibold"},"Kiracı Seçin")],-1)),c(i("select",{"onUpdate:modelValue":l[0]||(l[0]=e=>_.value=e),class:"select select-bordered",onChange:ze},[l[2]||(l[2]=i("option",{value:""},"Kiracı seçiniz",-1)),(n(!0),a(y,null,p(N.value,e=>(n(),a("option",{key:e.id||e._id,value:e.id||e._id},s((e=>(null==e?void 0:e.companyName)||(null==e?void 0:e.company)||[null==e?void 0:e.firstName,null==e?void 0:e.lastName].filter(Boolean).join(" ")||(null==e?void 0:e.fullName)||(null==e?void 0:e.email)||"Bilinmiyor")(e)),9,G))),128))],544),[[v,_.value]])]),C.value?(n(),a("div",$,[i("div",q,[l[4]||(l[4]=i("h3",{class:"text-lg font-semibold mb-3"},"Mevcut Bakiye",-1)),i("div",R,s(E(Y.value)),1),i("div",J," Son güncelleme: "+s(T(C.value.updatedAt||C.value.createdAt)),1)])])):t("",!0),C.value&&j.value.length>0?(n(),a("div",Q,[l[9]||(l[9]=i("h3",{class:"text-lg font-semibold mb-4"},"Borç Öde",-1)),i("div",Z,[(n(!0),a(y,null,p(j.value,e=>(n(),a("div",{key:e.id||e._id,class:"border rounded-lg p-3"},[i("div",ee,[i("div",ae,[c(i("input",{"onUpdate:modelValue":l[1]||(l[1]=e=>B.value=e),value:e.id||e._id,type:"checkbox",class:"checkbox checkbox-sm checkbox-primary",disabled:!xe(e)},null,8,te),[[h,B.value]]),i("div",ne,[i("div",ie,s(e.description||`${b(P)(e.type)} - ${e.periodYear}/${String(e.periodMonth).padStart(2,"0")}`),1),i("div",se,[f(" Kalan: "+s(E(D(e)))+" ",1),i("span",le,"| Vade: "+s(T(e.dueDate)),1)])])]),B.value.includes(e.id||e._id)?(n(),a("div",re,[c(i("input",{"onUpdate:modelValue":a=>H.value[e.id||e._id]=a,onInput:a=>(e=>{const a=e.id||e._id,t=Number(H.value[a]||0);if(!isFinite(t)||t<=0)return void(H.value[a]=0);const n=Me(e);H.value[a]=Math.min(t,n)})(e),type:"number",step:"0.01",min:0,max:Me(e),class:"input input-sm input-bordered w-full",placeholder:"Tutar"},null,40,oe),[[g,H.value[e.id||e._id],void 0,{number:!0}]])])):t("",!0)]),xe(e)?t("",!0):(n(),a("div",de," ⚠️ Yetersiz bakiye "))]))),128))]),B.value.length>0?(n(),a("div",ue,[l[8]||(l[8]=i("h4",{class:"font-semibold mb-2"},"Ödeme Özeti",-1)),i("div",me,[l[5]||(l[5]=i("span",null,"Toplam Ödenecek:",-1)),i("span",ce,s(E(X.value)),1)]),i("div",ve,[l[6]||(l[6]=i("span",null,"Mevcut Bakiye:",-1)),i("span",ye,s(E(Y.value)),1)]),i("div",pe,[l[7]||(l[7]=i("span",null,"Kalan Bakiye:",-1)),i("span",{class:r(["font-semibold",L.value<0?"text-error":"text-success"])},s(E(L.value)),3)]),L.value<0?(n(),a("div",he," ⚠️ Yetersiz bakiye! Lütfen ödeme tutarlarını azaltın. ")):t("",!0)])):t("",!0),i("button",{onClick:Pe,class:"btn btn-primary",disabled:W.value||!we.value},[W.value?(n(),a("span",fe)):t("",!0),f(" "+s(W.value?"İşleniyor...":"Avans Kullan"),1)],8,be)])):C.value&&0===j.value.length?(n(),a("div",ge,l[10]||(l[10]=[k('<div class="text-gray-500"><svg class="w-16 h-16 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><p class="text-lg font-medium">Ödenecek borç bulunmuyor</p><p class="text-sm">Bu kiracının ödenmemiş borcu bulunmamaktadır.</p></div>',1)]))):_.value&&!C.value?(n(),a("div",ke,l[11]||(l[11]=[k('<div class="text-gray-500"><svg class="w-16 h-16 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path></svg><p class="text-lg font-medium">Avans hesabı bulunamadı</p><p class="text-sm">Bu kiracının avans hesabı bulunmamaktadır.</p></div>',1)]))):t("",!0)]))}};export{F as L,we as _,I as s,T as t};
