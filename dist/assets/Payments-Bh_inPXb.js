import{t as e,e as a,u as t,R as l}from"./index-SuSpVQ5E.js";import{K as r,w as s,r as n,c as o,o as d,a as i,b as u,j as c,m as b,e as m,p as g,G as v,L as p,I as y,F as x,i as k,t as h,H as f,E as w,J as A,q as D,u as M,d as C,f as I,z as j}from"./vue-vendor-j_tVed2R.js";import{p as N}from"./paymentsService-Cx9lMbdY.js";import{o as B}from"./ownersService-Cw2VwuMu.js";import{u as S}from"./utilityDebtsService-CWShkKtZ.js";import{u as T,a as V}from"./useErrorHandler-Ce0sKgl2.js";import{_ as P}from"./CustomFilterBar-BqoB5FIp.js";import{_ as z,L as U,s as L}from"./AdvanceAccountManager-BUQAAMVu.js";import{t as E}from"./tenantsService-jvRYRtn0.js";import{e as F}from"./utils-vendor-Cy2sLATb.js";import{a as H,e as R,g as Y,b as K,p as O,c as _}from"./enums-CeMB0k1K.js";import{u as G,f as $,g as q,a as J}from"./uiHelpers-BFASfX_X.js";import"./tenantsService-D1N4utGI.js";const W={key:0,class:"modal",open:""},Z={class:"modal-box max-w-4xl bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-900 border border-gray-200 dark:border-gray-700 shadow-2xl"},Q={class:"flex items-center justify-between pb-4 border-b border-gray-200 dark:border-gray-700 mb-6"},X={class:"space-y-6"},ee={class:"form-control"},ae={class:"flex gap-4"},te={class:"flex items-center gap-2"},le={class:"flex items-center gap-2"},re={key:0,class:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4 border border-green-200 dark:border-green-800"},se={class:"form-control"},ne=["value"],oe={key:1,class:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 border border-blue-200 dark:border-blue-800"},de={class:"form-control"},ie=["value"],ue={class:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 border border-blue-200 dark:border-blue-800"},ce={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},be={class:"form-control"},me={class:"form-control"},ge={class:"form-control"},ve={class:"form-control"},pe=["value"],ye={key:2,class:"bg-amber-50 dark:bg-amber-900/20 rounded-lg p-4 border border-amber-200 dark:border-amber-800"},xe={class:"flex items-center justify-between mb-4"},ke={class:"flex gap-2"},he={class:"mb-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded border border-blue-200 dark:border-blue-800"},fe={class:"flex items-center gap-2"},we={class:"text-sm text-blue-700 dark:text-blue-300"},Ae={key:0},De={key:1},Me={key:0,class:"space-y-3 max-h-64 overflow-y-auto"},Ce=["value"],Ie={class:"flex-1"},je={class:"flex items-center justify-between"},Ne={class:"font-semibold text-gray-800 dark:text-gray-100"},Be={class:"text-sm text-gray-600 dark:text-gray-400"},Se={key:0,class:"ml-2 text-blue-600 dark:text-blue-400"},Te={class:"text-right"},Ve={class:"font-bold text-red-600 dark:text-red-400"},Pe={class:"text-xs text-gray-500 dark:text-gray-400"},ze={key:0,class:"text-xs text-yellow-600 dark:text-yellow-400"},Ue={key:0,class:"mt-2"},Le=["onUpdate:modelValue","max"],Ee={key:1,class:"mt-4 p-3 bg-white dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600"},Fe={class:"space-y-2"},He={class:"flex justify-between items-center"},Re={class:"font-semibold text-gray-800 dark:text-gray-100"},Ye={class:"flex justify-between items-center"},Ke={class:"font-semibold text-gray-800 dark:text-gray-100"},Oe={class:"flex justify-between items-center"},_e={class:"font-semibold text-primary"},Ge={key:3,class:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4 border border-green-200 dark:border-green-800"},$e={class:"flex items-center gap-3"},qe={class:"text-green-600 dark:text-green-400 text-sm"},Je={key:4,class:"bg-red-50 dark:bg-red-900/20 rounded-lg p-4 border border-red-200 dark:border-red-800 mb-2"},We={class:"flex items-center gap-3"},Ze={class:"text-red-700 dark:text-red-300 font-semibold"},Qe={class:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700"},Xe=["disabled"],ea=["disabled"],aa={key:0,class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ta={key:1,class:"w-4 h-4 mr-2 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},la={__name:"PaymentModal",props:{visible:{type:Boolean,default:!1},payment:{type:Object,default:()=>({tenantId:null,ownerId:null,amount:null,date:"",type:"",bank:"",description:""})},tenants:{type:Array,default:()=>[]},banks:{type:Array,default:()=>[]},editMode:{type:Boolean,default:!1}},emits:["save","cancel","close"],setup(e,{emit:a}){const t=e,l=a,{handleNetworkError:D}=T(),M=r({tenantId:null,ownerId:null,amount:null,date:"",type:"",bank:"",description:""});s(()=>t.payment,e=>{Object.assign(M,e||{})},{immediate:!0,deep:!0});const C=n([]),I=o(()=>t.tenants||[]),j=o(()=>t.banks||[]),V=n("tenant");s(()=>t.payment,e=>{(null==e?void 0:e.ownerId)?V.value="owner":(null==e?void 0:e.tenantId)&&(V.value="tenant")},{immediate:!0});const P=n([]),z=n([]),U=n(!0),L=n({}),E=e=>{U.value=e,e&&(z.value=[],L.value={})},F=o(()=>z.value.reduce((e,a)=>e+(Number(L.value[a])||0),0)),H=()=>{z.value=[],L.value={}},R=()=>{},Y=n(!1),K=n(""),O=e=>Number(e||0).toLocaleString("tr-TR",{style:"currency",currency:"TRY"}),_=e=>{if(!e)return 0;const a=new Date,t=new Date(e),l=Math.ceil((a-t)/864e5);return l>0?l:0},G=o(()=>!!M.date&&Number(M.amount)>0&&""!==M.type&&!!M.bank&&("tenant"===V.value&&!!M.tenantId||"owner"===V.value&&!!M.ownerId)),$=async()=>{if(M.tenantId)try{const e=await S.getUtilityDebts({tenantId:M.tenantId,status:"Unpaid"});P.value=e||[]}catch(e){D(e,{component:"PaymentModal",action:"fetchTenantDebts"}),P.value=[]}},q=async()=>{if(M.ownerId)try{const e=await S.getUtilityDebts({ownerId:M.ownerId,status:"Unpaid"});P.value=e||[]}catch(e){D(e,{component:"PaymentModal",action:"fetchOwnerDebts"}),P.value=[]}},J=async()=>{if(!G.value)return K.value="LÃ¼tfen tÃ¼m zorunlu alanlarÄ± doldurun ve geÃ§erli bir tutar girin.",void ra(K.value);Y.value=!0,K.value="";try{const e={tenantId:"tenant"===V.value?M.tenantId:null,ownerId:"owner"===V.value?M.ownerId:null,amount:Number(M.amount),paymentDate:M.date,type:parseInt(M.type)||0,bank:M.bank,description:M.description||"",autoAllocate:U.value,debtAllocations:U.value?[]:z.value.map(e=>({debtId:e,amount:Number(L.value[e]||0)}))},a=await N.createPaymentWithAllocation(e);l("save",a)}catch(e){try{D(e,{component:"PaymentModal",action:"savePayment"})}catch{ra("Ã–deme kaydedilirken bir hata oluÅŸtu.")}}finally{Y.value=!1}},la=()=>{P.value=[],z.value=[],L.value={},Y.value=!1,K.value="",l("cancel")};function ra(e){try{"undefined"!=typeof window&&window.$toast?window.$toast.error(e):alert(e)}catch{alert(e)}}const sa=e=>{t.visible&&"Escape"===e.key&&la()};return d(async()=>{window.addEventListener("keydown",sa);try{const e=await B.getOwners();C.value=e||[]}catch{C.value=[]}"tenant"===V.value?await $():await q()}),i(()=>{window.removeEventListener("keydown",sa)}),s(V,e=>{"tenant"===e?$():q()}),s(()=>M.tenantId,()=>{"tenant"===V.value&&$()}),s(()=>M.ownerId,()=>{"owner"===V.value&&q()}),(a,t)=>e.visible?(b(),u("dialog",W,[m("div",Z,[m("div",Q,[t[13]||(t[13]=m("h3",{class:"text-xl font-bold text-gray-800 dark:text-gray-100 flex items-center gap-2"},[m("span",{class:"text-2xl"},"ğŸ’³"),g(" AkÄ±llÄ± Ã–deme Sistemi ")],-1)),m("button",{onClick:t[0]||(t[0]=e=>a.$emit("cancel")),class:"btn btn-sm btn-ghost text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"},t[12]||(t[12]=[m("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),m("form",X,[m("div",ee,[t[16]||(t[16]=m("label",{class:"label"},[m("span",{class:"label-text font-semibold text-gray-700 dark:text-gray-300"},"Ã–deme TÃ¼rÃ¼")],-1)),m("div",ae,[m("label",te,[v(m("input",{type:"radio",value:"tenant","onUpdate:modelValue":t[1]||(t[1]=e=>V.value=e)},null,512),[[p,V.value]]),t[14]||(t[14]=m("span",null,"KÄ°RACI",-1))]),m("label",le,[v(m("input",{type:"radio",value:"owner","onUpdate:modelValue":t[2]||(t[2]=e=>V.value=e)},null,512),[[p,V.value]]),t[15]||(t[15]=m("span",null,"MAL SAHÄ°BÄ°",-1))])])]),"tenant"===V.value?(b(),u("div",re,[t[19]||(t[19]=m("h4",{class:"text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4 flex items-center gap-2"},[m("span",{class:"text-xl"},"ğŸ‘¤"),g(" KiracÄ± SeÃ§imi ")],-1)),m("div",se,[t[18]||(t[18]=m("label",{class:"label"},[m("span",{class:"label-text font-semibold text-gray-700 dark:text-gray-300"},"KiracÄ±")],-1)),v(m("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>M.tenantId=e),onChange:$,class:"select select-bordered w-full bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-800 dark:text-gray-200 focus:border-blue-500 dark:focus:border-blue-400",required:""},[t[17]||(t[17]=m("option",{disabled:"",value:""},"KiracÄ± seÃ§in",-1)),(b(!0),u(x,null,k(I.value,e=>{return b(),u("option",{key:e.id,value:e.id},h((null==(a=e)?void 0:a.companyName)||(null==a?void 0:a.company)||(null==a?void 0:a.contactPersonName)||(null==a?void 0:a.fullName)||[null==a?void 0:a.firstName,null==a?void 0:a.lastName].filter(Boolean).join(" ")||(null==a?void 0:a.email)||`#${null==a?void 0:a.id}`),9,ne);var a}),128))],544),[[y,M.tenantId]])])])):c("",!0),"owner"===V.value?(b(),u("div",oe,[t[22]||(t[22]=m("h4",{class:"text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4 flex items-center gap-2"},[m("span",{class:"text-xl"},"ğŸ "),g(" Mal Sahibi SeÃ§imi ")],-1)),m("div",de,[t[21]||(t[21]=m("label",{class:"label"},[m("span",{class:"label-text font-semibold text-gray-700 dark:text-gray-300"},"Mal Sahibi")],-1)),v(m("select",{"onUpdate:modelValue":t[4]||(t[4]=e=>M.ownerId=e),onChange:q,class:"select select-bordered w-full bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-800 dark:text-gray-200 focus:border-blue-500 dark:focus:border-blue-400",required:""},[t[20]||(t[20]=m("option",{disabled:"",value:""},"Mal Sahibi seÃ§in",-1)),(b(!0),u(x,null,k(C.value,e=>(b(),u("option",{key:e.id,value:e.id},h(e.company||e.fullName||e.name||e.email||`#${e.id}`),9,ie))),128))],544),[[y,M.ownerId]])])])):c("",!0),m("div",ue,[t[29]||(t[29]=m("h4",{class:"text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4 flex items-center gap-2"},[m("span",{class:"text-xl"},"ğŸ¦"),g(" Banka Hareketi Bilgileri ")],-1)),m("div",ce,[m("div",be,[t[23]||(t[23]=m("label",{class:"label"},[m("span",{class:"label-text font-semibold text-gray-700 dark:text-gray-300"},"Hareket Tarihi")],-1)),v(m("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>M.date=e),type:"date",class:"input input-bordered w-full bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-800 dark:text-gray-200 focus:border-blue-500 dark:focus:border-blue-400",required:""},null,512),[[f,M.date]])]),m("div",me,[t[24]||(t[24]=m("label",{class:"label"},[m("span",{class:"label-text font-semibold text-gray-700 dark:text-gray-300"},"Gelen Tutar (â‚º)")],-1)),v(m("input",{"onUpdate:modelValue":t[6]||(t[6]=e=>M.amount=e),type:"number",step:"0.01",placeholder:"0.00",class:"input input-bordered w-full bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-800 dark:text-gray-200 focus:border-blue-500 dark:focus:border-blue-400",required:""},null,512),[[f,M.amount,void 0,{number:!0}]])]),m("div",ge,[t[26]||(t[26]=m("label",{class:"label"},[m("span",{class:"label-text font-semibold text-gray-700 dark:text-gray-300"},"Ã–deme Tipi")],-1)),v(m("select",{"onUpdate:modelValue":t[7]||(t[7]=e=>M.type=e),class:"select select-bordered w-full bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-800 dark:text-gray-200 focus:border-blue-500 dark:focus:border-blue-400",required:""},t[25]||(t[25]=[w('<option disabled value="">Ã–deme Tipi SeÃ§in</option><option value="0">Aidat</option><option value="1">Elektrik</option><option value="2">Su</option><option value="3">DoÄŸalgaz</option><option value="4">DiÄŸer</option>',6)]),512),[[y,M.type]])]),m("div",ve,[t[28]||(t[28]=m("label",{class:"label"},[m("span",{class:"label-text font-semibold text-gray-700 dark:text-gray-300"},"Banka")],-1)),v(m("select",{"onUpdate:modelValue":t[8]||(t[8]=e=>M.bank=e),class:"select select-bordered w-full bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-800 dark:text-gray-200 focus:border-blue-500 dark:focus:border-blue-400",required:""},[t[27]||(t[27]=m("option",{disabled:"",value:""},"Banka SeÃ§in",-1)),(b(!0),u(x,null,k(j.value,e=>(b(),u("option",{key:e,value:e},h(e),9,pe))),128))],512),[[y,M.bank]])])])]),M.tenantId&&P.value.length>0?(b(),u("div",ye,[m("div",xe,[t[33]||(t[33]=m("h4",{class:"text-lg font-semibold text-gray-800 dark:text-gray-100 flex items-center gap-2"},[m("span",{class:"text-xl"},"ğŸ“‹"),g(" BorÃ§ EÅŸleÅŸtirme ")],-1)),m("div",ke,[m("button",{type:"button",onClick:t[9]||(t[9]=e=>E(!0)),class:"btn btn-sm btn-primary bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 border-0 text-white"},t[30]||(t[30]=[m("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})],-1),g(" Otomatik EÅŸleÅŸtir ")])),m("button",{type:"button",onClick:t[10]||(t[10]=e=>E(!1)),class:"btn btn-sm btn-outline border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300"},t[31]||(t[31]=[m("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1),g(" Manuel SeÃ§ ")])),m("button",{type:"button",onClick:H,class:"btn btn-sm btn-outline border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300"},t[32]||(t[32]=[m("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),g(" Temizle ")]))])]),m("div",he,[m("div",fe,[t[35]||(t[35]=m("svg",{class:"w-4 h-4 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),m("span",we,[t[34]||(t[34]=m("strong",null,"AkÄ±llÄ± Ã–deme Sistemi:",-1)),U.value?(b(),u("span",Ae,"Otomatik mod - Backend borÃ§larÄ± kapatacak ve fazla tutarÄ± avans hesabÄ±na aktaracak.")):(b(),u("span",De,"Manuel mod - Hangi borÃ§larÄ±n Ã¶deneceÄŸini seÃ§ebilirsiniz."))])])]),U.value?c("",!0):(b(),u("div",Me,[(b(!0),u(x,null,k(P.value,e=>(b(),u("div",{key:e.id,class:"flex items-center gap-3 p-3 bg-white dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600"},[v(m("input",{type:"checkbox",value:e.id,"onUpdate:modelValue":t[11]||(t[11]=e=>z.value=e),onChange:R,class:"checkbox checkbox-primary"},null,40,Ce),[[A,z.value]]),m("div",Ie,[m("div",je,[m("div",null,[m("p",Ne,h(e.typeLabel||e.type),1),m("p",Be,[g(h(e.period||e.dueDateFormatted)+" ",1),e.unit&&"-"!==e.unit?(b(),u("span",Se," ("+h(e.unit)+") ",1)):c("",!0)])]),m("div",Te,[m("p",Ve,h(O(e.remainingAmount||e.amount)),1),m("p",Pe,h(_(e.dueDate))+" gÃ¼n gecikmiÅŸ",1),e.paidAmount>0?(b(),u("p",ze,h(O((e.remainingAmount||e.amount)-e.paidAmount))+" kalan ",1)):c("",!0)])]),z.value.includes(e.id)?(b(),u("div",Ue,[v(m("input",{"onUpdate:modelValue":a=>L.value[e.id]=a,type:"number",step:"0.01",max:e.remainingAmount||e.amount,class:"input input-sm input-bordered w-32",placeholder:"Tutar"},null,8,Le),[[f,L.value[e.id]]])])):c("",!0)])]))),128))])),z.value.length>0||U.value?(b(),u("div",Ee,[t[39]||(t[39]=m("h5",{class:"font-semibold text-gray-800 dark:text-gray-100 mb-2"},"Ã–deme Ã–zeti",-1)),m("div",Fe,[m("div",He,[t[36]||(t[36]=m("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"Toplam Tutar:",-1)),m("span",Re,h(O(M.amount)),1)]),m("div",Ye,[t[37]||(t[37]=m("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"EÅŸleÅŸtirilecek:",-1)),m("span",Ke,h(O(F.value)),1)]),m("div",Oe,[t[38]||(t[38]=m("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"Avans HesabÄ±na:",-1)),m("span",_e,h(O((M.amount||0)-F.value)),1)])])])):c("",!0)])):c("",!0),M.tenantId&&0===P.value.length?(b(),u("div",Ge,[m("div",$e,[t[43]||(t[43]=m("svg",{class:"w-6 h-6 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),m("div",null,[t[42]||(t[42]=m("p",{class:"text-green-700 dark:text-green-300 font-semibold"},"BorÃ§ BulunamadÄ±",-1)),m("p",qe,[t[40]||(t[40]=g(" SeÃ§ilen kiracÄ±nÄ±n Ã¶denmemiÅŸ borcu bulunmuyor. ")),m("strong",null,h(O(M.amount||0)),1),t[41]||(t[41]=g(" tutarÄ± avans hesabÄ±na aktarÄ±lacak. "))])])])])):c("",!0),K.value?(b(),u("div",Je,[m("div",We,[t[44]||(t[44]=m("svg",{class:"w-6 h-6 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})],-1)),m("span",Ze,h(K.value),1)])])):c("",!0),m("div",Qe,[m("button",{type:"button",class:"btn btn-outline border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700",onClick:la,disabled:Y.value},[t[45]||(t[45]=m("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)),g(" "+h(Y.value?"Ä°ÅŸlem Devam Ediyor...":"Ä°ptal"),1)],8,Xe),m("button",{type:"button",class:"btn btn-success bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 border-0 text-white shadow-lg",disabled:!G.value||Y.value,onClick:J},[Y.value?(b(),u("svg",ta,t[47]||(t[47]=[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)]))):(b(),u("svg",aa,t[46]||(t[46]=[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)]))),g(" "+h(Y.value?"Kaydediliyor...":"Ã–demeyi Kaydet"),1)],8,ea)])])])])):c("",!0)}},ra={class:"financial-reports bg-base-100 p-6 rounded-lg shadow-lg"},sa={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6"},na={class:"form-control"},oa={class:"form-control"},da={class:"form-control"},ia=["value"],ua={class:"form-control"},ca=["disabled","title"],ba={key:0,class:"loading loading-spinner loading-sm"},ma={key:0,class:"alert alert-warning mb-4"},ga={key:1,class:"text-center py-8 text-gray-500"},va={key:2,class:"space-y-6"},pa={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},ya={class:"stat bg-base-200 rounded-lg"},xa={class:"stat-value text-primary"},ka={class:"stat-desc"},ha={class:"stat bg-base-200 rounded-lg"},fa={class:"stat-value text-error"},wa={class:"stat-desc"},Aa={class:"stat bg-base-200 rounded-lg"},Da={class:"stat-value text-success"},Ma={class:"stat-desc"},Ca={class:"stat bg-base-200 rounded-lg"},Ia={class:"overflow-x-auto"},ja={class:"table table-zebra w-full"},Na={class:"text-success"},Ba={class:"text-error"},Sa={key:3,class:"text-center py-8"},Ta={__name:"FinancialReports",setup(a){const{handleNetworkError:t,handleValidationError:l}=T(),{showError:r,showSuccess:s}=V(),i=n(!1),p=n([]),A=n(null),M=new Date,C=new Date(M.getFullYear(),M.getMonth(),1),I=n({startDate:F(C,"yyyy-MM-dd"),endDate:F(M,"yyyy-MM-dd"),tenantId:"",ownerId:""}),j=e=>new Intl.NumberFormat("tr-TR",{style:"currency",currency:"TRY"}).format(Number(e||0)),B=a=>{if(!a)return"-";const t="string"==typeof a||"number"==typeof a?new Date(a):a;return isNaN(t)?"-":F(t,"dd MMM yyyy",{locale:e})},S=o(()=>!I.value.startDate||!I.value.endDate||new Date(I.value.startDate)<=new Date(I.value.endDate)),P=Object.freeze({totalPayments:0,paymentCount:0,totalDebts:0,debtCount:0,advanceBalance:0,advanceAccountCount:0,netBalance:0,details:[]}),z=o(()=>{const e=A.value||{};return{totalPayments:Number(e.totalPayments||0),paymentCount:Number(e.paymentCount||0),totalDebts:Number(e.totalDebts||0),debtCount:Number(e.debtCount||0),advanceBalance:Number(e.advanceBalance||0),advanceAccountCount:Number(e.advanceAccountCount||0),netBalance:Number(e.netBalance||(e.totalPayments||0)-(e.totalDebts||0)),details:Array.isArray(e.details)?e.details.map((e,a)=>({_idx:a,...e})):[]}}),U=o(()=>{const e=z.value;return e.paymentCount>0||e.debtCount>0||e.advanceAccountCount>0||e.details&&e.details.length>0});function L(e){return e.companyName||e.company||e.fullName||[e.firstName,e.lastName].filter(Boolean).join(" ")||e.email||"KiracÄ±"}function H(e){const a=p.value.find(a=>a.id===e);return a?L(a):"Bilinmiyor"}async function R(){if(S.value){i.value=!0;try{const e=await N.getFinancialReports({startDate:I.value.startDate,endDate:I.value.endDate,tenantId:I.value.tenantId||void 0,ownerId:I.value.ownerId||void 0});A.value=e&&"object"==typeof e?e:P,s("Rapor gÃ¼ncellendi")}catch(e){A.value=P,t(e,{component:"FinancialReports",action:"loadReports"}),r("Rapor yÃ¼klenemedi")}finally{i.value=!1}}else l(new Error("Tarih aralÄ±ÄŸÄ± geÃ§ersiz"),{component:"FinancialReports",action:"loadReports"})}return d(()=>{!async function(){try{const e=await E.getTenants();p.value=Array.isArray(e)?e:[]}catch(e){t(e,{component:"FinancialReports",action:"loadTenants"}),p.value=[]}}(),R()}),(e,a)=>(b(),u("div",ra,[a[16]||(a[16]=m("h2",{class:"text-2xl font-bold mb-6 text-primary"},"Finansal Raporlar",-1)),m("div",sa,[m("div",na,[a[3]||(a[3]=m("label",{class:"label"},[m("span",{class:"label-text font-semibold"},"BaÅŸlangÄ±Ã§ Tarihi")],-1)),v(m("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>I.value.startDate=e),type:"date",class:"input input-bordered"},null,512),[[f,I.value.startDate]])]),m("div",oa,[a[4]||(a[4]=m("label",{class:"label"},[m("span",{class:"label-text font-semibold"},"BitiÅŸ Tarihi")],-1)),v(m("input",{"onUpdate:modelValue":a[1]||(a[1]=e=>I.value.endDate=e),type:"date",class:"input input-bordered"},null,512),[[f,I.value.endDate]])]),m("div",da,[a[6]||(a[6]=m("label",{class:"label"},[m("span",{class:"label-text font-semibold"},"KiracÄ±")],-1)),v(m("select",{"onUpdate:modelValue":a[2]||(a[2]=e=>I.value.tenantId=e),class:"select select-bordered"},[a[5]||(a[5]=m("option",{value:""},"TÃ¼m KiracÄ±lar",-1)),(b(!0),u(x,null,k(p.value,e=>(b(),u("option",{key:e.id,value:e.id},h(L(e)),9,ia))),128))],512),[[y,I.value.tenantId]])]),m("div",ua,[a[7]||(a[7]=m("label",{class:"label"},[m("span",{class:"label-text font-semibold"},"Â ")],-1)),m("button",{onClick:R,class:"btn btn-primary",disabled:i.value||!S.value,title:S.value?"":"BaÅŸlangÄ±Ã§ tarihi bitiÅŸten bÃ¼yÃ¼k olamaz"},[i.value?(b(),u("span",ba)):c("",!0),g(" "+h(i.value?"YÃ¼kleniyor...":"Rapor YÃ¼kle"),1)],8,ca)])]),S.value?c("",!0):(b(),u("div",ma," BaÅŸlangÄ±Ã§ tarihi, bitiÅŸ tarihinden bÃ¼yÃ¼k olamaz. ")),i.value?(b(),u("div",ga,"YÃ¼kleniyorâ€¦")):U.value?(b(),u("div",va,[m("div",pa,[m("div",ya,[a[8]||(a[8]=m("div",{class:"stat-title"},"Toplam Ã–deme",-1)),m("div",xa,h(j(z.value.totalPayments)),1),m("div",ka,h(z.value.paymentCount)+" Ã¶deme",1)]),m("div",ha,[a[9]||(a[9]=m("div",{class:"stat-title"},"Toplam BorÃ§",-1)),m("div",fa,h(j(z.value.totalDebts)),1),m("div",wa,h(z.value.debtCount)+" borÃ§",1)]),m("div",Aa,[a[10]||(a[10]=m("div",{class:"stat-title"},"Avans Bakiyesi",-1)),m("div",Da,h(j(z.value.advanceBalance)),1),m("div",Ma,h(z.value.advanceAccountCount)+" hesap",1)]),m("div",Ca,[a[11]||(a[11]=m("div",{class:"stat-title"},"Net Durum",-1)),m("div",{class:D(["stat-value",z.value.netBalance>=0?"text-success":"text-error"])},h(j(z.value.netBalance)),3),a[12]||(a[12]=m("div",{class:"stat-desc"},"Ã–deme - BorÃ§",-1))])]),m("div",Ia,[m("table",ja,[a[13]||(a[13]=m("thead",null,[m("tr",null,[m("th",null,"Tarih"),m("th",null,"KiracÄ±"),m("th",null,"Ã–deme"),m("th",null,"BorÃ§"),m("th",null,"Kalan"),m("th",null,"Durum")])],-1)),m("tbody",null,[(b(!0),u(x,null,k(z.value.details,e=>(b(),u("tr",{key:e.id||e._idx},[m("td",null,h(B(e.date)),1),m("td",null,h(e.tenantName||H(e.tenantId)),1),m("td",Na,h(j(e.paymentAmount||0)),1),m("td",Ba,h(j(e.debtAmount||0)),1),m("td",{class:D((e.remainingAmount||0)>=0?"text-success":"text-error")},h(j(e.remainingAmount||0)),3),m("td",null,[m("span",{class:D(["badge",(e.remainingAmount||0)>=0?"badge-success":"badge-error"])},h((e.remainingAmount||0)>=0?"Pozitif":"Negatif"),3)])]))),128))])])]),a[14]||(a[14]=w('<div class="bg-base-200 p-4 rounded-lg"><h3 class="text-lg font-semibold mb-3">Grafik GÃ¶rÃ¼nÃ¼mÃ¼</h3><div class="text-center py-8 text-gray-500"><svg class="w-16 h-16 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2z"></path></svg><p>Grafik gÃ¶rÃ¼nÃ¼mÃ¼ yakÄ±nda eklenecek</p></div></div>',1))])):i.value?c("",!0):(b(),u("div",Sa,a[15]||(a[15]=[w('<div class="text-gray-500"><svg class="w-16 h-16 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg><p class="text-lg font-medium">Rapor bulunamadÄ±</p><p class="text-sm">Filtreleri deÄŸiÅŸtirip tekrar deneyin.</p></div>',1)])))]))}},Va={class:"audit-logs bg-base-100 p-6 rounded-lg shadow-lg"},Pa={class:"grid grid-cols-1 md:grid-cols-5 gap-4 mb-6"},za={class:"form-control"},Ua={class:"form-control"},La={class:"form-control"},Ea=["value"],Fa={class:"form-control"},Ha=["value"],Ra={class:"form-control"},Ya=["disabled"],Ka={key:0,class:"loading loading-spinner loading-sm"},Oa={key:0,class:"overflow-x-auto"},_a={class:"table table-zebra w-full"},Ga={class:"flex items-center space-x-2"},$a={class:"avatar placeholder"},qa={class:"bg-neutral text-neutral-content rounded-full w-8"},Ja={class:"text-xs"},Wa={class:"font-medium"},Za={class:"text-sm text-gray-500"},Qa={class:"font-medium"},Xa={class:"text-sm text-gray-500"},et={class:"text-sm text-gray-500"},at=["onClick"],tt={key:1,class:"text-center py-8"},lt={id:"log_details_modal",class:"modal"},rt={class:"modal-box w-11/12 max-w-4xl"},st={key:0,class:"space-y-4"},nt={class:"grid grid-cols-2 gap-4"},ot={class:"text-sm"},dt={class:"text-sm"},it={class:"text-sm"},ut={class:"text-sm"},ct={class:"text-sm"},bt={class:"text-sm text-xs"},mt={key:0},gt={class:"bg-base-200 p-4 rounded-lg"},vt={key:0,class:"mb-3"},pt={class:"text-xs bg-error text-error-content p-2 rounded"},yt={key:1},xt={class:"text-xs bg-success text-success-content p-2 rounded"},kt={key:1},ht={class:"bg-base-200 p-4 rounded-lg"},ft={class:"text-xs"},wt={__name:"AuditLogs",setup(a){const t=n(!1),l=n([]),r=n(null),s=n({startDate:F(new Date((new Date).getFullYear(),(new Date).getMonth(),1),"yyyy-MM-dd"),endDate:F(new Date,"yyyy-MM-dd"),action:"",entityType:"",userId:""}),o=a=>F(new Date(a),"dd MMM yyyy HH:mm",{locale:e}),i=async()=>{t.value=!0;try{const e=await N.getAuditLogs(s.value);l.value=e||[]}catch(e){alert("Loglar yÃ¼klenemedi: "+e.message)}finally{t.value=!1}};return d(()=>{i()}),(e,a)=>(b(),u("div",Va,[a[25]||(a[25]=m("h2",{class:"text-2xl font-bold mb-6 text-primary"},"Sistem LoglarÄ±",-1)),m("div",Pa,[m("div",za,[a[4]||(a[4]=m("label",{class:"label"},[m("span",{class:"label-text font-semibold"},"BaÅŸlangÄ±Ã§ Tarihi")],-1)),v(m("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>s.value.startDate=e),type:"date",class:"input input-bordered"},null,512),[[f,s.value.startDate]])]),m("div",Ua,[a[5]||(a[5]=m("label",{class:"label"},[m("span",{class:"label-text font-semibold"},"BitiÅŸ Tarihi")],-1)),v(m("input",{"onUpdate:modelValue":a[1]||(a[1]=e=>s.value.endDate=e),type:"date",class:"input input-bordered"},null,512),[[f,s.value.endDate]])]),m("div",La,[a[7]||(a[7]=m("label",{class:"label"},[m("span",{class:"label-text font-semibold"},"Ä°ÅŸlem TÃ¼rÃ¼")],-1)),v(m("select",{"onUpdate:modelValue":a[2]||(a[2]=e=>s.value.action=e),class:"select select-bordered"},[a[6]||(a[6]=m("option",{value:""},"TÃ¼m Ä°ÅŸlemler",-1)),(b(!0),u(x,null,k(M(H),(e,a)=>(b(),u("option",{key:a,value:a},h(e),9,Ea))),128))],512),[[y,s.value.action]])]),m("div",Fa,[a[9]||(a[9]=m("label",{class:"label"},[m("span",{class:"label-text font-semibold"},"VarlÄ±k TÃ¼rÃ¼")],-1)),v(m("select",{"onUpdate:modelValue":a[3]||(a[3]=e=>s.value.entityType=e),class:"select select-bordered"},[a[8]||(a[8]=m("option",{value:""},"TÃ¼m VarlÄ±klar",-1)),(b(!0),u(x,null,k(M(R),(e,a)=>(b(),u("option",{key:a,value:a},h(e),9,Ha))),128))],512),[[y,s.value.entityType]])]),m("div",Ra,[a[10]||(a[10]=m("label",{class:"label"},[m("span",{class:"label-text font-semibold"},"Â ")],-1)),m("button",{onClick:i,class:"btn btn-primary",disabled:t.value},[t.value?(b(),u("span",Ka)):c("",!0),g(" "+h(t.value?"YÃ¼kleniyor...":"Log YÃ¼kle"),1)],8,Ya)])]),l.value.length>0?(b(),u("div",Oa,[m("table",_a,[a[11]||(a[11]=m("thead",null,[m("tr",null,[m("th",null,"Tarih"),m("th",null,"KullanÄ±cÄ±"),m("th",null,"Ä°ÅŸlem"),m("th",null,"VarlÄ±k"),m("th",null,"IP Adresi"),m("th",null,"Detaylar")])],-1)),m("tbody",null,[(b(!0),u(x,null,k(l.value,e=>{var a,t;return b(),u("tr",{key:e.id},[m("td",null,h(o(e.createdAt)),1),m("td",null,[m("div",Ga,[m("div",$a,[m("div",qa,[m("span",Ja,h((null==(a=e.userName)?void 0:a.charAt(0))||"U"),1)])]),m("div",null,[m("div",Wa,h(e.userName||"Sistem"),1),m("div",Za,h(e.userEmail||"-"),1)])])]),m("td",null,[m("span",{class:D(["badge",(t=e.action,{Create:"badge-success",Update:"badge-warning",Delete:"badge-error",Payment:"badge-primary",DebtAllocation:"badge-info",AdvanceUsage:"badge-secondary"}[t]||"badge-neutral")])},h(M(Y)(e.action)),3)]),m("td",null,[m("div",null,[m("div",Qa,h(M(K)(e.entityType)),1),m("div",Xa,"ID: "+h(e.entityId),1)])]),m("td",et,h(e.ipAddress||"-"),1),m("td",null,[m("button",{onClick:a=>(e=>{r.value=e,document.getElementById("log_details_modal").showModal()})(e),class:"btn btn-sm btn-outline"}," Detaylar ",8,at)])])}),128))])])])):t.value?c("",!0):(b(),u("div",tt,a[12]||(a[12]=[w('<div class="text-gray-500"><svg class="w-16 h-16 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg><p class="text-lg font-medium">Log bulunamadÄ±</p><p class="text-sm">Filtreleri deÄŸiÅŸtirip tekrar deneyin.</p></div>',1)]))),m("dialog",lt,[m("div",rt,[a[23]||(a[23]=m("h3",{class:"font-bold text-lg mb-4"},"Log DetaylarÄ±",-1)),r.value?(b(),u("div",st,[m("div",nt,[m("div",null,[a[13]||(a[13]=m("label",{class:"label"},[m("span",{class:"label-text font-semibold"},"Tarih")],-1)),m("div",ot,h(o(r.value.createdAt)),1)]),m("div",null,[a[14]||(a[14]=m("label",{class:"label"},[m("span",{class:"label-text font-semibold"},"KullanÄ±cÄ±")],-1)),m("div",dt,h(r.value.userName||"Sistem"),1)]),m("div",null,[a[15]||(a[15]=m("label",{class:"label"},[m("span",{class:"label-text font-semibold"},"Ä°ÅŸlem")],-1)),m("div",it,h(M(Y)(r.value.action)),1)]),m("div",null,[a[16]||(a[16]=m("label",{class:"label"},[m("span",{class:"label-text font-semibold"},"VarlÄ±k")],-1)),m("div",ut,h(M(K)(r.value.entityType))+" (ID: "+h(r.value.entityId)+")",1)]),m("div",null,[a[17]||(a[17]=m("label",{class:"label"},[m("span",{class:"label-text font-semibold"},"IP Adresi")],-1)),m("div",ct,h(r.value.ipAddress||"-"),1)]),m("div",null,[a[18]||(a[18]=m("label",{class:"label"},[m("span",{class:"label-text font-semibold"},"User Agent")],-1)),m("div",bt,h(r.value.userAgent||"-"),1)])]),r.value.oldValues||r.value.newValues?(b(),u("div",mt,[a[21]||(a[21]=m("label",{class:"label"},[m("span",{class:"label-text font-semibold"},"DeÄŸiÅŸiklikler")],-1)),m("div",gt,[r.value.oldValues?(b(),u("div",vt,[a[19]||(a[19]=m("div",{class:"font-semibold text-error mb-2"},"Eski DeÄŸerler:",-1)),m("pre",pt,h(JSON.stringify(r.value.oldValues,null,2)),1)])):c("",!0),r.value.newValues?(b(),u("div",yt,[a[20]||(a[20]=m("div",{class:"font-semibold text-success mb-2"},"Yeni DeÄŸerler:",-1)),m("pre",xt,h(JSON.stringify(r.value.newValues,null,2)),1)])):c("",!0)])])):c("",!0),r.value.additionalData?(b(),u("div",kt,[a[22]||(a[22]=m("label",{class:"label"},[m("span",{class:"label-text font-semibold"},"Ek Bilgiler")],-1)),m("div",ht,[m("pre",ft,h(JSON.stringify(r.value.additionalData,null,2)),1)])])):c("",!0)])):c("",!0),a[24]||(a[24]=m("div",{class:"modal-action"},[m("form",{method:"dialog"},[m("button",{class:"btn"},"Kapat")])],-1))])])]))}},At=C("payments",{state:()=>({payments:[],advanceAccounts:[],loading:!1,lastFetched:null}),actions:{async fetchPayments(e=!1){if(!e&&this.payments.length>0&&this.lastFetched&&Date.now()-this.lastFetched<3e5)return this.payments;this.loading=!0;try{const e=await N.getPayments();return this.payments=e||[],this.lastFetched=Date.now(),this.payments}catch(t){throw a.logError(t,{component:"PaymentsStore",action:"fetchPayments"}),t}finally{this.loading=!1}},async fetchAdvanceAccounts(){this.loading=!0;try{const e=await N.getAdvanceAccounts(),a=Array.isArray(e)?e:(null==e?void 0:e.items)||[];return this.advanceAccounts=a.map(e=>({...e,balance:Number(e.balance??0)})).filter(e=>e.balance>0),this.advanceAccounts}catch(e){throw a.logError(e,{component:"PaymentsStore",action:"fetchAdvanceAccounts"}),e}finally{this.loading=!1}},async deletePayment(e){try{await N.deletePayment(e),this.payments=this.payments.filter(a=>a.id!==e),await this.fetchAdvanceAccounts()}catch(a){throw a}}}}),Dt={class:"p-4 sm:p-6 bg-gray-50 min-h-screen font-sans dark:bg-gray-900"},Mt={class:"max-w-7xl mx-auto"},Ct={class:"flex items-center justify-between mb-6"},It={class:"flex items-center gap-4"},jt={class:"bg-green-100 dark:bg-green-900/50 text-green-600 dark:text-green-400 px-3 py-1 rounded-full text-sm"},Nt={class:"bg-blue-100 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400 px-3 py-1 rounded-full text-sm"},Bt={class:"bg-purple-100 dark:bg-purple-900/50 text-purple-600 dark:text-purple-400 px-3 py-1 rounded-full text-sm"},St={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8"},Tt={class:"bg-white dark:bg-gray-800 p-5 rounded-xl shadow-md flex items-center gap-4 border border-gray-200 dark:border-gray-700"},Vt={class:"text-2xl font-bold text-gray-800 dark:text-gray-100"},Pt={class:"bg-white dark:bg-gray-800 p-5 rounded-xl shadow-md flex items-center gap-4 border border-gray-200 dark:border-gray-700"},zt={class:"text-2xl font-bold text-gray-800 dark:text-gray-100"},Ut={class:"bg-white dark:bg-gray-800 p-5 rounded-xl shadow-md flex items-center gap-4 border border-gray-200 dark:border-gray-700"},Lt={class:"text-2xl font-bold text-gray-800 dark:text-gray-100"},Et={class:"bg-white dark:bg-gray-800 p-5 rounded-xl shadow-md flex items-center gap-4 border border-gray-200 dark:border-gray-700"},Ft={class:"text-2xl font-bold text-gray-800 dark:text-gray-100"},Ht={class:"bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md border border-gray-200 dark:border-gray-700 mb-8"},Rt={class:"h-64 flex items-end justify-between gap-2"},Yt={class:"text-xs text-gray-500 dark:text-gray-400"},Kt={class:"bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md border border-gray-200 dark:border-gray-700 mb-8"},Ot={class:"grid grid-cols-2 sm:grid-cols-4 gap-4"},_t={class:"flex items-center gap-3 mb-2"},Gt={class:"text-2xl"},$t={class:"font-semibold text-gray-800 dark:text-gray-100"},qt={class:"text-sm text-gray-500 dark:text-gray-400"},Jt={class:"text-lg font-bold text-green-600 dark:text-green-400"},Wt={key:0,class:"mb-6"},Zt={key:1,class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6"},Qt={key:2,class:"bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md border border-gray-200 dark:border-gray-700 mb-6"},Xt={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},el={class:"flex items-center justify-between mb-2"},al={class:"font-semibold text-gray-800 dark:text-gray-100"},tl={class:"text-2xl font-bold text-purple-600 dark:text-purple-400 mb-1"},ll={class:"text-sm text-gray-600 dark:text-gray-400"},rl={class:"bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md border border-gray-200 dark:border-gray-700"},sl={class:"mt-6 space-y-2"},nl={key:0,class:"text-center py-12 text-gray-500 dark:text-gray-400"},ol={key:1},dl={class:"md:col-span-5 flex items-center gap-4"},il={class:"font-bold text-gray-800 dark:text-gray-100"},ul={class:"text-sm text-gray-500 dark:text-gray-400"},cl={class:"md:col-span-3 text-left md:text-center text-2xl font-semibold text-green-600 dark:text-green-400"},bl={class:"md:col-span-2 text-left md:text-center text-sm text-gray-600 dark:text-gray-300"},ml={class:"font-semibold text-gray-800 dark:text-gray-100 flex items-center gap-2"},gl={key:0,class:"md:col-span-2 text-right"},vl={class:"dropdown dropdown-end"},pl={tabindex:"0",class:"dropdown-content menu p-2 shadow bg-base-200 rounded-box w-32 z-10"},yl=["onClick"],xl=["onClick"],kl={key:0,class:"modal",open:""},hl={class:"modal-box max-w-4xl"},fl={class:"flex items-center justify-between mb-4"},wl={key:1,class:"modal",open:""},Al={class:"modal-box max-w-6xl"},Dl={class:"flex items-center justify-between mb-4"},Ml={key:2,class:"modal",open:""},Cl={class:"modal-box max-w-6xl"},Il={class:"flex items-center justify-between mb-4"},jl={key:3,class:"flex justify-center items-center py-12"},Nl={__name:"Payments",setup(e){const{handleNetworkError:a}=T(),{showCreateSuccess:r,showUpdateSuccess:s,showDeleteSuccess:i,showSuccess:v}=V(),p=t(),y=At(),f=G(),w=e=>L(e,"dd MMM yyyy"),A=o(()=>y.payments),C=o(()=>f.tenants),N=o(()=>y.advanceAccounts),B=n(["Ziraat","Ä°ÅŸ BankasÄ±","Garanti","YapÄ± Kredi","Halkbank"]),S=n(!1),E=n(!1),F=n(!1),H=n(!1),R=o(()=>y.loading||f.loading),Y=n({searchTerm:"",period:"",type:""}),K=e=>{if("number"==typeof e)return e;if(""===e||null==e)return"";if(!Number.isNaN(Number(e)))return Number(e);const a=Object.entries(O).find(([,a])=>a===e);return a?Number(a[0]):""},W={0:"ğŸ¢",1:"âš¡ï¸",2:"ğŸ’§",3:"ğŸ”¥",4:"ğŸ’³"},Z=e=>W[K(e)]??"ğŸ’³",Q=o(()=>Object.entries(O).map(([e,a])=>({value:Number(e),label:a,icon:Z(Number(e))}))),X=o(()=>[{value:"",label:"TÃ¼m Tipler",icon:"ğŸ“¦"},...Q.value]),ee=e=>(null==e?void 0:e.date)||(null==e?void 0:e.paymentDate)||(null==e?void 0:e.createdAt)||"",ae=o(()=>A.value.reduce((e,a)=>e+Number(a.amount||0),0)),te=o(()=>{const e=new Date,a=`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}`;return A.value.filter(e=>(ee(e)||"").startsWith(a)).reduce((e,a)=>e+Number(a.amount||0),0)}),le=o(()=>{const e=new Date,a=`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}`;return A.value.filter(e=>(ee(e)||"").startsWith(a)).length}),re=o(()=>A.value.length),se=o(()=>N.value.reduce((e,a)=>e+Number(a.balance??0),0)),ne=e=>{if(!e)return"Mal Sahibi Ã–demesi";const a=f.getTenantById(e);return(null==a?void 0:a.companyName)||(null==a?void 0:a.company)||(null==a?void 0:a.contactPersonName)||(null==a?void 0:a.fullName)||[null==a?void 0:a.firstName,null==a?void 0:a.lastName].filter(Boolean).join(" ")||(null==a?void 0:a.email)||`#${e}`},oe=o(()=>{let e=A.value;const a=(Y.value.searchTerm||"").toLowerCase(),t=K(Y.value.type);return""!==t&&void 0!==t&&(e=e.filter(e=>K(e.type)===t)),Y.value.period&&(e=e.filter(e=>{const a=ee(e);if(!a)return!1;const t=new Date(Y.value.period),l=new Date(a);return l.getFullYear()===t.getFullYear()&&l.getMonth()===t.getMonth()})),a&&(e=e.filter(e=>ne(e.tenantId).toLowerCase().includes(a)||_(K(e.type)).toLowerCase().includes(a)||e.bank&&e.bank.toLowerCase().includes(a)||e.amount&&String(e.amount).includes(a))),e.sort((e,a)=>new Date(ee(a))-new Date(ee(e)))}),de=n({date:(new Date).toISOString().substring(0,10),tenantId:"",ownerId:null,amount:null,type:"",bank:"",description:""}),ie=n(!1),ue=n(null),ce=()=>{S.value=!1,de.value={date:(new Date).toISOString().substring(0,10),tenantId:"",ownerId:null,amount:null,type:"",bank:"",description:""},ie.value=!1,ue.value=null},be=()=>{Y.value={searchTerm:"",period:"",type:""},y.fetchPayments(!0)},me=async()=>{S.value=!1,de.value={date:(new Date).toISOString().substring(0,10),tenantId:"",ownerId:null,amount:null,type:"",bank:"",description:""};const e=ie.value;ie.value=!1,ue.value=null,await Promise.all([y.fetchPayments(!0),y.fetchAdvanceAccounts()]),e?s("Ã–deme"):r("Ã–deme")},ge=()=>{E.value=!1,y.fetchAdvanceAccounts(),v("Avans hesabÄ± iÅŸlemi baÅŸarÄ±yla tamamlandÄ±")},ve=o(()=>{const e=[],a=new Date;for(let t=5;t>=0;t--){const l=new Date(a.getFullYear(),a.getMonth()-t,1),r=`${l.getFullYear()}-${String(l.getMonth()+1).padStart(2,"0")}`,s=l.toLocaleDateString("tr-TR",{month:"short"}),n=A.value.filter(e=>(ee(e)||"").startsWith(r)).reduce((e,a)=>e+Number(a.amount||0),0);e.push({month:s,total:n})}return e}),pe=o(()=>Math.max(...ve.value.map(e=>e.total),1)),ye=o(()=>{const e={};return A.value.forEach(a=>{const t=K(a.type);""!==t&&(e[t]||(e[t]={name:t,label:_(t),icon:Z(t),count:0,total:0}),e[t].count++,e[t].total+=Number(a.amount||0))}),Object.values(e).sort((e,a)=>a.total-e.total)});return d(()=>{f.fetchTenants(),y.fetchAdvanceAccounts(),y.fetchPayments()}),(e,t)=>(b(),u("div",Dt,[m("div",Mt,[m("div",Ct,[t[10]||(t[10]=m("h1",{class:"text-3xl font-bold text-gray-800 dark:text-gray-100"},"KiracÄ± Ã–demeleri",-1)),m("div",It,[m("div",jt," Toplam: "+h(M($)(ae.value)),1),m("div",Nt," Bu Ay: "+h(M($)(te.value)),1),m("div",Bt,h(re.value)+" Ã¶deme ",1)])]),m("section",St,[m("div",Tt,[t[12]||(t[12]=m("div",{class:"bg-green-100 dark:bg-green-900/50 text-green-600 dark:text-green-400 rounded-full p-3"},[m("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[m("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})])],-1)),m("div",null,[t[11]||(t[11]=m("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Bu Ayki Gelir",-1)),m("p",Vt,h(M($)(te.value)),1)])]),m("div",Pt,[t[14]||(t[14]=m("div",{class:"bg-blue-100 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400 rounded-full p-3"},[m("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[m("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"})])],-1)),m("div",null,[t[13]||(t[13]=m("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Toplam Gelir",-1)),m("p",zt,h(M($)(ae.value)),1)])]),m("div",Ut,[t[16]||(t[16]=m("div",{class:"bg-amber-100 dark:bg-amber-900/50 text-amber-600 dark:text-amber-400 rounded-full p-3"},[m("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[m("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),m("div",null,[t[15]||(t[15]=m("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Bu Ayki Ä°ÅŸlem SayÄ±sÄ±",-1)),m("p",Lt,h(le.value),1)])]),m("div",Et,[t[18]||(t[18]=m("div",{class:"bg-purple-100 dark:bg-purple-900/50 text-purple-600 dark:text-purple-400 rounded-full p-3"},[m("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[m("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"})])],-1)),m("div",null,[t[17]||(t[17]=m("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Toplam Avans",-1)),m("p",Ft,h(M($)(se.value)),1)])])]),m("section",Ht,[t[19]||(t[19]=m("div",{class:"flex items-center justify-between mb-4"},[m("h2",{class:"text-xl font-semibold text-gray-800 dark:text-gray-100"},"AylÄ±k Ã–deme GrafiÄŸi")],-1)),m("div",Rt,[(b(!0),u(x,null,k(ve.value,(e,a)=>(b(),u("div",{key:a,class:"flex-1 flex flex-col items-center gap-2"},[m("div",{class:"w-full bg-green-500 rounded-t",style:j({height:e.total/pe.value*200+"px"})},null,4),m("span",Yt,h(e.month),1)]))),128))])]),m("section",Kt,[t[20]||(t[20]=m("h2",{class:"text-xl font-semibold text-gray-800 dark:text-gray-100 mb-4"},"Ã–deme Tipi DaÄŸÄ±lÄ±mÄ±",-1)),m("div",Ot,[(b(!0),u(x,null,k(ye.value,e=>(b(),u("div",{key:e.name,class:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg border border-gray-200 dark:border-gray-600"},[m("div",_t,[m("span",Gt,h(e.icon),1),m("div",null,[m("p",$t,h(e.label),1),m("p",qt,h(e.count)+" Ã¶deme",1)])]),m("p",Jt,h(M($)(e.total)),1)]))),128))])]),M(p).role===M(l).ADMIN||M(p).role===M(l).MANAGER?(b(),u("div",Wt,[m("button",{onClick:t[0]||(t[0]=e=>S.value=!0),class:"w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-semibold py-4 px-6 rounded-xl shadow-lg transition-all duration-300 flex items-center justify-center gap-3"},t[21]||(t[21]=[m("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1),m("span",null,"Yeni Ã–deme Ekle",-1)]))])):c("",!0),M(p).role===M(l).ADMIN||M(p).role===M(l).MANAGER?(b(),u("div",Zt,[m("button",{onClick:t[1]||(t[1]=e=>E.value=!0),class:"bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 text-white font-semibold py-3 px-4 rounded-xl shadow-lg transition-all duration-300 flex items-center justify-center gap-2"},t[22]||(t[22]=[m("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"})],-1),m("span",null,"Avans HesabÄ±",-1)])),m("button",{onClick:t[2]||(t[2]=e=>F.value=!0),class:"bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white font-semibold py-3 px-4 rounded-xl shadow-lg transition-all duration-300 flex items-center justify-center gap-2"},t[23]||(t[23]=[m("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2z"})],-1),m("span",null,"Finansal Raporlar",-1)])),M(p).role===M(l).ADMIN?(b(),u("button",{key:0,onClick:t[3]||(t[3]=e=>H.value=!0),class:"bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-semibold py-3 px-4 rounded-xl shadow-lg transition-all duration-300 flex items-center justify-center gap-2"},t[24]||(t[24]=[m("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[m("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),m("span",null,"Sistem LoglarÄ±",-1)]))):c("",!0)])):c("",!0),N.value.length>0?(b(),u("div",Qt,[t[26]||(t[26]=m("h3",{class:"text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4 flex items-center gap-2"},[m("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-purple-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[m("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"})]),g(" Avans HesaplarÄ± ")],-1)),m("div",Xt,[(b(!0),u(x,null,k(N.value,e=>(b(),u("div",{key:e.id,class:"bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg border border-purple-200 dark:border-purple-800"},[m("div",el,[m("span",al,h(ne(e.tenantId)),1),t[25]||(t[25]=m("span",{class:"badge badge-success badge-sm"},"Aktif",-1))]),m("p",tl,h(M($)(Number(e.balance??e.amount??0))),1),m("p",ll,h(w(e.updatedAt||e.lastMovementAt||e.createdAt||e.paymentDate)),1)]))),128))])])):c("",!0),m("div",rl,[I(P,{search:Y.value.searchTerm,"search-placeholder":"Firma, tutar, tip veya banka ara...",period:Y.value.period,"select-type":Y.value.type,"select-type-options":X.value,"onUpdate:search":t[4]||(t[4]=e=>Y.value.searchTerm=e),"onUpdate:period":t[5]||(t[5]=e=>Y.value.period=e),"onUpdate:selectType":t[6]||(t[6]=e=>Y.value.type=e),onClearFilters:be},null,8,["search","period","select-type","select-type-options"]),m("div",sl,[0===oe.value.length?(b(),u("div",nl,t[27]||(t[27]=[m("p",null,"AramanÄ±zla eÅŸleÅŸen Ã¶deme bulunamadÄ±.",-1)]))):(b(),u("div",ol,[(b(!0),u(x,null,k(oe.value,e=>(b(),u("div",{key:e.id,class:"grid grid-cols-1 md:grid-cols-12 gap-4 items-center p-4 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors duration-200 border-b dark:border-gray-700/50"},[m("div",dl,[m("div",{class:D(["flex-shrink-0 h-12 w-12 flex items-center justify-center text-white rounded-full text-xl font-bold",M(q)(ne(e.tenantId))])},h(M(J)(ne(e.tenantId))),3),m("div",null,[m("p",il,h(ne(e.tenantId)),1),m("p",ul,h(w(ee(e))),1)])]),m("div",cl,h(M($)(e.amount)),1),m("div",bl,[m("p",ml,[m("span",null,h(Z(e.type)),1),m("span",null,h(M(_)(K(e.type))),1)]),m("p",null,h(e.bank),1)]),M(p).role===M(l).ADMIN||M(p).role===M(l).MANAGER?(b(),u("div",gl,[m("div",vl,[t[28]||(t[28]=m("label",{tabindex:"0",class:"btn btn-ghost btn-sm"},"Ä°ÅŸlemler",-1)),m("ul",pl,[m("li",null,[m("a",{onClick:a=>{return t=e,de.value={date:(ee(t)||(new Date).toISOString()).substring(0,10),tenantId:t.tenantId||"",ownerId:t.ownerId??null,amount:t.amount??null,type:K(t.type),bank:t.bank??"",description:t.description??""},ue.value=t.id,ie.value=!0,void(S.value=!0);var t}},"DÃ¼zenle",8,yl)]),m("li",null,[m("a",{onClick:t=>(async e=>{try{await y.deletePayment(e),i("Ã–deme")}catch(t){a(t,{component:"Payments",action:"deletePayment"})}})(e.id),class:"text-red-500"},"Sil",8,xl)])])])])):c("",!0)]))),128))]))])])]),I(la,{visible:S.value,payment:de.value,tenants:C.value,banks:B.value,editMode:ie.value,onSave:me,onCancel:ce},null,8,["visible","payment","tenants","banks","editMode"]),E.value?(b(),u("dialog",kl,[m("div",hl,[m("div",fl,[t[29]||(t[29]=m("h3",{class:"text-xl font-bold"},"Avans HesabÄ± YÃ¶netimi",-1)),m("button",{onClick:t[7]||(t[7]=e=>E.value=!1),class:"btn btn-sm btn-ghost"},"âœ•")]),I(z,{onSuccess:ge})])])):c("",!0),F.value?(b(),u("dialog",wl,[m("div",Al,[m("div",Dl,[t[30]||(t[30]=m("h3",{class:"text-xl font-bold"},"Finansal Raporlar",-1)),m("button",{onClick:t[8]||(t[8]=e=>F.value=!1),class:"btn btn-sm btn-ghost"},"âœ•")]),I(Ta)])])):c("",!0),H.value?(b(),u("dialog",Ml,[m("div",Cl,[m("div",Il,[t[31]||(t[31]=m("h3",{class:"text-xl font-bold"},"Sistem LoglarÄ±",-1)),m("button",{onClick:t[9]||(t[9]=e=>H.value=!1),class:"btn btn-sm btn-ghost"},"âœ•")]),I(wt)])])):c("",!0),R.value?(b(),u("div",jl,[I(U)])):c("",!0)]))}};export{Nl as default};
