import{r as e,w as t,c as a,b as l,f as n,g as s,h as i,t as r,p as u,e as o,F as d,i as c,n as m,j as v,l as p}from"./vue-vendor-BE3w9SvD.js";import{t as y}from"./tenantsService-DcFCN9jj.js";import{p as b}from"./paymentsService-sfLQHDz3.js";import{u as g}from"./utilityDebtsService-BN5YpzJB.js";import{u as h}from"./index-CAkTsZV-.js";import{u as f}from"./useErrorHandler-CQcR_3b6.js";import"./useNotification-Dv4wKXE4.js";const x={key:0,class:"flex justify-center items-center h-96"},k={key:1,class:"text-center p-12"},D={key:2,class:"p-4 sm:p-6 space-y-6"},w={class:"card bg-base-100 shadow-xl"},T={class:"card-body"},N={class:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4"},A={class:"flex items-center gap-4"},E={class:"avatar placeholder"},S={class:"bg-primary text-primary-content rounded-full w-16"},B={class:"text-2xl"},j={class:"text-3xl font-bold"},P={class:"text-base-content/70"},K={class:"flex items-center gap-4"},$={class:"text-right"},I={class:"tabs tabs-boxed"},C={class:"card bg-base-100 shadow-xl min-h-[300px]"},L={class:"card-body"},_={key:0},G={class:"overflow-x-auto"},R={class:"table w-full"},Y={class:"text-right font-semibold"},z={key:0},F={key:1},U={class:"overflow-x-auto"},W={class:"table w-full"},H={class:"text-right font-semibold text-success"},q={key:0},J={key:2},M={class:"overflow-x-auto"},O={class:"table w-full"},Q={class:"text-right font-semibold"},V={key:0},X={key:3,class:"space-y-4"},Z={class:"grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4 pt-4"},ee=["href"],te=["href"],ae={key:0},le={class:"md:col-span-2"},ne={__name:"TenantDetailPage",setup(ne){const se=v(),ie=h(),{handleNetworkError:re}=f(),ue=e(null),oe=e(null),de=e([]),ce=e([]),me=e([]),ve=e(!0),pe=e("debts"),ye=e(0),be=e=>null==e||isNaN(e)?"₺0,00":Number(e).toLocaleString("tr-TR",{style:"currency",currency:"TRY"}),ge=e=>{if(!e)return"-";return(e.toDate?e.toDate():new Date(e)).toLocaleDateString("tr-TR",{year:"numeric",month:"long",day:"numeric"})},he=e=>e.isPaid?"badge-success":e.dueDate&&new Date(e.dueDate)<new Date?"badge-error":"badge-warning",fe=e=>e.isPaid?"Ödendi":e.dueDate&&new Date(e.dueDate)<new Date?"Ödenmedi":"Ödenmemiş";return t(()=>[ie.user,se.params.id],([e,t])=>{"Profile"===se.name?"tenant"===(null==e?void 0:e.role)&&e.tenantId&&(ue.value=e.tenantId):ue.value=t},{immediate:!0,deep:!0}),t(ue,(e,t)=>{e&&e!==t&&(async()=>{if(ue.value){ve.value=!0;try{const e=await y.getTenantById(ue.value);if(!e)return oe.value=null,void(ve.value=!1);oe.value=e;const[t,a]=await Promise.all([b.getPayments({tenantId:ue.value}),g.getUtilityDebts({tenantId:ue.value})]),l=[];a.forEach(e=>l.push({...e,type:e.type,description:`${"Electricity"===e.type?"Elektrik":"Water"===e.type?"Su":"Borç"} (${e.period||e.dueDate?new Date(e.dueDate).toLocaleDateString("tr-TR"):"Dönem Belirtilmemiş"})`,amount:e.amount||0,toplamTutar:e.amount||0,remainingAmount:e.remainingAmount||e.amount||0,isPaid:"Paid"===e.status})),me.value=l.sort((e,t)=>(t.date||0)-(e.date||0)),de.value=a.filter(e=>{const t=Number(e.remainingAmount||e.amount||0);return"Paid"!==e.status&&t>0}).map(e=>{var t;return{...e,amount:Number(e.remainingAmount||e.amount||0),typeLabel:"Electricity"===e.type?"Elektrik":"Water"===e.type?"Su":"Borç",company:(null==(t=oe.value)?void 0:t.firstName)?`${oe.value.firstName} ${oe.value.lastName}`:"Bilinmeyen",floor:e.unit||"-"}}).sort((e,t)=>(e.dueDate||0)-(t.dueDate||0)),ce.value=t.sort((e,t)=>(t.paymentDate||0)-(e.paymentDate||0));let n=de.value.reduce((e,t)=>e+Number(t.amount||0),0);ye.value=n}catch(e){re(e,{component:"TenantDetailPage",action:"fetchTenantDetails"})}finally{ve.value=!1}}else ve.value=!1})()},{immediate:!0}),(e,t)=>{const v=i("router-link");return ve.value?(p(),a("div",x,t[4]||(t[4]=[l("span",{class:"loading loading-spinner loading-lg"},null,-1)]))):oe.value?(p(),a("div",D,[l("div",w,[l("div",T,[l("div",N,[l("div",A,[l("div",E,[l("div",S,[l("span",B,r(oe.value.company?oe.value.company.charAt(0).toUpperCase():"K"),1)])]),l("div",null,[l("h1",j,r(oe.value.company),1),l("p",P,r(oe.value.firstName)+" "+r(oe.value.lastName),1)])]),l("div",K,[l("div",$,[t[8]||(t[8]=l("div",{class:"text-sm text-base-content/70"},"Güncel Bakiye",-1)),l("div",{class:u(["text-2xl font-bold",ye.value>0?"text-error":"text-success"])},r(be(ye.value)),3)]),l("span",{class:u(["badge badge-lg font-semibold",oe.value.isActive?"badge-success":"badge-ghost"])},r(oe.value.isActive?"Aktif":"Pasif"),3)])])])]),l("div",I,[l("a",{class:u(["tab",{"tab-active":"debts"===pe.value}]),onClick:t[0]||(t[0]=e=>pe.value="debts")},"Ödenmemiş Borçlar",2),l("a",{class:u(["tab",{"tab-active":"payments"===pe.value}]),onClick:t[1]||(t[1]=e=>pe.value="payments")},"Yapılan Ödemeler",2),l("a",{class:u(["tab",{"tab-active":"history"===pe.value}]),onClick:t[2]||(t[2]=e=>pe.value="history")},"Sayaç ve Aidat Kayıtları",2),l("a",{class:u(["tab",{"tab-active":"info"===pe.value}]),onClick:t[3]||(t[3]=e=>pe.value="info")},"Kiracı Bilgileri",2)]),l("div",C,[l("div",L,["debts"===pe.value?(p(),a("div",_,[t[11]||(t[11]=l("h3",{class:"text-xl font-bold mb-4"},"Ödenmemiş Faturalar ve Aidatlar",-1)),l("div",G,[l("table",R,[t[10]||(t[10]=l("thead",null,[l("tr",null,[l("th",null,"Açıklama"),l("th",null,"Son Ödeme Tarihi"),l("th",{class:"text-right"},"Tutar")])],-1)),l("tbody",null,[(p(!0),a(d,null,c(de.value,e=>(p(),a("tr",{key:e.id,class:"hover"},[l("td",null,r(e.description||`Aidat (${e.period||e.unit})`),1),l("td",null,r(ge(e.dueDate)),1),l("td",Y,r(be(e.amount||e.toplamTutar)),1)]))),128)),0===de.value.length?(p(),a("tr",z,t[9]||(t[9]=[l("td",{colspan:"3",class:"text-center py-8 text-base-content/60"},"Ödenmemiş borç bulunmamaktadır.",-1)]))):o("",!0)])])])])):o("",!0),"payments"===pe.value?(p(),a("div",F,[t[14]||(t[14]=l("h3",{class:"text-xl font-bold mb-4"},"Ödeme Geçmişi",-1)),l("div",U,[l("table",W,[t[13]||(t[13]=l("thead",null,[l("tr",null,[l("th",null,"Ödeme Tarihi"),l("th",null,"Açıklama"),l("th",{class:"text-right"},"Tutar")])],-1)),l("tbody",null,[(p(!0),a(d,null,c(ce.value,e=>(p(),a("tr",{key:e.id,class:"hover"},[l("td",null,r(ge(e.paymentDate)),1),l("td",null,r(e.description),1),l("td",H,r(be(e.amount)),1)]))),128)),0===ce.value.length?(p(),a("tr",q,t[12]||(t[12]=[l("td",{colspan:"3",class:"text-center py-8 text-base-content/60"},"Kayıtlı ödeme bulunmamaktadır.",-1)]))):o("",!0)])])])])):o("",!0),"history"===pe.value?(p(),a("div",J,[t[17]||(t[17]=l("h3",{class:"text-xl font-bold mb-4"},"Geçmiş Kayıtlar",-1)),l("div",M,[l("table",O,[t[16]||(t[16]=l("thead",null,[l("tr",null,[l("th",null,"Tarih"),l("th",null,"Tür"),l("th",null,"Açıklama"),l("th",null,"İlk Endeks"),l("th",null,"Son Endeks"),l("th",null,"Tüketim"),l("th",{class:"text-right"},"Tutar"),l("th",null,"Durum")])],-1)),l("tbody",null,[(p(!0),a(d,null,c(me.value,e=>(p(),a("tr",{key:e.id,class:"hover"},[l("td",null,r(ge(e.date)),1),l("td",null,[l("span",{class:u(["badge","water"===e.type?"badge-info":"electricity"===e.type?"badge-warning":"badge-neutral"])},r("water"===e.type?"Su":"electricity"===e.type?"Elektrik":"Aidat"),3)]),l("td",null,r(e.description),1),l("td",null,r(e.ilkEndeks||"-"),1),l("td",null,r(e.sonEndeks||"-"),1),l("td",null,r(e.tuketim||"-"),1),l("td",Q,r(be(e.amount)),1),l("td",null,[l("span",{class:u(["badge",he(e)])},r(fe(e)),3)])]))),128)),0===me.value.length?(p(),a("tr",V,t[15]||(t[15]=[l("td",{colspan:"8",class:"text-center py-8 text-base-content/60"},"Kayıtlı sayaç veya aidat bulunmamaktadır.",-1)]))):o("",!0)])])])])):o("",!0),"info"===pe.value?(p(),a("div",X,[t[27]||(t[27]=l("h3",{class:"text-xl font-bold"},"Detaylı Bilgiler",-1)),l("div",Z,[l("div",null,[t[18]||(t[18]=l("strong",null,"Yetkili:",-1)),m(" "+r(oe.value.firstName)+" "+r(oe.value.lastName),1)]),l("div",null,[t[19]||(t[19]=l("strong",null,"Daireler:",-1)),m(" "+r((oe.value.units||[]).join(", ")),1)]),l("div",null,[t[20]||(t[20]=l("strong",null,"Telefon:",-1)),t[21]||(t[21]=m()),l("a",{href:`tel:${oe.value.phone}`,class:"link link-primary"},r(oe.value.phone),9,ee)]),l("div",null,[t[22]||(t[22]=l("strong",null,"E-posta:",-1)),t[23]||(t[23]=m()),l("a",{href:`mailto:${oe.value.email}`,class:"link link-primary"},r(oe.value.email),9,te)]),l("div",null,[t[24]||(t[24]=l("strong",null,"Sözleşme Başlangıcı:",-1)),m(" "+r(ge(oe.value.contractStartDate)),1)]),oe.value.contractEndDate?(p(),a("div",ae,[t[25]||(t[25]=l("strong",null,"Sözleşme Bitişi:",-1)),m(" "+r(ge(oe.value.contractEndDate)),1)])):o("",!0),l("div",le,[t[26]||(t[26]=l("strong",null,"Notlar:",-1)),m(" "+r(oe.value.notes||"-"),1)])])])):o("",!0)])])])):(p(),a("div",k,[t[6]||(t[6]=l("h2",{class:"text-2xl font-bold text-error"},"Kiracı Bulunamadı",-1)),t[7]||(t[7]=l("p",{class:"text-base-content/70 mt-2"},"Bu ID'ye sahip bir kiracı bulunamadı veya veritabanından silinmiş olabilir.",-1)),n(v,{to:"/tenants",class:"btn btn-primary mt-6"},{default:s(()=>t[5]||(t[5]=[m("Kiracı Listesine Geri Dön")])),_:1,__:[5]})]))}}};export{ne as default};
